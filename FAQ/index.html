<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.ncl.ucar.edu/FAQ/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 14:34:26 GMT -->
<head>
<title>NCL FAQ</title>
</head>
<body>

	<!-- main navigation include -->
		<!-- NCL CSS -->
	<link rel="stylesheet" href="../styles/ncl.css" type="text/css" media="all">
	
	
		<!-- Equal Height Columns -->
		<script type="text/javascript" src="../scripts/column_height_equal.js"></script>
		
		<!-- DOJO Expandable Tree Nav -->

		<script type="text/javascript" src="../scripts/dojo/dojo.js"></script>
		<script type="text/javascript">
		
		dojo.require("dojo.widget.TreeV3");
		dojo.require("dojo.widget.TreeNodeV3");
		dojo.require("dojo.widget.TreeLinkExtension");
		dojo.require("dojo.widget.TreeBasicControllerV3");
		dojo.hostenv.writeIncludes();

		</script>
		

		<div id="top_colorbar"><!-- begin top_colorbar -->
		</div><!-- end top_colorbar -->


	<div id="nav_org_wrap"><!-- begin nav_org_wrap -->
	<div id="nav_org"><!-- begin nav_org -->

		<ul class="menubar">


			<li><a class="trigger" href="../internal/index.html">&nbsp;</a>
			</li>

			<li><a class="trigger" href="http://www.ucar.edu/">UCAR</a>
			</li>

			<li><a class="trigger" href="http://www.ncar.ucar.edu/">NCAR</a>
			</li>

			<li><a class="trigger" href="http://www.cisl.ucar.edu/">CISL</a>
			</li>
		</ul>

	</div><!-- end nav_org -->

	<div id="search"><!-- begin search -->

		<ul class="menubar">

			<li><a class="trigger" href="../Download/index.html">Download</a>
			</li>

			<li><a class="trigger" href="../citation.html">Citing NCL</a>
			</li>

			<li><a class="trigger" href="../contributors.html">Contributors</a>
			</li>

		</ul>

	</div><!-- end search -->

	</div><!-- end nav_org_wrap -->
	
	
	

		<div id="nav_main_wrap"><!-- begin nav_main_wrap -->

		<div id="nav_main"><!-- begin nav_main -->
			<ul id="menubar_main">

				<li>
				<a href="../Document/Pivot_to_Python/september_2019_update.html" class="triggeryw">&#9733; UPDATED LETTER TO NCL USERS</a>
				<li>
				<a href="../index.html" class="triggeron">NCL</a>
					<ul>
                                          <li><a href="../Document/Pivot_to_Python/index.html">Pivot to Python</a>
					  <li><a href="../overview.html" class="subitem">Overview</a></li>
						<li><a href="../get_started.html" class="subitem">Getting Started</a> </li>
						<li><a href="../gallery.html" class="subitem">Gallery</a></li>
						<li><a href="../Download/index.html" class="subitem">Download</a></li>
						<li><a href="../current_release.html" class="subitem">What's New</a></li>
						<li><a href="../Document/index.html" class="subitem">Documentation</a></li>						
						<li><a href="../citation.html" class="subitem">Citing NCL</a></li>
					</ul>

				</li>

				<li>
				<a href="../Applications/index.html" class="trigger">Examples</a>
					<ul>
						<li><a href="../Applications/index.html" class="subitem" title="Examples">All Examples</a></li>
						<li><a href="../Applications/Templates/index.html" class="subitem">Templates</a></li>
						<li><a href="../Applications/list_io.html" class="subitem">File I/O</a></li>
						<li><a href="../Applications/list_data.html" class="subitem">Datasets</a></li>
						<li><a href="../Applications/list_maps.html" class="subitem">Maps</a></li>
						<li><a href="../Applications/list_models.html" class="subitem">Models</a></li>
						<li><a href="../Applications/list_dataP.html" class="subitem">Data Analysis</a></li>
						<li><a href="../Applications/list_ptypes.html" class="subitem">Plot Types</a></li>
						<li><a href="../Applications/list_tech.html" class="subitem">Plot Techniques</a></li>
						<li><a href="../Applications/list_special.html" class="subitem">Special Plots</a></li>
						<li><a href="../Applications/list_grids.html" class="subitem">Non-uniform Grids</a></li>
						<li><a href="../Applications/list_misc.html" class="subitem">Miscellaneous</a></li>
					</ul>
				</li>

				<li>
				<a href="../Document/Functions/list_alpha.html" class="trigger">Functions</a>
					<ul>
						<li><a href="../Document/Functions/list_alpha.html" class="subitem">Alphabetical Listing</a></li>
						<li><a href="../Document/Functions/index.html" class="subitem">Category Listing</a></li>
						<li><a href="../Document/Functions/list_type.html" class="subitem">Function-Type Listing</a></li>						
					</ul>
				</li>
				
				<li>
				<a href="../Document/Graphics/Resources/index.html" class="trigger">Resources</a>
					<ul>
					  <li><a href="../Document/Graphics/Resources/list_alpha_res.html" class="subitem">Complete Listing</a></li>
					
						<li><a href="../Document/Graphics/Resources/am.html" class="subitem">am (annotation manager)</a></li>
						<li><a href="../Document/Graphics/Resources/app.html" class="subitem">app (app)</a></li>
						<li><a href="../Document/Graphics/Resources/ca.html" class="subitem">ca (coordinate array)</a></li>
						<li><a href="../Document/Graphics/Resources/cn.html" class="subitem">cn (contour)</a></li>
						<li><a href="../Document/Graphics/Resources/ct.html" class="subitem">ct (coordinate array table)</a></li>
						<li><a href="../Document/Graphics/Resources/dc.html" class="subitem">dc (data comm)</a></li>
						
						<li><a href="../Document/Graphics/Resources/err.html" class="subitem">err (error)</a></li>
						<li><a href="../Document/Graphics/Resources/gs.html" class="subitem">gs (graphics styles)</a></li>
						<li><a href="../Document/Graphics/Resources/gsn.html" class="subitem">gsn (gsn high-level interfaces)</a></li>
						<li><a href="../Document/Graphics/Resources/lb.html" class="subitem">lb (label bar)</a></li>
						<li><a href="../Document/Graphics/Resources/lg.html" class="subitem">lg (legends)</a></li>
						<li><a href="../Document/Graphics/Resources/mp.html" class="subitem">mp (maps)</a></li>
						
						<li><a href="../Document/Graphics/Resources/pm.html" class="subitem">pm (plot manager)</a></li>
						<li><a href="../Document/Graphics/Resources/pr.html" class="subitem">pr (primitives)</a></li>
						<li><a href="../Document/Graphics/Resources/sf.html" class="subitem">sf (scalar field)</a></li>
						<li><a href="../Document/Graphics/Resources/st.html" class="subitem">st (streamline)</a></li>
						<li><a href="../Document/Graphics/Resources/tf.html" class="subitem">tf (transform)</a></li>
						<li><a href="../Document/Graphics/Resources/ti.html" class="subitem">ti (title)</a></li>
						
						<li><a href="../Document/Graphics/Resources/tm.html" class="subitem">tm (tickmark)</a></li>
						<li><a href="../Document/Graphics/Resources/tr.html" class="subitem">tr (transformation)</a></li>
						<li><a href="../Document/Graphics/Resources/tx.html" class="subitem">tx (text)</a></li>
						<li><a href="../Document/Graphics/Resources/vc.html" class="subitem">vc (vectors)</a></li>
						<li><a href="../Document/Graphics/Resources/vf.html" class="subitem">vf (vector field)</a></li>
						<li><a href="../Document/Graphics/Resources/vp.html" class="subitem">vp (view port)</a></li>
						
						<li><a href="../Document/Graphics/Resources/wk.html" class="subitem">wk (workstation)</a></li>
						<li><a href="../Document/Graphics/Resources/ws.html" class="subitem">ws (workspace)</a></li>
						<li><a href="../Document/Graphics/Resources/xy.html" class="subitem">xy (xy plots)</a></li>						
					</ul>
        </li>

				<li>
				<a href="../links.html" class="trigger">Popular Links</a>
					<ul>
					<li><a href="../Document/Graphics/hlures.html" class="subitem">.hluresfile</a></li>
					<li><a href="../Document/Graphics/color_table_gallery.html" class="subitem">Color Tables</a></li>
					<li><a href="../Document/Graphics/font_tables.html" class="subitem">Font Tables</a></li>	
					<li><a href="../Document/Language/error_messages.html" class="subitem">Error Messages</a></li>	
					<li><a href="../Document/Graphics/Images/dashpatterns.png" class="subitem">Dash Pattern Table</a></li>	
					<li><a href="../Document/Graphics/Images/fillpatterns.png" class="subitem">Fill Pattern Table</a></li>	
					<li><a href="../Document/Graphics/Images/markers.png" class="subitem">Marker Table</a></li>
					<li><a href="../Document/Graphics/map_projections.html" class="subitem">Map Projections</a></li>
					<li><a href="../Document/Graphics/rangs.html" class="subitem">High Resolution Map Database</a></li>
					<li><a href="../Applications/editor.html" class="subitem">Editor Enhancements</a></li>
					<li><a href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a></li>
					<li><a href="../Document/Tools/ncl_filedump.html">ncl_filedump</a></li>
					<li><a href="../Document/Tools/index.html" class="subitem">Tools</a></li>
					<li><a href="../Document/Tools/WRAPIT.html" class="subitem">WRAPIT</a></li>
					</ul>
				</li>

				<li>
				<a href="../announcements.html" class="trigger">What's New</a>
					<ul>
					        <li><a href="../announcements.html" class="subitem">Announcements</a></li>
						<li><a href="../current_release.html" class="subitem">In Latest Release</a></li>
						<li><a href="../new_applications.html" class="subitem">In Application Examples</a></li>
						<li><a href="../future_release.html" class="subitem">In Next Release</a></li>	
						<li><a href="../prev_releases.html" class="subitem">In Previous Releases</a></li>
					</ul>
				</li>
	

				<li>
				<a href="../Support/index.html" class='trigger'>Support</a>
					<ul>
						<li><a href="../Support/email_lists.html" class="subitem">Email Lists</a></li>
						<li><a href="../Applications/editor.html" class="subitem">Editor enhancements</a></li>
						<li><a href="../Document/Language/error_messages.html" class="subitem">Error messages</a></li>
						<li><a href="../Document/Manuals/index.html" class="subitem">Manuals</a></li>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="../Training/index.html" class="subitem">Training</a></li>
						<li><a href="../Training/Webinars/index.html" class="subitem">Webinars</a></li>
						<li><a href="../Training/Workshops/index.html" class="subitem">Workshops</a></li>
						<li><a href="../Document/index.html" class="subitem">Documentation</a></li>
						<li><a href="index.html" class="subitem">FAQ</a></li>
						<li><a href="../ftp_files.html" class="subitem">Uploading files via ftp</a></li>
						<li><a href="../report_bug.html" class="subitem">Report Bugs</a></li>
					</ul>
				</li>

				<li>
				<a href="../External/index.html" class='trigger'>External</a>
					<ul>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="http://climatedataguide.ucar.edu/" class="subitem">Climate Data Guide</a></li>
						<li><a href="https://code.zmaw.de/projects/cdo/" class="subitem">Climate Data Operators</a></li>
						<li><a href="http://www.earthsystemmodeling.org/" class="subitem">Earth System Modeling Framework</a></li>
						<li><a href="http://nco.sourceforge.net/" class="subitem">NetCDF Operators</a></li>
						<li><a href="http://www.pyngl.ucar.edu/" class="subitem">PyNGL</a></li>
						<li><a href="http://www.pyngl.ucar.edu/Nio.shtml" class="subitem">PyNIO</a></li>
					</ul>
				</li>


			<!-- end menubar_main -->		
			</ul>
		
		<!-- end nav_main -->	
		</div>
		
	<!-- end nav_main_wrap -->	
  	</div>
		
			


	<div id="wrap"><!-- begin wrap -->
	<div id="content"><!-- begin content -->

	<!-- ######### BEGIN EDITABLE PAGE CONTENT ######### -->

			<div id="subheader"><!-- begin subheader -->
			<map name="ncl-home">
<area shape="rect" coords="0,0,65,40" href="../index-2.html">
<area shape="rect" coords="540,0,615,40" href="http://www.ncar.ucar.edu/">
<area shape="rect" coords="625,0,665,40" href="http://www.nsf.gov/">
</map>

	<div id="nclheader">
	<img src="https://www.ncl.ucar.edu/Images/NCL_NCAR_NSF_banner.png" height=40 "NCL Website header" usemap="#ncl-home">
	</div>


			<div id="googlesearch">
<form style="float:right" id="cse-search-box" action="http://google.com/cse">
  <input type="hidden" name="cx" value="016712339613867830978:igijo92w2zo" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" name="q" size="31" maxlength="255" id="searchbox" /><label for="searchbox">Search</label>
  <input type="hidden" name="hq" value="site:www.ncl.ucar.edu">
</form>
			</div><!-- end googlesearch -->

			</div><!-- end subheader -->

			      <div id="general_main">

<div class=main>
<H1>NCL Frequently Asked Questions (FAQ)</H1>

<font size=-1><a href="#basics">Basics</a> | <a href="#core_lang">NCL core language</a> | <a href="#file_io">File input/output</a> | <a href="#data_hand">Data handling</a> | <a href="#data_anal">Data analysis</a> | <a href="#vis">Visualization</a> | <a href="#array_funcs">Array functions</a> | <a href="#o_formats">Graphical output</a> | <a href="#err_msgs">Error messages and other issues</a> | <a href="#mem_issues">Memory issues</a> | <a href="#doc">Documentation</a> | <a href="#misc">Miscellaneous</a> | </font><p>
<a name="basics"></a>
<h3>Basics</h3>
<p>

<ol>
<li><i><a href="#basics_001">Where can I download NCL?</a></i>
<li><i><a href="#basics_002">I'm having problems downloading NCL from the ESG website.</a></i>
<li><i><a href="#basics_003">How do I set up my environment to run NCL?</a></i>
<li><i><a href="#basics_004">How do I run NCL?</a></i>
<li><i><a href="#basics_005">How do I determine the version of NCL?</a></i>
<li><i><a href="#basics_006">Are there any email lists I can join?</a></i>
<li><i><a href="#basics_007">Where can I see some examples of how to use NCL?</a></i>
<li><i><a href="#basics_008">Are there any NCL command line options I can use?</a></i>
<li><i><a href="#basics_009">Are there any editor enhancements for editing NCL scripts?</a></i>
<li><i><a href="#basics_010">If I'm running NCL interactively, are there any command-line shortcuts I can use?</a></i>
<li><i><a href="#basics_011">If I'm running interactively, how can I load some existing NCL code?</a></i>
<li><i><a href="#basics_012">Is there anyway I can turn off the preceding "(<i>n</i>)" output when I print a bunch of values?</a></i>
<li><i><a href="#basics_013">My NCL script is quitting suddenly, and I'm not sure where and/or why.</a></i>
<li><i><a href="#basics_014">How do I tell if I have an OPeNDAP-enabled NCL?</a></i>
</ol>

<a name="core_lang"></a>
<h3>NCL core language</h3>
<p>

<ol>
<li><i><a href="#core_lang_001">How do I comment a line in NCL? Is there a way to have a block of comments?</a></i>
<li><i><a href="#core_lang_002">Is there a continuation character in NCL?</a></i>
<li><i><a href="#core_lang_003">How do I easily convert a number to a string?</a></i>
<li><i><a href="#core_lang_004">How do I create a new variable that doesn't contain a _FillValue attribute?</a></i>
<li><i><a href="#core_lang_005">How do I create a double, long, short, or byte variable without using "new" or one of the conversion routines, like "<a href="../Document/Functions/Built-in/integertobyte.html"><strong>integertobyte</strong></a>"?</a></i>
<li><i><a href="#core_lang_006">How do I include the double quote (") character in an NCL string?</a></i>
<li><i><a href="#core_lang_007">Can NCL prompt for user input?</a></i>
<li><i><a href="#core_lang_008">Is it possible to have global variables in NCL?</a></i>
<li><i><a href="#core_lang_009">How can I delete multiple NCL variables with one statement?</a></i>
<li><i><a href="#core_lang_010">How do I delete a named dimension?</a></i>
<li><i><a href="#core_lang_011">Is there a way to see the loaded variables and their dimensions in NCL similar to "whos" in matlab?</a></i>
<li><i><a href="#core_lang_012">I'm getting an unexpected value when I use the power ('^') operator combined with a negative value.</a></i>
<li><i><a href="#core_lang_013">How do I create a list of string integers with leading zeros ("008", "009", "010", etc)?</a></i>
<li><i><a href="#core_lang_014">How do I get the current date into NCL as a string?</a></i>
<li><i><a href="#core_lang_015">How do I get a list of files into an array of strings in NCL?</a></i>
<li><i><a href="#core_lang_016">How can I recursively get a list of files in a directory tree into NCL?</a></i>
<li><i><a href="#core_lang_017">How do I concatenate strings and values in NCL?</a></i>
<li><i><a href="#core_lang_018">How do I retrieve an environment variable in NCL?</a></i>
<li><i><a href="#core_lang_019">How do I print nicely formatted, multiple columns of data in NCL?</a></i>
<li><i><a href="#core_lang_020">Can multiple variables be returned from a user created function?</a></i>
</ol>

<a name="file_io"></a>
<h3>File input/output</h3>
<p>

<ol>
<li><i><a href="#file_io_001">What's the easiest way to convert a GRIB1, GRIB2, HDF 4, or HDF-EOS 2 file to a NetCDF file?</a></i>
<li><i><a href="#file_io_002">How do I dump the contents of a GRIB, HDF, or HDF-EOS file (or variable on the file) to the screen?</a></i>
<li><i><a href="#file_io_003">How do I convert a large file to a NetCDF file?</a></i>
<li><i><a href="#file_io_004">How do I write a large (> 2 GB) variable to a netCDF file?</a></i>
<li><i><a href="#file_io_005">How do I get the latest tables for reading GRIB files?</a></i>
<li><i><a href="#file_io_006">Why have some of my GRIB2 variable names changed since I updated to NCL <a href="../prev_releases.html#5.2.0">V5.2.0</a>?</a></i>
<li><i><a href="#file_io_007">How do I write a scalar to a NetCDF file?</a></i>
<li><i><a href="#file_io_008">How do I retain metadata for a variable that was read off a series of files using "addfiles"?</a></i>
<li><i><a href="#file_io_009">How do I access an NCL file variable, attributes, or coordinate arrays if they have hyphens/dashes ('-') in the name?</a></i>
<li><i><a href="#file_io_010">How do I read/write NetCDF, HDF4, HDF-EOS2, GRIB1, GRIB2, or CCM History Tape files?</a></i>
<li><i><a href="#file_io_011">How do I read/write ASCII files?</a></i>
<li><i><a href="#file_io_012">How do I read CSV files?</a></i>
<li><i><a href="#file_io_013">How do I write a formatted ASCII file?</a></i>
<li><i><a href="#file_io_014">How do I read an ASCII file if I don't know how many lines it contains?</a></i>
<li><i><a href="#file_io_015">How do I read an ASCII file that contains delimiters?</a></i>
<li><i><a href="#file_io_016">How do I read/write binary files?</a></i>
<li><i><a href="#file_io_017">Once I've opened a file with "addfile", how do I find out what variables and attributes it contains?</a></i>
<li><i><a href="#file_io_018">Is there a way to control whether my binary file is read or written as little endian or big endian?</a></i>
<li><i><a href="#file_io_019">I'm having trouble reading a Fortran binary file with records.</a></i>
<li><i><a href="#file_io_020">I'm trying to convert a file to a NetCDF file using "ncl_convert2nc", but getting an error message about violating format constraints.</a></i>
<li><i><a href="#file_io_021">Why do I get different results when reading my HDF-EOS2 file, depending on whether I use the ".hdf" or ".hdfeos" extension?</a></i>
<li><i><a href="#file_io_022">Can I read shapefiles using NCL?</a></i>
<li><i><a href="#file_io_023">How can I get at vgroup data on my HDF4 file?</a></i>
<li><i><a href="#file_io_024">When I run my script, I'm getting an error message "ncclose: ncid 0: NetCDF: Not a valid ID".</a></i>
<li><i><a href="#file_io_025">When I try to access the Climate Diagnostics Center [CDC] OPeNDAP server via NCL, I get "Permission denied".</a></i>
<li><i><a href="#file_io_026">I'm running into a problem when opening lots of files with addfile or addfiles ("Too many files open").</a></i>
</ol>

<a name="data_hand"></a>
<h3>Data handling</h3>
<p>

<ol>
<li><i><a href="#data_hand_001">How do I set a missing value for my data?</a></i>
<li><i><a href="#data_hand_002">How do I determine if my data contains any missing values, or count how many missing values it has?</a></i>
<li><i><a href="#data_hand_003">How do I change the missing value to another value?</a></i>
<li><i><a href="#data_hand_004">How do I deal with NaN (not-a-number) values in my data?</a></i>
<li><i><a href="#data_hand_005">How do I deal with "Inf" (infinity) values in my data?</a></i>
</ol>

<a name="data_anal"></a>
<h3>Data analysis</h3>
<p>

<ol>
<li><i><a href="#data_anal_001">How do I average values in a multi-dimensioned array?</a></i>
<li><i><a href="#data_anal_002">How can I do an element-wise minimum/maximum between two arrays of the same size?</a></i>
<li><i><a href="#data_anal_003">How do I interpolate my 2-dimensional random data to a 2-dimensional gridded array?</a></i>
<li><i><a href="#data_anal_004">How do I interpolate my 3-dimensional random data to a 3-dimensional gridded array?</a></i>
<li><i><a href="#data_anal_005">How can I figure out if a particular latitude/longitude point is within a specific area, like Europe?</a></i>
</ol>

<a name="vis"></a>
<h3>Visualization</h3>
<p>

<ol>
<li><i><a href="#vis_001">How can I create an "editable" graphics file required for journal publication?</a></i>
<li><i><a href="#vis_002">How can I maximize the size of a plot in the frame?</a></i>
<li><i><a href="#vis_003">How do I get multiple plots on a page?</a></i>
<li><i><a href="#vis_004">What's a good way to generate a color map (table)?</a></i>
<li><i><a href="#vis_005">My map projection doesn't look right.</a></i>
<li><i><a href="#vis_006">How do I change all of my fonts to be the same in my visualization?</a></i>
<li><i><a href="#vis_007">How can I change the text function code to something other than a colon?</a></i>
<li><i><a href="#vis_008">How can I get a degree symbol in a text string?</a></i>
<li><i><a href="#vis_009">How can I get things like accents or umlauts over my text?</a></i>
<li><i><a href="#vis_010">How can I get special characters, like Greek symbols, in my graphical text strings?</a></i>
<li><i><a href="#vis_011">Can I use real PostScript fonts in my PostScript file?</a></i>
<li><i><a href="#vis_012">I'm having trouble importing a PS file into an application like Adobe Illustrator.</a></i>
<li><i><a href="#vis_013">How can I get the length of my axes to be the same ratio as the range of my axes?</a></i>
<li><i><a href="#vis_014">How do I change the aspect ratio or size of my map or plot?</a></i>
<li><i><a href="#vis_015">Can I set color resources by color name rather than color index values?</a></i>
<li><i><a href="#vis_016">How can I speed up the drawing of filled contours in NCL?</a></i>
<li><i><a href="#vis_017">Can I change color index values or color maps in mid-frame?</a></i>
<li><i><a href="#vis_018">How do I get my PostScript/PDF output to cover most of an 8-1/2" x 11" page?</a></i>
<li><i><a href="#vis_019">How can I control the size and location of the X11 window that NCL brings up?</a></i>
<li><i><a href="#vis_020">How do I tell NCL to ignore missing values in my plot?</a></i>
<li><i><a href="#vis_021">How can I get more labels on my contour lines?</a></i>
<li><i><a href="#vis_022">My X or Y axis values are not linear. How can I change this?</a></i>
<li><i><a href="#vis_023">How do I get log scaling on either of my plot axes?</a></i>
<li><i><a href="#vis_024">How do I fill my contour levels with various shading patterns and/or solid colors?</a></i>
<li><i><a href="#vis_025">How do I overlay a contour plot (or a vector/streamline plot) on a map?</a></i>
<li><i><a href="#vis_026">How do I force the tickmarks to point inward?</a></i>
<li><i><a href="#vis_027">I'm trying to control the tickmarks on the top or right axis, and nothing is happening.</a></i>
<li><i><a href="#vis_028">How can I improve the resolution of my map outlines?</a></i>
<li><i><a href="#vis_029">When I draw a map using the high-resolution map database, I seem to randomly get different resolutions.</a></i>
<li><i><a href="#vis_030">How can I get more geographical outlines in my map, like the provinces of China?</a></i>
<li><i><a href="#vis_031">If I am creating a color contour or vector plot, how do I select my colors such that they are spread across my whole color map?</a></i>
<li><i><a href="#vis_032">How do I generate a wire-frame surface or isosurface plot in NCL?</a></i>
<li><i><a href="#vis_033">How do I draw weather symbols (wind barbs, weather front lines, high and low pressure indicators, arrows, dots, weather icons, cloud symbols, lightning bolts, etc.) on a map?</a></i>
<li><i><a href="#vis_034">How can I have a new line as part of a graphical text string in NCL?</a></i>
<li><i><a href="#vis_035">How come I get different line thicknesses on different output devices using the same thickness value?</a></i>
<li><i><a href="#vis_036">How can I put a timestamp on my plot?</a></i>
<li><i><a href="#vis_037">Why am I not getting the color I expect when I reference a named color?</a></i>
<li><i><a href="#vis_038">Why is my land not being filled in the color I expect?</a></i>
<li><i><a href="#vis_039">How do I set up my NCL script so that it uses a resource file?</a></i>
<li><i><a href="#vis_040">How can I move and resize my labelbar and/or legend?</a></i>
<li><i><a href="#vis_041">How can I set the precision of the label bar labels?</a></i>
<li><i><a href="#vis_042">How can I generate some "nice" 2D random data for a contour and/or vector plot?</a></i>
</ol>

<a name="array_funcs"></a>
<h3>Array functions</h3>
<p>

<ol>
<li><i><a href="#array_funcs_001">How do I get the dimensions of an array?</a></i>
<li><i><a href="#array_funcs_002">How do I create unique random subscripts?</a></i>
<li><i><a href="#array_funcs_003">How do I eliminate missing values from a one-dimensional array?</a></i>
<li><i><a href="#array_funcs_004">How do I generate a one-dimensional array of equally-spaced integers or floating point numbers?</a></i>
<li><i><a href="#array_funcs_005">How do I find or print the minimum/maximum values of my data array?</a></i>
</ol>

<a name="o_formats"></a>
<h3>Graphical output</h3>
<p>

<ol>
<li><i><a href="#o_formats_001">How do I change the default NCGM/PostScript/PDF file name to something else?</a></i>
<li><i><a href="#o_formats_002">How do I convert my NCL graphics file to another format, like PNG, to put on the web or in a presentation?</a></i>
<li><i><a href="#o_formats_003">How do I remove all the white space from an image?</a></i>
<li><i><a href="#o_formats_004">Is there a way to make the PostScript files generated by NCL smaller?</a></i>
<li><i><a href="#o_formats_005">Can I produce a PNG image directly from NCL?</a></i>
<li><i><a href="#o_formats_006">Is there a way to remove the ".000001." from the PNG filename?</a></i>
<li><i><a href="#o_formats_007">How can I tilt an NCL graphic?</a></i>
<li><i><a href="#o_formats_008">How can I convert a series of PS or EPS files to an animation?</a></i>
<li><i><a href="#o_formats_009">How can I produce Google Earth kmz files?</a></i>
<li><i><a href="#o_formats_010">How do I convert my multi-frame NCL graphics file to an MPEG movie file?</a></i>
<li><i><a href="#o_formats_011">How do I include an encapsulated PostScript file from NCL in a LaTex document?</a></i>
</ol>

<a name="err_msgs"></a>
<h3>Error messages and other issues</h3>
<p>

<ol>
<li><i><a href="#err_msgs_001">When I send my NCL graphics to an X11 window, only a partial image is drawn.</a></i>
<li><i><a href="#err_msgs_002">When I run my script, I'm getting a "fatal:NclMalloc Failed" error message.</a></i>
<li><i><a href="#err_msgs_003">When I run NCL, I get an error message about being unable to load the "System Resource File".</a></i>
<li><i><a href="#err_msgs_004">When I run NCL, I get an error message about the X driver, like "error opening display".</a></i>
<li><i><a href="#err_msgs_005">What's the deal with the error message "error: line -1 before or near..."?</a></i>
<li><i><a href="#err_msgs_006">How can I redirect NCL's error messages to another file?</a></i>
<li><i><a href="#err_msgs_007">How can I turn off NCL warning messages?</a></i>
<li><i><a href="#err_msgs_008">I'm trying to list some files, and getting an error "Argument list too long".</a></i>
<li><i><a href="#err_msgs_009">When I try to run ncl, I get an error about "libgfortran.so.x" not being found.</a></i>
<li><i><a href="#err_msgs_010">I'm trying to compile my NCAR Graphics program using the Intel or gfortran compiler, but getting some undefined references.</a></i>
<li><i><a href="#err_msgs_011">When I run ncl version 5.2.0, I get an error "warning:ut_calendar: Invalid specification string."</a></i>
<li><i><a href="#err_msgs_012">When I run ncl, I get an error about libpng not being current.</a></i>
<li><i><a href="#err_msgs_013">I'm getting an error from WRAPIT about being unable to find "-lgfortran".</a></i>
<li><i><a href="#err_msgs_014">I'm getting a strange "workspace reallocation" error message.</a></i>
<li><i><a href="#err_msgs_015">I am trying to create a contour plot and getting an error about the scalar field being constant.</a></i>
<li><i><a href="#err_msgs_016">I am trying to create a contour plot and getting errors about sfXArray and sfYArray having an incorrect dimension size.</a></i>
<li><i><a href="#err_msgs_017">I'm getting a warning, "ContourPlotSetValues: Data values out of range of levels set by EXPLICITLEVELS mode".</a></i>
<li><i><a href="#err_msgs_018">I'm getting an "ARSCAM/ARPRAM ALGORITHM FAILURE" error message.</a></i>
<li><i><a href="#err_msgs_019">I'm getting the error message "PLCHHQ - CHARACTER NUMBER 10 (w) IS NOT A LEGAL FUNCTION CODE".</a></i>
<li><i><a href="#err_msgs_020">I'm getting the error "fatal:NhlCvtStringToEnum: Unable to convert string".</a></i>
<li><i><a href="#err_msgs_021">I'm getting an error from the "shea_util.ncl" script about "copy_VarCoords" being an undefined procedure.</a></i>
<li><i><a href="#err_msgs_022">When running a script with overlaid plots, I'm getting an error "cannot draw Plot Member".</a></i>
<li><i><a href="#err_msgs_023">When I use NCL's systemfunc on a X/Cygwin system, I get the error "cannot create child process".</a></i>
<li><i><a href="#err_msgs_024">When I compile an NCAR Graphics program, I get errors about undefined symbols like "_png_set_rows", "_png_destroy_write_struct", "_png_malloc", etc.</a></i>
<li><i><a href="#err_msgs_025">When I use "ncargex" or "ncargf77", I get an error "cannot find -lpng".</a></i>
<li><i><a href="#err_msgs_026">I'm trying to assign a value to an NCL variable, but getting a "right hand side can't be coerced to type of left hand side" error message.</a></i>
<li><i><a href="#err_msgs_027">I'm calling NCL from a shell script and getting a fatal error on line -1.</a></i>
<li><i><a href="#err_msgs_028">I'm getting an "MDRGSF/MDRGOF - ERROR OPENING RANGS/GSHHS CAT FILE" error message.</a></i>
<li><i><a href="#err_msgs_029">I'm trying to draw primitives (markers, lines, polygons) on my plot, and getting an error essage "tfPolyDrawList element 0 is invalid".</a></i>
<li><i><a href="#err_msgs_030">When I call one of the gsn_csm_xxxx_map plotting scripts, I get an error message about a units attribute not being correct.</a></i>
<li><i><a href="#err_msgs_031">I'm trying to create a contour, vector, or contour plot, and getting a weird error about spline approximation.</a></i>
<li><i><a href="#err_msgs_032">When I print something in NCL, I get an error about my PAGER environment variable.</a></i>
</ol>

<a name="mem_issues"></a>
<h3>Memory issues</h3>
<p>

<ol>
<li><i><a href="#mem_issues_001">What's the biggest array that NCL can allocate?</a></i>
<li><i><a href="#mem_issues_002">I'm running into a memory issue when I create lots of strings.</a></i>
</ol>

<a name="doc"></a>
<h3>Documentation</h3>
<p>

<ol>
<li><i><a href="#doc_001">Is there a way I can download the NCL website documentation so I can access it locally on my machine?</a></i>
<li><i><a href="#doc_002">Where can I see a list of all the NCL resources?</a></i>
<li><i><a href="#doc_003">Where can I see a list of all the NCL functions and procedures?</a></i>
<li><i><a href="#doc_004">Where can I see a list of links to dash patterns, marker styles, color tables, etc?</a></i>
</ol>

<a name="misc"></a>
<h3>Miscellaneous</h3>
<p>

<ol>
<li><i><a href="#misc_001">How should I cite NCL?</a></i>
<li><i><a href="#misc_002">How can I add a logo to an NCL plot?</a></i>
<li><i><a href="#misc_003">How do I call a C or Fortran function or procedure from NCL?</a></i>
<li><i><a href="#misc_004">How do I make sure that a C/Fortran routine I want to wrap doesn't conflict with a routine that might already be part of NCL?</a></i>
<li><i><a href="#misc_005">How do I fix buffering issues with NCL?</a></i>
<li><i><a href="#misc_006">If I obscure an NCL X11 window with another application, the X11 window doesn't refresh when I bring it back to the foreground.</a></i>
</ol>

<hr>

<h3>Basics</h3>
<p>

<ol>
<a name="basics_001"></a>
<li><i>Where can I download NCL?</i>
<p>


See the <a href="../Download/index.html">NCL download page</a> for full instructions.
You can download precompiled binaries for a specific UNIX system, or
source code.

<p><p>

<a name="basics_002"></a>
<li><i>I'm having problems downloading NCL from the ESG website.</i>
<p>


Please see our <a href="../Download/esg_trouble_shoot.html">ESG
troubleshooting guide</a> for help. If this doesn't help, then send
email to the <a
href="http://mailman.ucar.edu/mailman/listinfo/ncl-install">ncl-install</a>
email list.

<p><p>

<a name="basics_003"></a>
<li><i>How do I set up my environment to run NCL?</i>
<p>


<ul>
<a name="SetNCARG_ROOT"></a>
<li><b>Set the NCARG_ROOT environment variable and your search path to
where NCL/NCARG resides</b><p>

In order to use the software, you must set your NCARG_ROOT
environment variable to the parent directory where the NCL executables
and accompanying files were installed.  You also need to make sure
that the directory where the NCL/NCARG executables reside are on your
search path.  It is best to do this from one of your .* files in your
home directory.  If you are not sure which shell you are running, you
can do an "ls -a" in your home directory to see what kind of files you
have that start with ".", and then look in these files to see how
environment variables are set.<p>

In the example above, we would set these with the following:<p>

From C-shell (csh):

<pre>
    setenv NCARG_ROOT /usr/local
    setenv PATH=/usr/local/bin:$PATH
</pre>

From bash or ksh:

<pre>
    export NCARG_ROOT=/usr/local
    export PATH=/usr/local/bin:$PATH
</pre>

From sh:

<pre>
    NCARG_ROOT=/usr/local
    PATH=/usr/local/bin:$PATH
    export NCARG_ROOT
    export PATH
</pre>

You should now be set for using NCL and/or NCAR Graphics.  If you have
any problems, or questions about installing NCL from source code or
binaries, please send email to <a
href="http://mailman.ucar.edu/mailman/listinfo/ncl-install">ncl-install@ucar.edu</a>
(you need to subscribe first).<p>

<a name="SetDISPLAY"></a>
<li><b>Set the DISPLAY environment variable to indicate where to display
graphics</b><p>

This is not an NCL specific environment variable, but rather one that
is used by any X11 Windows application that you run.  For NCL or NCAR
Graphics, it is needed when you display your graphics to an X11
window, or if you use <a
href="../Document/Tools/ctrans.html">ictrans</a>, <a
href="../Document/Tools/ictrans.html">ctrans</a>, or <a
href="../Document/Tools/idt.html">idt</a> to view your
<a href="../Document/glossary.html#NCGM">NCGM</a> files.
<p>

This variable must be set to the IP address or name of the machine you
want to display your graphics on, for example "localhost:13.0" . If
you are not running on a remote machine, then you can try setting it
to ":0.0". Please contact your system administrator if you are not
sure what to set it to.
<p>

For example, from C-shell (csh):

<pre>
    setenv DISPLAY :0.0
    setenv DISPLAY 128.117.14.12:0
    setenv DISPLAY localhost:13.0
</pre>

From bash:

<pre>
    export DISPLAY=:0.0
    export DISPLAY=128.117.14.12:0
    export DISPLAY=localhost:13.0
</pre>
<p>

<a name="CopyHLURESFILE"></a>
<li><b>Put a ".hluresfile" file in your home directory</b><p>

In order to better customize the NCL graphical environment, we highly
recommend that you copy a <a
href="../Document/Graphics/hlures.html">.hluresfile</a> to your home
directory. You can customize this file to your liking, but at a
minimum, you want to change the default font, the default color table,
and the text function code.
<p>

<a name="OPeNDAPInstructions"></a>

<li><b>Special instructions if you have an
<a href="../Document/glossary.html#OPeNDAP">OPeNDAP</a>-enabled version of NCL</b><p>

[You don't need to worry about these instructions if you are not 
using OPenDAP.]<p>

<A HREF="../Applications/opendap.html">OPeNDAP</A>-enabled binaries
require some libraries to be installed on your host computer:

<ol>
<li><A HREF="../Download/install_ssl.html">Secure Sockets Layer</A> (SSL) library
<li><A HREF="../Download/install_dap.html">OPeNDAP</A> libraries
</ol>
<p>

Once you have these libraries, you may be required to set the
environment variable LD_LIBRARY_PATH (DYLD_LIBRARY_PATH for Macs) to
contain the directory where they are located on your host system in
order for OPeNDAP-enabled versions of NCL to work properly.  </ul>

<p><p>

<a name="basics_004"></a>
<li><i>How do I run NCL?</i>
<p>


Once you have NCL installed, you can run it interactively by
typing on the UNIX command line:

<pre>
ncl
</pre>

This will echo some information to the screen, and give you a prompt:

<pre>
 Copyright (C) 1995-2008 - All Rights Reserved
 University Corporation for Atmospheric Research
 NCAR Command Language Version 5.1.0
 The use of this software is governed by a License Agreement.
 See http://www.ncl.ucar.edu/ for more details.
ncl 0>
</pre>

To quit out of interactive mode, type "quit" (without the double quotes).
<p>

To run NCL on an existing NCL script called "myscript.ncl", type on
the UNIX command line:

<pre>
  ncl myscript.ncl
</pre>

<p><p>

<a name="basics_005"></a>
<li><i>How do I determine the version of NCL?</i>
<p>


The version number is echoed whenever you run NCL. You can also
type "ncl -V" on the UNIX command line to get the version number.

<p><p>

<a name="basics_006"></a>
<li><i>Are there any email lists I can join?</i>
<p>


Yes. For basic questions about installing NCL and setting
up your environment to use it:

<blockquote>
<a href="http://mailman.ucar.edu/mailman/listinfo/ncl-install">http://mailman.ucar.edu/mailman/listinfo/ncl-install</a>
</blockquote>

For all other questions on NCL or NCAR Graphics:

<blockquote>
<a href="http://mailman.ucar.edu/mailman/listinfo/ncl-talk">http://mailman.ucar.edu/mailman/listinfo/ncl-talk</a>
</blockquote>
 
<p><p>

<a name="basics_007"></a>
<li><i>Where can I see some examples of how to use NCL?</i>
<p>


To see hundreds of NCL application examples, see the <a href="../Applications/index.html">category list of application pages</a>.
These examples are full NCL scripts that you can download. Some of the
<a href="../Applications/Data/index.html">datasets</a> are provided 
as a separate link.
<p>

If you are a complete beginner to NCL, then there's a <a href="../Document/Manuals/Getting_Started/examples.html#NCLGSUNExamples">tutorial with examples</a> that are
described line-by-line.

<p><p>

<a name="basics_008"></a>
<li><i>Are there any NCL command line options I can use?</i>
<p>


Yes, see the "<a href="../Document/Manuals/Ref_Manual/NclCLO.html">NCL
command line options</a>" section in the <i>NCL Reference Manual</i>.

<p><p>

<a name="basics_009"></a>
<li><i>Are there any editor enhancements for editing NCL scripts?</i>
<p>


Yes, see the <a href="../Support/index.html">support page</a> for a list.

<p><p>

<a name="basics_010"></a>
<li><i>If I'm running NCL interactively, are there any command-line shortcuts I can use?</i>
<p>


There are shortcuts that allow you to navigate through previous
commands and edit them. For more information, go to the "<inforef
uri="NCLREFDIR/NclCommandLine.html">NCL Command Line
Shortcuts</a>" section in the <i>NCL Reference Manual</i>.

<p><p>

<a name="basics_011"></a>
<li><i>If I'm running interactively, how can I load some existing NCL code?</i>
<p>


You can use the <a href="../Document/Functions/Built-in/loadscript.html"><strong>loadscript</strong></a> procedure, where you
give it the name of the file that contains NCL commands.

<p><p>

<a name="basics_012"></a>
<li><i>Is there anyway I can turn off the preceding "(<i>n</i>)" output when I print a bunch of values?</i>
<p>


If you are using <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a> to print some values, and
you see output like this:

<pre>
Variable: x
Type: float
Total Size: 80 bytes
            20 values
Number of Dimensions: 1
Dimensions and sizes:   [20]
Coordinates: 
(0)      0
(1)     0.5263158
(2)     1.052632
(3)     1.578947
(4)     2.105263
(5)     2.631579
. . .
</pre>

then you can get rid of the "(0)", "(1)", etc, by using the <a
href="../Document/Manuals/Ref_Manual/NclCLO.html">"-n" command line
option</a> when you invoke "ncl". Your output will then look like:

<pre>
Variable: x
Type: float
Total Size: 80 bytes
            20 values
Number of Dimensions: 1
Dimensions and sizes:   [20]
Coordinates: 
 0
0.5263158
1.052632
1.578947
2.105263
2.631579
. . .
</pre>

<p><p>

<a name="basics_013"></a>
<li><i>My NCL script is quitting suddenly, and I'm not sure where and/or why.</i>
<p>


If you are running an NCL script and getting a "bus error" or
"segmentation fault" (which technically shouldn't happen, but does on
occasion), then try commenting out your "begin" and "end" statement
for the main code, and running your script with the <a
href="../Document/Manuals/Ref_Manual/NclCLO.html">"-x" command line
option</a>:

<pre>
  ncl -x <i>your_script.ncl</i>
</pre>

This will cause every line of your script to be echoed to the screen,
and you will be able to see where it is quitting suddenly.

<p><p>

<a name="basics_014"></a>
<li><i>How do I tell if I have an OPeNDAP-enabled NCL?</i>
<p>


A quick way is to do an "ldd" or "otool -L" on the "ncl" executable to
see if it references libraries like "libnc-dap.so" and
"libdapclient.so".  This will indicate your version of NCL was built
with <a href="../Document/glossary.html#OPeNDAP">OPeNDAP</a> capabilities enabled:

<pre>
  ldd `which ncl`
</pre>

You should see output like:

<pre>
  libnc-dap.so.3 => /usr/local/lib/libnc-dap.so.3 (0x0000002a95557000)
  libdap.so.6 => /usr/local/lib/libdap.so.6 (0x0000002a956ee000)
  libdapclient.so.1 => /usr/local/lib/libdapclient.so.1 (0x0000002a958b9000)
</pre>

Here's short test to see if your OPeNDAP-enabled NCL is working. Note
that you must be on a system that allows OPeNDAP access:

<pre>
  url = "http://test.opendap.org/opendap/data/nc/" 
  filename = "123.nc" 
  exists = <a href="../Document/Functions/Built-in/isfilepresent.html"><strong>isfilepresent</strong></a>(url+filename) 
  if(.not.exists) then 
    print("OPeNDAP isfilepresent test unsuccessful.") 
    print("Either you don't have the appropriate permissions to access OPeNDAP servers, or NCL does not have OPeNDAP capabilities on this system") 
    status_exit(1) 
  else 
    <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>("OPeNDAP isfilepresent test successful.") 
    f = <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>(url + filename,"r") 
    vars = <a href="../Document/Functions/Built-in/getfilevarnames.html"><strong>getfilevarnames</strong></a>(f) 
    vars_out = (/"l","j","i","cross","aloan","shot","order","bears"/) 

    <a href="../Document/Functions/Built-in/sqsort.html"><strong>sqsort</strong></a>(vars) 
    <a href="../Document/Functions/Built-in/sqsort.html"><strong>sqsort</strong></a>(vars_out) 

    <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(vars)         ; These two lists should
    <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(vars_out)     ; be the same.
  end if 
</pre>

<p><p>

</ol><p>


<h3>NCL core language</h3>
<p>

<ol>
<a name="core_lang_001"></a>
<li><i>How do I comment a line in NCL? Is there a way to have a block of comments?</i>
<p>


The comment character in NCL is a semicolon (';'). You can use it on a line
by itself or after an NCL command:

<pre>
; Here is a comment before a command that assigns a variable.
  x = 5.

  x = 5.     ; This comment can be at the end of a line
</pre>

Block comments are a new feature in NCL 6.4.0. Surround the lines to be commented out
by <code>/;</code>  and <code>;/</code> characters, as in:
<p>
<pre>
/;
   All this text is
   now part of a 
   multi-line comment.
;/
</pre>

Prior to NCL version 6.4.0, there 
unfortunately was no way to designate a block of comments, other
than putting semicolons in front of all the lines:
<p>
<pre>
;
; This is a block of comments,
; each of which must be 
; preceded by its own semicolon
;
</pre>

<p><p>

<a name="core_lang_002"></a>
<li><i>Is there a continuation character in NCL?</i>
<p>


Yes, you can use the '\' character:

<pre>
  x = (/"This", "is", "a", "long", "array", "of", "strings", "that", \
        "we", "can", "continue", "on", "a", "new", "line", "with", "a", \
        "\", "character."/)

; Can use \ for arithmetic expressions
  output(i,1:n-2) = (p4)*(var( i-1, 1 : n-2 ) + var( i,   2 : n-1)  + \
                          var( i+1, 1 : n-2 ) + var( i,   0 : n-3)) + \
                    (q4)*(var( i-1, 0 : n-3 ) + var( i-1, 2 : n-1)  + \
                          var( i+1, 2 : n-1 ) + var( i+1, 0 : n-3))
</pre>

<p><p>

<a name="core_lang_003"></a>
<li><i>How do I easily convert a number to a string?</i>
<p>


Use the '+' string concatenator:

<pre>
  x   = 3.14
  str = "" + x
</pre>
<p>

Use <a href="../Document/Functions/Built-in/sprinti.html"><strong>sprinti</strong></a> or <a href="../Document/Functions/Built-in/sprintf.html"><strong>sprintf</strong></a> for
formatted strings.

<p><p>

<a name="core_lang_004"></a>
<li><i>How do I create a new variable that doesn't contain a _FillValue attribute?</i>
<p>


<pre>
  x = <a href="../Document/Functions/Built-in/new.html"><strong>new</strong></a>(5, float, "No_FillValue")
</pre>

<p><p>

<a name="core_lang_005"></a>
<li><i>How do I create a double, long, short, or byte variable without using "new" or one of the conversion routines, like "<a href="../Document/Functions/Built-in/integertobyte.html"><strong>integertobyte</strong></a>"?</i>
<p>


<pre>
  x = 1.d      ; double, x = 1d   (also acceptable)
  l = 1l       ; long
  s = 5h       ; short
  b = 1b       ; byte
</pre>

The long, short, and byte literals were added in <a href="../prev_releases.html#5.1.0">V5.1.0</a>.


<p><p>

<a name="core_lang_006"></a>
<li><i>How do I include the double quote (") character in an NCL string?</i>
<p>


Since NCL uses double quotes to denote strings, you have to add an
extra step to get them into a string. As of V5.1.1, we have a new
function <a href="../Document/Functions/Built-in/str_get_dq.html"><strong>str_get_dq</strong></a> for retrieving the double
quote character:

<pre>
  quote = <a href="../Document/Functions/Built-in/str_get_dq.html"><strong>str_get_dq</strong></a>()
  print("The word " + quote + "string" + quote + " has double quotes around it.")
  print("'Single' quotes are no big deal.")
</pre>

If you have an older version, you can do it this way:

<pre>
  quote = <a href="../Document/Functions/Built-in/inttochar.html"><strong>inttochar</strong></a>(34)
  print("The word " + quote + "string" + quote + " has double quotes around it.")
  print("'Single' quotes are no big deal.")
</pre>

<p><p>

<a name="core_lang_007"></a>
<li><i>Can NCL prompt for user input?</i>
<p>


No, not directly, but you can use NCL's <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a>
function or its <a
href="../Document/Manuals/Ref_Manual/NclCLO.html">command line
option</a> capability to do this.  <p>

<b>"systemfunc" example</b><p>

<pre>
  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>("Enter a Number")
  ans = <a href="../Document/Functions/Built-in/toint.html"><strong>toint</strong></a>(<a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a>("read ANS; echo $ANS"))
  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>("Number * 10 = "+(ans*10))
</pre>
<p>

<b>Command line argument examples</b><p>

A more involved way is to write a shell script that queries for input
values. You can then use the NCL <a
href="../Document/Manuals/Ref_Manual/NclCLO.html">command line
argument</a> capability to pass these values as arguments on the NCL
command line.  <p>

<b>Shell script example to prompt for a float and a string</b><p>

<ol>
<li>Create a shell script called "input.sh":<p>

<pre>
#!/bin/sh 

echo -n "Enter a floating point value: "
read x
echo -n "Enter a title (no quotes): "
read title

eval ncl x=$x \'title=\"$title\"\' your_script.ncl
</pre>
<p>

<li>Create an NCL script called "your_script.ncl" that references "x"
and "title":<p>

<pre>
;---You can provide a default value for "x" and "title" instead of exiting.
  if(.not.isvar("x").or..not.isvar("title")) then
    print("No value provided for 'x' and or 'title'. Exiting")
    exit
  end if

  print("x = " + x)
  print("title = '" + title + "'")
 
  y = x * 100.
  print("y = x*100 = " + y)
</pre>
<p>

<li>Make sure "input.sh" is executable, and run it:
<p>

<pre>
  chmod 775 input.sh
  ./input.sh
</pre>
<p>

This should prompt you for a value and a title and then print some information.
<p>

</ol>
<p>

<b>C-Shell script example to prompt for a filename and a level value</b><p>

<ol>
<li>Create a c-shell script called "input.csh":<p>

<pre>
#!/bin/csh -f

echo -n "Input filename: "
set fname = $<

echo -n "Input level value: "
set level = $<

eval ncl level=$level 'fname=\""$fname"\"' your_script.ncl
</pre>

<li>Create an NCL script called "your_script.ncl" that references
"fname" and "level":<p>

<pre>
  if(.not.<a href="../Document/Functions/Built-in/isvar.html"><strong>isvar</strong></a>("fname")) then
    fname = "myfile.nc"        ; Set a default
  end if

 if(.not.<a href="../Document/Functions/Built-in/isvar.html"><strong>isvar</strong></a>("level")) then
    level = 850.             ; Set a default
  end if

  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>("filename = '" + fname + "'")
  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>("level = " + level)

;---Do some more stuff in your NCL script...
  a = <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>(fname,"r")
  T = a->T({level},:,:)     ; Read a 3D variable at a particular level.
</pre>
<p>

<li>Make sure "input.csh" is executable, and run it:
<p>

<pre>
  chmod 775 input.csh
  ./input.csh
</pre>

This will prompt you for a filename and level value, and pass this
information to the NCL script.  This particular NCL script
will assign these values to normal NCL variables, and then
use them in the script as usual.
<p>
</ol>

You can do this kind of thing with any scripting language you want,
like tcsh, bash, or even Python.

<p><p>

<a name="core_lang_008"></a>
<li><i>Is it possible to have global variables in NCL?</i>
<p>


NCL does not have an explicit way of defining "global
variables". However, NCL's scoping rules, which are similar to
Pascal's, can be used to simulate "global variables" For more
information, see the <a
href="../Document/Manuals/Ref_Manual/index.html">NCL
reference manual</a>, specifically, the NCL <a
href="../Document/Manuals/Ref_Manual/NclStatements.html#Scoping">statement</a> documentation.
<p>

In a nutshell, if you define a variable <i>above</i> a function,
procedure, or the main code, you can reference it in that
function, procedure, or main code:
<p>

<pre>
PI = 3.14157   ; Use some naming convention for
               ; global variables [here, all caps]

function area_circ(r:numeric)
begin
  return(PI*(r^2))
end

; Main code
begin
  print("PI = " + PI)
  radius = 1.5

  area = area_circ(radius)
  print("area of a circle with radius " + radius + " = " + area)
end

</pre>
<p><p>

<a name="core_lang_009"></a>
<li><i>How can I delete multiple NCL variables with one statement?</i>
<p>


In version 6.0.0 and later, you can delete multiple variables of mixed
types and sizes by using the <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a> procedure and
the special syntax "[/" and "/]" around the variables you want to
delete: <p>

<pre>
  lat  = <a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a>(-90,90,64)
  lon  = <a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a>(-180,180,128)
  data = <a href="../Document/Functions/Built-in/random_uniform.html"><strong>random_uniform</strong></a>(-10,10,(/10,20,30/))
  varnames = (/"T","P","U","V"/)    ; 1D string array
  . . .
  <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a>([/data,varnames,lat,lon/])

  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(lon(0))    ; This will produce an error that "lon" is undefined
</pre>

This is currently in alpha-test mode.

<p><p>

<a name="core_lang_010"></a>
<li><i>How do I delete a named dimension?</i>
<p>


Unfortunately, this is not possible. If we get a lot of requests for
this capability, then we'll consider adding this functionality.
You can set a named dimension to  "", but this is not quite
the same thing:

<pre>
  x = (/1,2,3/)
  x!0 = "this"
  print(x)
  x!0 = ""
  print(x)
</pre>

<p><p>

<a name="core_lang_011"></a>
<li><i>Is there a way to see the loaded variables and their dimensions in NCL similar to "whos" in matlab?</i>
<p>


See the <a href="../Document/Functions/Built-in/list_vars.html"><strong>list_vars</strong></a> procedure.

<p><p>

<a name="core_lang_012"></a>
<li><i>I'm getting an unexpected value when I use the power ('^') operator combined with a negative value.</i>
<p>


The negation operator ('-') has the highest precedence in an NCL
expression, potentially producing unexpected results. For example, the
following expression:

<pre>
    x = - 3^2
</pre>

yields a value of 9 because it behaves as:

<pre>
    x = (-3)^2
</pre>

Note how the use of parentheses can change the results:

<pre>
    print(- (3+2)^2)      ----> yields 25
</pre>

whereas:

<pre>
    print(- ((3+2)^2))    ---->  yields -25
</pre>
<p>

Finally, if the '-' symbol appears between two expressions or numbers,
then it is treated as a minus rather than negation. Hence, the
following yields a value of 9:

<pre>
    x = 0 - 3^2      ; equivalent to  x = (0) - (3^2)
</pre>

<p><p>

<a name="core_lang_013"></a>
<li><i>How do I create a list of string integers with leading zeros ("008", "009", "010", etc)?</i>
<p>


Use the <a href="../Document/Functions/Built-in/sprinti.html"><strong>sprinti</strong></a> function with a format like "%0.i"
(the "%0" indicates to fill in the strings with leading zeros where
possible).

For example:
<pre>
  ii  = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(0,100,1)
  iis = <a href="../Document/Functions/Built-in/sprinti.html"><strong>sprinti</strong></a>("%0.3i",ii)   ; "000", "001", ... "100"
</pre>

<p><p>

<a name="core_lang_014"></a>
<li><i>How do I get the current date into NCL as a string?</i>
<p>


Use the <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a> function, which executes a
UNIX system call and returns the output as a string:

<pre>
    datestr = systemfunc("date")
</pre>

<p><p>

<a name="core_lang_015"></a>
<li><i>How do I get a list of files into an array of strings in NCL?</i>
<p>


Use the <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a> function with the UNIX "ls"
command:

<pre>
    filenames = systemfunc("ls *.txt")
</pre>

<p><p>

<a name="core_lang_016"></a>
<li><i>How can I recursively get a list of files in a directory tree into NCL?</i>
<p>


Use the <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a> function with the UNIX "find"
command:

<pre>
    filenames = <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a>("find /home/haley/data -type f -print")
</pre>

If you are looking for a specific set of files, like ones that end in
".nc", use the "-name" option:
<p>

<pre>
    filenames = <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a>("find /home/haley/data -name '*.nc' -type f -print")
</pre>

<p><p>

<a name="core_lang_017"></a>
<li><i>How do I concatenate strings and values in NCL?</i>
<p>


You can use the "+" operator, which will automatically recognize when you
are operating on strings. You can also concatenate strings with
other NCL variable types, like float and integers. For example, the
following NCL code snippet:

<pre>
  month    = 1
  day      = 21
  year     = 2002
  date_str = "The date is " + month + "/" + day + "/" + year
</pre>

will produce the string "The date is 1/21/2002".
<p>

You can use the functions <a href="../Document/Functions/Built-in/sprinti.html"><strong>sprinti</strong></a> and
<a href="../Document/Functions/Built-in/sprintf.html"><strong>sprintf</strong></a> to generate formatted strings.  For
example, if you want to construct filenames on the fly with names like
"sw001.out", "sw002.out",..., "sw010.out", your code would look
something like this:

<pre>
  do i=1,10
    filename = "sw" + <a href="../Document/Functions/Built-in/sprinti.html"><strong>sprinti</strong></a>("%0.3i",i) + ".out"
    ...do something with <i>filename</i>...
  end do
</pre>

<p><p>

<a name="core_lang_018"></a>
<li><i>How do I retrieve an environment variable in NCL?</i>
<p>


Use the function <a href="../Document/Functions/Built-in/getenv.html"><strong>getenv</strong></a>:

<pre>
    env_str = <a href="../Document/Functions/Built-in/getenv.html"><strong>getenv</strong></a>("PATH")
</pre>

<p><p>

<a name="core_lang_019"></a>
<li><i>How do I print nicely formatted, multiple columns of data in NCL?</i>
<p>


There are several functions that will nicely
format 2D arrays using a user-specified format string. The original
procedure was <a href="../Document/Functions/Built-in/write_matrix.html"><strong>write_matrix</strong></a>. This can write to
either a text file or to standard out. It is limited to
one variable of the same type. It use fortran style format syntax. 
Two new procedures were introduced in NCL version 6.1.0:
<a href="../Document/Functions/Built-in/print_table.html"><strong>print_table</strong></a> and <a href="../Document/Functions/Built-in/write_table.html"><strong>write_table</strong></a>.
These can handle variables of mixed type. Please see the documentation
and examples for these procedures.  
<p>

Here's an example on how to use <a href="../Document/Functions/Built-in/write_matrix.html"><strong>write_matrix</strong></a>:<p>

<pre>
  N    = 5
  M    = 7
  ave  = 0.0
  std  = 5.0
  x    = <a href="../Document/Functions/Built-in/random_normal.html"><strong>random_normal</strong></a>(ave, std, (/N,M/))  

  <a href="../Document/Functions/Built-in/write_matrix.html"><strong>write_matrix</strong></a>(x, "5f7.2", False)
</pre>

This example will produce the following output:

<pre>
   4.35   4.39   0.27  -3.35  -6.90
   4.36   4.66   3.77  -1.66   4.06
   9.73  -5.84   0.89   8.46  10.39
   4.91   4.59  -3.09   7.55   4.56
   1.77   3.68   5.08   0.14  -5.63
  -0.63 -14.12  -2.51   1.76  -1.43
  -4.29   0.07   5.85   0.87   8.65
</pre>

A more complicated method is to write a C or Fortran subroutine to
print the data as you want it, and then use <B>wrapit77</B> as
described in the section "<a href="#wrapit77">using the wrapit77 application</a>" in the
<i>NCL Reference Manual</i>. There's an example on <a href="../Document/Tools/WRAPIT.html#Example_5">2-dimensional
array printing</a> in the <i>WRAPIT</i> guide.  <p>

The functions <a href="../Document/Functions/Built-in/sprinti.html"><strong>sprinti</strong></a> and
<a href="../Document/Functions/Built-in/sprintf.html"><strong>sprintf</strong></a> can also be used to generate formatted
output.

<p><p>

<a name="core_lang_020"></a>
<li><i>Can multiple variables be returned from a user created function?</i>
<p>

<p>
Yes. However, it not as direct as (say) Matlab. In NCL, the return
argument must be of type list. This can contain variables of different
types and sizes.
<pre>

A schematic example:

    undef("foo")
    function foo(...)
    begin
      :
      :
      x = ..   ; type float    (:,:)
      y = ..   ; type double   (:,:,:,:)
      z = ..   ; type string   (1)  a scalar
      i = ..   ; type integer  (:)

      return( <b>[/</b> x, y, z, i <b>]</b> )  ; return as variable of type <b>list</b>
    end

    ans = foo(...)

    printVarSummary(ans)          ; variable of type list

    x   = ans<b>[0]</b>                  ; explicitly extract each return variable
    y   = ans<b>[1]</b>                  ; [..] syntax is for variable of type list
    z   = ans<b>[2]</b>
    i   = ans<b>[3]</b>
    delete(ans)

Note: There is no need to explicitly extract the list variables.
       They could be accessed as components of 'ans'


Please see the Mini-Language Manual:  Sections 2.18 and 5.7
Click "Support" at top of NCL home page ... Manuals
http://www.ncl.ucar.edu/Document/Manuals/language_man.pdf

Also: http://www.ncl.ucar.edu/Document/Manuals/Ref_Manual/NclVariables.shtml

</pre>

<p><p>

</ol><p>


<h3>File input/output</h3>
<p>

<ol>
<a name="file_io_001"></a>
<li><i>What's the easiest way to convert a GRIB1, GRIB2, HDF 4, or HDF-EOS 2 file to a NetCDF file?</i>
<p>


On the UNIX command line:

<pre>
  <a href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a> your_file.<i>xxx</i>
</pre>

where <i>xxx</i> is the file suffix, like "grb", "hdf", or "hdfeos"
(other file extensions are recognized).
<p>

If you need to write an NCL script to do the conversion, see the <a
href="../Applications/write_netcdf.html">output netcdf applications
page</a>.
<p>

For more information on supported file formats in NCL, see the
"<a href="../Document/Manuals/Ref_Manual/NclFormatSupport.html">Information on
supported data formats</a>" section in the <I><a href="../Document/Manuals/Ref_Manual/index-2.html">NCL Reference Manual</a></I>.

<p><p>

<a name="file_io_002"></a>
<li><i>How do I dump the contents of a GRIB, HDF, or HDF-EOS file (or variable on the file) to the screen?</i>
<p>


Use <a href="../Document/Tools/ncl_filedump.html">ncl_filedump</a>
on the UNIX command line. Some examples:

<pre>
  ncl_filedump ced1.lf00.t00z.ega.grb
  ncl_filedump -v PRES_6_SFC -ftime ced1.lf00.t00z.ega.grb
</pre>

Type "ncl_filedump -h" for a usage message.

<p><p>

<a name="file_io_003"></a>
<li><i>How do I convert a large file to a NetCDF file?</i>
<p>


If you are using <a
href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a> to
convert a supported file (like GRIB) to a NetCDF file, and getting the
error message:

<pre>
   ncendef: ncid 0: NetCDF: One or more variable sizes violate format
                            constraints
</pre>
<p>

then try the <a href="../Document/Tools/ncl_convert2nc.html#LargeFile">"-L"</a> option:

<pre>
    ncl_convert2nc U12345.grb -L
</pre>

<p><p>

<a name="file_io_004"></a>
<li><i>How do I write a large (> 2 GB) variable to a netCDF file?</i>
<p>


In order to write large variables to a NetCDF file, you have to set the
NetCDF "Format" option to "LargeFile" or to "NetCDF4Classic".  This
requires calling <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a>
and setting the "Format" using one of these three calls:
<p>

<pre>
  <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a>("nc","Format","LargeFile") 

or

  <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a>("nc","Format","NetCDF4Classic")

or

  <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a>("nc","Format","NetCDF4")
</pre>

The reason you have to set this option is that the NetCDF library
requires that this decision be made when the file is first created,
before there is any knowledge of the size of variables that will be
written. We may eventually make this this default, but the current
recommendation from Unidata is to maintain backwards compatibility
where possible for apps that can only deal with the original small
file format of NetCDF.
<p>

This will make NCL create a NetCDF4 file, which has no limitation on variable size.
<p>

NOTE:
<p>

  For any of the above three options to function properly,
  "setfileoption" must be called prior to <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>("filename.nc", "c").

<p><p>

<a name="file_io_005"></a>
<li><i>How do I get the latest tables for reading GRIB files?</i>
<p>


<b>GRIB1</b><p>
You can use your own text-based tables that you can update
yourself. Start with text-based tables that are downloadable
from our website at <a href="../Document/Manuals/Ref_Manual/NclFormatSupport.html#GRIB1-built-in-parameter-tables">http://www.ncl.ucar.edu/Document/Manuals/Ref_Manual/NclFormatSupport.shtml#GRIB1-built-in-parameter-tables</a>.
<p>

Click on any of the built-in tables and you will find a link to a
downloadable text-based version that you can use if you set <a href
="../Document/Language/env.html#NCL_GRIB_PTABLE_PATH">NCL_GRIB_PTABLE_PATH</a>
appropriately. Also read the next section entitled "<a href="../Document/Manuals/Ref_Manual/NclFormatSupport.html#GRIB1-user-defined-parameter-tables">User-defined GRIB1
parameter tables</a>".<p>

<b>GRIB2</b><p>

Except for parameters in files created for the TIGGE project, GRIB2
parameters are all defined in text files contained in the
grib2_codetables directory tree. By default this directory is found at
$NCARG_ROOT/lib/ncarg/grib2_codetables. If you want to add parameters
or modify the name, description, or units of any number of parameters, copy the complete directory
tree to your own location, and then set the environment variable <a
href="../Document/Language/env.html#NIO_GRIB2_CODETABLES">NIO_GRIB2_CODETABLES</a>
to the path of this location. The files that relate specifically to
parameter tables can be found in the parallel subdirectories ecmwf/4/ and
ncep/4. They have names of the form <code>4.2.*.*.table</code>. 
Just be sure to maintain the format of these files when modifying or adding
to them. Basically each line contains 5 fields separated by
colons. The parameter number is repeated:

<pre>
param number:param number:description (long_name attribute):units:short name (must not contain spaces or non-alphanumeric characters)
</pre>
Example:
<pre>
0:0:Temperature:K:TMP
</pre>

<p><p>

<a name="file_io_006"></a>
<li><i>Why have some of my GRIB2 variable names changed since I updated to NCL <a href="../prev_releases.html#5.2.0">V5.2.0</a>?</i>
<p>


If necessary, you can change them back the way they were by setting the environment variable <a
href="../Document/Language/env.html#NIO_GRIB2_CODETABLES">NIO_GRIB2_CODETABLES</a> to the path: 
$NCARG_ROOT/lib/ncarg/grib2_codetables.previous. See the release notes for <a href="../current_release.html#GRIBUpdates5.2.0">5.2.0 GRIB Updates</a> for an explanation of why they have changed. 
<p><p>

<a name="file_io_007"></a>
<li><i>How do I write a scalar to a NetCDF file?</i>
<p>


The first way is to use "ncl_scalar" as a dimension name:

<pre>
spherical = new(1,"character") 
spherical!0 = "ncl_scalar" 
spherical = <a href="../Document/Functions/Built-in/tochar.html"><strong>tochar</strong></a>(1)
ncid->spherical = spherical 
</pre>

The second way is to use <a href="../Document/Functions/Built-in/filevardef.html"><strong>filevardef</strong></a>:

<pre>
filevardef(ncid, "spherical","character","ncl_scalar") 
ncld->spherical = tochar(1) 
</pre>

Note that for either of these methods, if you look at this file in NCL
it will appear as if there is a dimension named "ncl_scalar". In an
ncdump of the file, however, the dimension will not appear, so the
variable <i>is</i> a true NetCDF scalar.

<p><p>

<a name="file_io_008"></a>
<li><i>How do I retain metadata for a variable that was read off a series of files using "addfiles"?</i>
<p>


Use a special function from <a
href="../Document/Functions/Contributed/contrib.html">contributed.ncl</a>
called <a href="../Document/Functions/Contributed/addfiles_GetVar.html"><strong>addfiles_GetVar</strong></a>. For
example:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/contributed.ncl" 
                                     
  fils = <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a>("ls /model/annual*nc")

  f    = <a href="../Document/Functions/Built-in/addfiles.html"><strong>addfiles</strong></a>(fils, "r")
  T    = <a href="../Document/Functions/Contributed/addfiles_GetVar.html"><strong>addfiles_GetVar</strong></a>(f,fils,"T")
  <a href="../Document/Functions/Built-in/printVarSummary.html"><strong>printVarSummary</strong></a>(T)
</pre>


<p><p>

<a name="file_io_009"></a>
<li><i>How do I access an NCL file variable, attributes, or coordinate arrays if they have hyphens/dashes ('-') in the name?</i>
<p>


If you have an NCL file variable with hyphens in the name (for
example, "<TT>in-&gt;Data-Set-14</TT>"), then you will get an error
message if you try to access this variable directly. This is because
NCL treats the hyphens as minus symbols:<p>

<pre>
ncl> <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(in->Data-Set-14) 
fatal:Either file (in) isn't defined or variable (Data) is not a variable in the file
fatal:Execute: Error occurred at or near line 24
</pre>

To get around this problem, turn the name of the variable into a string,
and enclose the string in dollar signs ('$'):

<pre>
  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(in->$"Data-Set-14"$)
</pre>
<p>

or

<pre>
  var_string = "Data-Set-14"
  print(in->$var_string$)
</pre>
<p>

You can also use $$ for attribute names:
<p>

<pre>
  lname = data@$"long-name"$ 
</pre>
<p>

For more information on using '$' to reference file variables, see the
section "<a href="../Document/Manuals/Ref_Manual/NclVariables.html#FileStringRef">File variable string references</a>" in
the <I><a href="../Document/Manuals/Ref_Manual/index-2.html">NCL Reference
Manual</a></I>.

<p><p>

<a name="file_io_010"></a>
<li><i>How do I read/write NetCDF, HDF4, HDF-EOS2, GRIB1, GRIB2, or CCM History Tape files?</i>
<p>


To open any one of these types of files, use the
<a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a> function, which opens a data file and
returns a pointer to the file.  Once you have a pointer to the file,
you have access to all of its global and variable attributes and
coordinate arrays. You can also use <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a> to open
a NetCDF or HDF file for writing (not GRIB1, GRIB2, HDF-EOS2, or CCM
files, since you can't write these files in NCL).
<p>

For example, to open a GRIB file and write some of its variables to
a NetCDF file:

<pre>
begin
  grib_file  = addfile("ced1.lf00.t00z.eta.grb","r")  ; Open GRIB file to read
  ncfile_out = addfile("data.nc","c")             ; Open NetCDF file to write

; Write some data to NetCDF file.
  ncfile_out->PRES  = grib_file->PRES_6_SFC 
  ncfile_out->HGT   = grib_file->HGT_6_SFC 
  ncfile_out->A_PCP = grib_file->A_PCP_6_SFC_acc
  ncfile_out->NCPCP = grib_file->NCPCP_6_SFC_acc
  ncfile_out->ACPCP = grib_file->ACPCP_6_SFC_acc
  ncfile_out->CAPE  = grib_file->CAPE_6_SFC
end
</pre>
<p>

For some more complex examples, see the <a href="../Applications/list_io.html">file I/O application
examples</a>.
<p>

For detailed information on the file formats that NCL supports, see
the "<a href="../Document/Manuals/Ref_Manual/NclFormatSupport.html">Information on
supported data formats</a>" section in the <I><a href="../Document/Manuals/Ref_Manual/index-2.html">NCL Reference Manual</a></I>.

<p><p>

<a name="file_io_011"></a>
<li><i>How do I read/write ASCII files?</i>
<p>


Use the <a href="../Document/Functions/Built-in/asciiread.html"><strong>asciiread</strong></a> function to read an ASCII file
and the <a href="../Document/Functions/Built-in/asciiwrite.html"><strong>asciiwrite</strong></a> or
<a href="../Document/Functions/Built-in/write_matrix.html"><strong>write_matrix</strong></a> procedures to write an ASCII file.
<p>

Here's an example:

<pre>
;
; Assume the "oceanland30e.asc" file contains a single column of integers,
; 16471 of them. "asciiread" allows you to specify the dimensionality of
; the data, and in this case we are passing dimensions (/91,181/), so
; "ocean1" will be a 2-dimensional array dimensioned 91 x 181, which can
; be verified by printing the dimsizes of "ocean1."
;
  ocean1 = asciiread("oceanland30e.asc",(/91,181/),"integer")
  print(dimsizes(ocean1))

;
; Write out part of "ocean1" to a new ASCII file.  "data.asc" will contain
; 15 integers, since (7:3:2,0:4) is a 3 x 5 array.
;	
  asciiwrite("data.asc",ocean1(7:3:2,0:4))
</pre>
<p>

For more complex examples, see the ASCII read/write examples in
the list of <a href="../Applications/list_io.html">file I/O application
examples</a>.

<p><p>

<a name="file_io_012"></a>
<li><i>How do I read CSV files?</i>
<p>


See the "<a href="../Applications/read_csv.html">Reading CSV files
application</a>" applications page.

<p><p>

<a name="file_io_013"></a>
<li><i>How do I write a formatted ASCII file?</i>
<p>


Use a function called <a href="../Document/Functions/Built-in/write_matrix.html"><strong>write_matrix</strong></a> that will nicely
format 2D arrays using a user-specified format string.  <p>

Here's an example that writes a 2D array to a file called
"file.txt":

<pre>
  N    = 5
  M    = 7
  ave  = 0.0
  std  = 5.0
  x    = <a href="../Document/Functions/Built-in/random_normal.html"><strong>random_normal</strong></a> (ave, std, (/N,M/))  

  res = True
  res@fout = "file.txt"
  <a href="../Document/Functions/Built-in/write_matrix.html"><strong>write_matrix</strong></a> (x, "5f7.2", res)
</pre>

This example will produce the following output in "file.txt":

<pre>
   4.35   4.39   0.27  -3.35  -6.90
   4.36   4.66   3.77  -1.66   4.06
   9.73  -5.84   0.89   8.46  10.39
   4.91   4.59  -3.09   7.55   4.56
   1.77   3.68   5.08   0.14  -5.63
  -0.63 -14.12  -2.51   1.76  -1.43
  -4.29   0.07   5.85   0.87   8.65
</pre>

<p><p>

<a name="file_io_014"></a>
<li><i>How do I read an ASCII file if I don't know how many lines it contains?</i>
<p>


There are two ways you can do this:

<ol>

<li>Use "-1" in the second argument to <a href="../Document/Functions/Built-in/asciiread.html"><strong>asciiread</strong></a>:

<pre>
   z = <a href="../Document/Functions/Built-in/asciiread.html"><strong>asciiread</strong></a>("file.dat",-1,float)
</pre>

If you have multiple columns of data, and you know how many columns
there are, then you can use <a href="../Document/Functions/Built-in/onedtond.html"><strong>onedtond</strong></a> to restructure
the one-dimensional array returned from
<a href="../Document/Functions/Built-in/asciiread.html"><strong>asciiread</strong></a>. In the example below, assume there are 4
columns of data:

<pre>
   z = <a href="../Document/Functions/Built-in/asciiread.html"><strong>asciiread</strong></a>("file.dat",-1,"float")

   ncol = 4                            ; number of columns
   nrow = <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(z)/ncol            ; get number of points
   znew = <a href="../Document/Functions/Built-in/onedtond.html"><strong>onedtond</strong></a>(z,(/nrow,ncol/))   ; znew will be nrow x ncol
</pre>

<li>Use <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a> to count the number of lines in
the file before you read it. Assuming again that you have a data
file with 4 columns of data:

<pre>
    ncol = 4
    nrow = <a href="../Document/Functions/Built-in/toint.html"><strong>toint</strong></a>(<a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a>("wc -l wgt"))  ; "wc -l" returns the #
                                                     ; of lines in a file
    z = <a href="../Document/Functions/Built-in/asciiread.html"><strong>asciiread</strong></a>("file.dat",(/nrow,ncol/),"float")
</pre>

</ol>

<p><p>

<a name="file_io_015"></a>
<li><i>How do I read an ASCII file that contains delimiters?</i>
<p>


There's an <a href="../Applications/read_ascii.html">applications
page</a> that describes a script that reads an ASCII file with
delimiters, and creates a netCDF file that contains all the data.
This script assumes that the first line of your ASCII file
contains the names of the fields, and uses these names as variable
names on the netCDF file.

<p><p>

<a name="file_io_016"></a>
<li><i>How do I read/write binary files?</i>
<p>


Use the appropriate <a href="../Document/Functions/Built-in/cbinread.html"><strong>cbinread</strong></a>,
<a href="../Document/Functions/Built-in/cbinwrite.html"><strong>cbinwrite</strong></a>, <a href="../Document/Functions/Built-in/craybinrecread.html"><strong>craybinrecread</strong></a>,
<a href="../Document/Functions/Built-in/fbindirread.html"><strong>fbindirread</strong></a>, <a href="../Document/Functions/Built-in/fbindirwrite.html"><strong>fbindirwrite</strong></a>,
<a href="../Document/Functions/Built-in/fbinread.html"><strong>fbinread</strong></a>, <a href="../Document/Functions/Built-in/fbinrecread.html"><strong>fbinrecread</strong></a>,
<a href="../Document/Functions/Built-in/fbinrecwrite.html"><strong>fbinrecwrite</strong></a>, or <a href="../Document/Functions/Built-in/fbinwrite.html"><strong>fbinwrite</strong></a>
function, depending on what type of binary file you have.  In
addition, you may also want to use the functions
<a href="../Document/Functions/Built-in/craybinnumrec.html"><strong>craybinnumrec</strong></a> or <a href="../Document/Functions/Built-in/fbinnumrec.html"><strong>fbinnumrec</strong></a> for
getting the number of unformatted Fortran records in a file.  <p>

For some complex examples, see the binary read/write examples in
the list of <a href="../Applications/list_io.html">file I/O application
examples</a>.
<p>

See the <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a> procedure for ways to change
how your binary file is read/written (big endian versus little endian,
for example).

<p><p>

<a name="file_io_017"></a>
<li><i>Once I've opened a file with "addfile", how do I find out what variables and attributes it contains?</i>
<p>


Use the functions <a href="../Document/Functions/Built-in/getfilevaratts.html"><strong>getfilevaratts</strong></a>,
<a href="../Document/Functions/Built-in/getfilevardims.html"><strong>getfilevardims</strong></a>, and
<a href="../Document/Functions/Built-in/getfilevarnames.html"><strong>getfilevarnames</strong></a> to retrieve the list of attribute
names for a file variable, the list of dimension names for a file
variable, or the list of variable names for a file, respectively.

<p><p>

<a name="file_io_018"></a>
<li><i>Is there a way to control whether my binary file is read or written as little endian or big endian?</i>
<p>


Use the <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a> procedure:

<pre>
  <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a>("bin","ReadByteOrder","LittleEndian")
  v = <a href="../Document/Functions/Built-in/cbinread.html"><strong>cbinread</strong></a>("data.littleEndian.bin",-1,"float")

  <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a>("bin","WriteByteOrder","BigEndian")
  <a href="../Document/Functions/Built-in/cbinwrite.html"><strong>cbinwrite</strong></a>("data.bigEndian.bin",v)
</pre>

<p><p>

<a name="file_io_019"></a>
<li><i>I'm having trouble reading a Fortran binary file with records.</i>
<p>


It's possible you are running into a problem where the record marker
was written with 8 bytes, and NCL is expecting the marker to be 4
bytes.
<p>

This happens if the Fortran program that created the binary file was
compiled with a version of "gfortran" that sets the marker
size to whatever "off_t" is on that system.
<p>

As a work-around, you can recompile the code that created the binary
file with the option "-frecord-marker=4" to force a 4-byte record, and
run the code again to regenerate the file.
<p>

It is on our list to create a new option in
<a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a> that will allow you to specify the
record marker size that the file was written with.

<p><p>

<a name="file_io_020"></a>
<li><i>I'm trying to convert a file to a NetCDF file using "ncl_convert2nc", but getting an error message about violating format constraints.</i>
<p>


If you are trying to convert a file to NetCDF using <a
href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a>, and
getting the following error message:

<pre>
   ncendef: ncid 0: NetCDF: One or more variable sizes violate format
                            constraints
</pre>

then you may have what qualifies as a "large file". You need to use
the <a href="../Document/Tools/ncl_convert2nc.html#LargeFile">"-L"</a> option with ncl_convert2nc.

<p><p>

<a name="file_io_021"></a>
<li><i>Why do I get different results when reading my HDF-EOS2 file, depending on whether I use the ".hdf" or ".hdfeos" extension?</i>
<p>


If you use the ".hdf" extension, then NCL uses the underlying HDF4
interface to read your data, whereas if you use the "hdfeos or "he2"
extension, NCL reads the file using the HDF-EOS2 library interface.
<p>

Using the ".hdfeos" extension software will give you slightly more
information, since the HDF-EOS2 software provides software to calculate
additional lat/lon information.
<p>

Side tip: if your HDF-EOS2 file has an ".hdf" extension, then you can
force NCL to read this file as an HDF-EOS2 file simply by appending an
".he2" or ".hdfeos" to the file name in the <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>
call (you don't need to rename the file).  For example, if your file
is called "swath.hdf" and you want to read it as a HDF-EOS2, use the
following:

<pre>
  a = <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>("swath.hdf.hdfeos","r")
</pre>

<p><p>

<a name="file_io_022"></a>
<li><i>Can I read shapefiles using NCL?</i>
<p>


NCL currently does not have the ability to read shapefiles.
The NCL development team is looking into this format to determine
the best way these files might be supported.
<p>

Meanwhile, some users have emailed us with suggestions which we'll
include here:

<dl>

<dt><a href="http://www.gdal.org/">GDAL</a> - Geospatial Data
Abstraction Library

<dd>This package includes a set of command lines tools that are very
handy to work with georeferenced data format (including GeoTiff, HDF
and NetCDF): <a
href="http://www.gdal.org/gdal_utilities.html">http://www.gdal.org/gdal_utilities.html</a>.
<p>

In particular, you can rasterize vector data (like shapefiles) with
the command "gdal_rasterize".  There's an example in this post on how
to use these tools: <a
href="http://lists.osgeo.org/pipermail/gdal-dev/2006-June/009369.html">http://lists.osgeo.org/pipermail/gdal-dev/2006-June/009369.html</a>
<p>

You can also extract the polygon from the vector file into an ascii
file: <a
href="http://www.gdal.org/ogrinfo.html">http://www.gdal.org/ogrinfo.html</a>
<p>
 
<dt><a href="http://fwtools.maptools.org/">FWTools</a> package - an
open source GIS binary kit for Windows and Linux

<dd>You can use this package to convert shapefiles to text.
The "ogr2ogr" command line utility allows for
type conversion between a variety of GIS related formats (it
hasn't been verified whether NetCDF or HDF is one such format).
<p>

A user reported that he converted a shapefile to a Mapinfo file (MIF
format) which is a text format file of lon/lat pairs for each defined
region. You could then read in this text file using NCL's
<a href="../Document/Functions/Built-in/asciiread.html"><strong>asciiread</strong></a> function.

</dl>

<p><p>

<a name="file_io_023"></a>
<li><i>How can I get at vgroup data on my HDF4 file?</i>
<p>


NCL cannot (yet) read vgroup data on an HDF file.  If you install HDF4
on your system (available from <a
href="http://www.hdfgroup.org/release4/obtain.html">http://www.hdfgroup.org/release4/obtain.html</a>),
then you can use the HDF dumper program, "<a
href="http://www.hdfgroup.org/hdp.html">hdp</a>" to get at the vgroup
data you need. You first need to use "hdp dumpvd" on the file to find
out what "Vdata" index your data is in: <p>

<pre>
  hdp dumpvd calipso.hdf
</pre>
<p>

This will produce output like this:
<p>

<pre>
Vdata: 0
   tag = 1962; reference = 34;
   number of records = 1; interlace = FULL_INTERLACE (0);
   fields = [Product_ID, Date_Time_at_Granule_Start, 
                  Date_Time_at_Granule_End, 
                  Initial_Subsatellite_Latitude, 
                  Initial_Subsatellite_Longitude, 
                  Final_Subsatellite_Latitude, 
                  Final_Subsatellite_Longitude, Lidar_Data_Altitudes];
   record size (in bytes) = 1746;
   name = metadata; class = metadata;
   number of attributes = 0 
- field index 0: [Product_ID], type=4, order=80
   number of attributes = 0 
. . .
</pre>
<p>

You can see that the "Lidar_Data_Altitudes" variable is in vdata 0, so
use this with the hdp command to get the data only: <p>

<pre>
hdp dumpvd -i 0 -d -f Lidar_Data_Altitudes  calipso.hdf
</pre>
<p>
<p>

An alternative approach to extracting the Lidar_Data_Altitudes 
is to invoke the <b>hdp</b> command line operator from with an NCL
script. For example:
<pre>
; input hdf4 file name and the directory where it resides
   diri = "./"
   fili = "CAL_LID_L1-ValStage1-V3-01.2011-05-01T05-00-22ZN.hdf"

; specify desiredvariable
   vari = "Lidar_Data_Altitudes"

; output text file name and the directory where it is to be placed 
   dirh = "./"
   filh = "CAL_LID_L1-ValStage1.height.txt"

; use NCL's <b>system</b> procedure and pipe output to file
   <b>system</b>("hdp dumpvd -i 0 -d -f "+vari+" "+diri+fili+" >! "+dirh+filh)

; read the file created by the <b>hdp</b>
   hgt    = <b>asciiread</b>(dirh+filh, -1, "float")
   hgt!0  = "hgt"
   hjt@long_name = "HEIGHT"
   hgt@units     = "km"

  ;hgt    = hgt(::-1)      ; if height need to be reordered

</pre>
If you are not sure where <b>hdp</b> resides, 
from your home directory, try:
<pre>

find . -name hdp -print

</pre>
<p><p>

<a name="file_io_024"></a>
<li><i>When I run my script, I'm getting an error message "ncclose: ncid 0: NetCDF: Not a valid ID".</i>
<p>


You should only see this error if you are using version 5.0.0
of an OPeNDAP-enabled NCL. It usually occurs when you exit
the NCL script. 
<p>

We verified this is a bug created by recent changes to NCL's handling
of its internal cleanup and exit procedures. This bug has been fixed
and will be available in <a
href="../prev_releases.html#5.1.0">V5.1.0</a>.
<p>

Note that this does not cause a problem in reading NetCDF files. When
you write a file, however, you may have to delete the file handler
variable before you exit the script, by using the
<a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a> procedure:

<pre>
begin
  ...
  f = addfile("newfile.nc","w")
  ...write stuff to file pointed to by 'f'.
  <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a>(f)
end
</pre>

<p><p>

<a name="file_io_025"></a>
<li><i>When I try to access the Climate Diagnostics Center [CDC] OPeNDAP server via NCL, I get "Permission denied".</i>
<p>


It is likely that the CDC OPeNDAP server does not recognize the IP
address of the machine being used. The CDC server was shut down due to
security concerns.  They have opened the OPeNDAP server on a host by
host basis. If you wish to access the CDC OPeNDAP server, please
e-mail <a
href="mailto:esrl.psd.data@noaa.gov">esrl.psd.data@noaa.gov</a> with:

<ul>

<li>The IP address of the machine from which you wish access. This
should be a static IP address (not generated via DHCP). It would
better if this address could successfully undergo reverse DNS lookup
to produce a fully qualified hostname.

<li>The name of your institution.

<li>A one-line blurb about your intended use of the data.

</ul>
<p>


See the <a
href="http://www.cdc.noaa.gov/opendap.html">http://www.cdc.noaa.gov/opendap.html</a>
URL for the complete story.  <p>

After registration with CDC, an NCL script might look like:
<p>

<pre>
 CDC_URL  = "http://www.cdc.noaa.gov/cgi-bin/opendap/nph-nc/Datasets/" ; generic CDC
 CDC_FILP = "ncep.reanalysis.dailyavgs/pressure/air.2005.nc"     ; data path

 filp = CDC_URL + CDC_FILP
 if (<a href="../Document/Functions/Built-in/isfilepresent.html"><strong>isfilepresent</strong></a>(filp)) then
   fp = <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>(filp,"r")
 else
   print("============================================")
   print("CDC_URL : "+CDC_URL)
   print("CDC_FILP: "+CDC_FILP)
   print("does not exist: message from NCL script")
   print("============================================")
   exit
 end if

 x = fp->FOO
</pre>

<p><p>

<a name="file_io_026"></a>
<li><i>I'm running into a problem when opening lots of files with addfile or addfiles ("Too many files open").</i>
<p>


If you need to open lots of files with <a href="../Document/Functions/Built-in/addfiles.html"><strong>addfiles</strong></a>,
then call <a href="../Document/Functions/Built-in/setfileoption.html"><strong>setfileoption</strong></a> as follows, before you call
<a href="../Document/Functions/Built-in/addfiles.html"><strong>addfiles</strong></a>:

<pre>
     setfileoption("nc", "SuppressClose", False)
</pre>
<p>

The number of files you can have open at any time is dependent on your
system. A general limit seems to be around 1024.

<p><p>

</ol><p>


<h3>Data handling</h3>
<p>

<ol>
<a name="data_hand_001"></a>
<li><i>How do I set a missing value for my data?</i>
<p>


For the variable that contains your data, set the attribute "<a
href="../Document/Language/fillval.html">_FillValue</a>" to the missing
value.  For example, the following NCL code:<p>

<pre>
  x = (/1,2,3,-999,5,6,7,-999,-999,10/)
  x@_FillValue = -999
</pre>

sets the missing value of <tt>x</tt> to -999.
<p>

The "_FillValue" attribute is recognized by many NCL functions and
procedures and thus the computations will behave differently when they
encounter missing values (like ignore them or return with an error
message). For example, if you pass the above <tt>x</tt> array to the
NCL function <a href="../Document/Functions/Built-in/sum.html"><strong>sum</strong></a>, you will get a return
value of 34.
<p>

<p><p>

<a name="data_hand_002"></a>
<li><i>How do I determine if my data contains any missing values, or count how many missing values it has?</i>
<p>


Use the <a href="../Document/Functions/Built-in/ismissing.html"><strong>ismissing</strong></a> function combined with the
<a href="../Document/Functions/Built-in/any.html"><strong>any</strong></a> function to return a single True or False
indicating whether your data contains missing values: <p>

<pre>
  is_msg = <a href="../Document/Functions/Built-in/any.html"><strong>any</strong></a>(<a href="../Document/Functions/Built-in/ismissing.html"><strong>ismissing</strong></a>(data)))
  if(is_msg) then
    print("'data' contains missing values.")
  else
    print("'data' doesn't contain any missing values.")
  end if
</pre>
  
To count the number of missing values, use the <a href="../Document/Functions/Built-in/num.html"><strong>num</strong></a>
function:

<pre>
  num_msg = <a href="../Document/Functions/Built-in/num.html"><strong>num</strong></a>(<a href="../Document/Functions/Built-in/ismissing.html"><strong>ismissing</strong></a>(data)))
  print("data contains " + num_msg + " missing values.")
</pre>

<p><p>

<a name="data_hand_003"></a>
<li><i>How do I change the missing value to another value?</i>
<p>


If your data contains a "_FillValue" attribute, simply set it to the
value you want, but be sure to use the same type (float, double, etc).
<p>

For example, to change your data's missing values from 0 to -999, use:

<pre>  
  data@_FillValue = -999
</pre>

If your data contains a "missing_value" attribute, this won't
be recognized by NCL as an official missing value. You want to
set the "_FillValue" attribute to this value:

<pre>
  data@_FillValue = data@missing_value
  <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a>(data@missing_value)      ; not necessary, just cleaning up
</pre>

There are other ways to assign a _FillValue attribute. See the
<a href="../Document/Functions/Contributed/assignFillValue.html"><strong>assignFillValue</strong></a> function.

<p><p>

<a name="data_hand_004"></a>
<li><i>How do I deal with NaN (not-a-number) values in my data?</i>
<p>


The computational and plotting functions in NCL cannot handle NaN
values directly. You must first convert the NaN values to missing
values.<p>

To do this, use the <a href="../Document/Functions/Built-in/replace_ieeenan.html"><strong>replace_ieeenan</strong></a> function to
convert the NaNs to missing values. You can optionally use
<a href="../Document/Functions/Built-in/isnan_ieee.html"><strong>isnan_ieee</strong></a> to first determine if any of your values
are equal to NaN: <p>

If "x" already has a _FillValue attribute:
<pre>
  if (any(isnan_ieee(x))) then
    replace_ieeenan (x, x@_FillValue, 0)
  end if
</pre>
<p>

If "x" doesn't have a _FillValue attribute:
<p>

<pre>
  if (any(isnan_ieee(x))) then
    x@_FillValue = 1.e20                  ; or whatever value you want to use
    replace_ieeenan (x, x@_FillValue, 0)
  end if
</pre>

<p><p>

<a name="data_hand_005"></a>
<li><i>How do I deal with "Inf" (infinity) values in my data?</i>
<p>


As with NaN values, the computational and plotting functions in NCL
cannot handle "Inf" values directly. You must first convert the "Inf"
values to missing values.<p>

To do this, use the <a href="../Document/Functions/Built-in/where.html"><strong>where</strong></a> function:<p>


If "x" already has a _FillValue attribute:
<p>

<pre>
   x = where(abs(x).gt.1e20, x@_FillValue, x)
</pre>
<p>

Here's some more generic code to first check if x has a _FillValue
attribute: <p>

<pre>
  if(.not.isatt(x,"_FillValue")) then
    x@_FillValue = default_fillvalue(typeof(x))
  end if
  x = where(abs(x).gt.1e20, x@_FillValue, x)
</pre>
<p>

<p><p>

</ol><p>


<h3>Data analysis</h3>
<p>

<ol>
<a name="data_anal_001"></a>
<li><i>How do I average values in a multi-dimensioned array?</i>
<p>


Use the <a href="../Document/Functions/Built-in/avg.html"><strong>avg</strong></a>, <a href="../Document/Functions/Built-in/dim_avg_n.html"><strong>dim_avg_n</strong></a> or <a href="../Document/Functions/Built-in/dim_avg.html"><strong>dim_avg</strong></a> functions. 
<p>

For example, in the following NCL code snippet where <tt>x</tt> is a 2
x 3 x 2 array, <tt>y</tt> will be a scalar value equal to 2.916667:

<pre>
   x = (/(/(/2,3/), (/4,5/), (/1,2/)/), (/(/3,8/), (/1,4/), (/0,2/)/)/)
   y = <a href="../Document/Functions/Built-in/avg.html"><strong>avg</strong></a>(x)
</pre>

If you have a multi-dimensional array, say <i>T(ntim,klev,nlat,mlon)</i> 
and you wish to obtain the temporal mean at each level, latitude and longitude
then:

<pre>

  T_time_mean  = <a href="../Document/Functions/Built-in/dim_avg_n.html"><strong>dim_avg_n</strong></a>(temp, 0)    ; (klev,nlat,mlon)

</pre>

or, to retain meta data:

<pre>

  T_time_mean  = <a href="../Document/Functions/Contributed/dim_avg_n_Wrap.html"><strong>dim_avg_n_Wrap</strong></a>(temp, 0)    ; requires contributed.ncl

</pre>

If you have a multi-dimensional array, say <i>prc(ntim,nlat,mlon)</i>
containing 3-hourly precipitation rates (eg, mm/hour) and it is desired
to calculate the average precipitation rate for an each day then:

<pre>

  dimprc = <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(prc)
  ntim   = dimprc(0)     ; total number of time steps
  ntJump = 8             ; eight samples per day  (=24/3)
 
  prcDay = prc(::ntJump,:,:)  ; create array with meta data

  ntStrt = 0
  ntLast = ntJump-1
  do nt=0,ntim-1,ntJump
     prcDay(nt/8,:,:) = <a href="../Document/Functions/Built-in/dim_avg_n.html"><strong>dim_avg_n</strong></a>(prc(ntStrt:ntLast,:,:), 0)
     ntStrt = ntStrt + ntJump
     ntLast = ntLast + ntJump
  end do

  <a href="../Document/Functions/Built-in/printVarSummary.html"><strong>printVarSummary</strong></a>(prcDay)

</pre>

If the original data had been total precipitation over a 3-hour span and the
daily total (sum) precipitation had been desired, the approach would be exactly the
same except that <a href="../Document/Functions/Built-in/dim_sum_n.html"><strong>dim_sum_n</strong></a> would be used:

<pre>

   prcDay(nt/8,:,:) = <a href="../Document/Functions/Built-in/dim_sum_n.html"><strong>dim_sum_n</strong></a>(prc(ntStrt:ntLast,:,:), 0)

</pre>

<p><p>

<a name="data_anal_002"></a>
<li><i>How can I do an element-wise minimum/maximum between two arrays of the same size?</i>
<p>


Use the versatile <a href="../Document/Functions/Built-in/where.html"><strong>where</strong></a> function:
<p>

<pre>
   xmin = <a href="../Document/Functions/Built-in/where.html"><strong>where</strong></a>(x1.lt.x2,x1,x2) 
   xmax = <a href="../Document/Functions/Built-in/where.html"><strong>where</strong></a>(x1.gt.x2,x1,x2) 
</pre>

<p><p>

<a name="data_anal_003"></a>
<li><i>How do I interpolate my 2-dimensional random data to a 2-dimensional gridded array?</i>
<p>


There are lots of functions available for doing different kinds of
interpolations and regridding.  For a list, go to the <a href="../Document/Functions/index.html">NCL functions and procedures page</a>
and look in the <a
href="../Document/Functions/interp.html">interpolation</a> or <a
href="../Document/Functions/regrid.html">regridding</a> sections.  <p>

The  <a href="../Applications/rdm2grid.html">
Random Data to Grid</a> example URL has several examples.

As a specific example,  two interpolation functions are <a href="../Document/Functions/Built-in/natgrid.html"><strong>natgrid</strong></a> or
<a href="../Document/Functions/Built-in/dsgrid2.html"><strong>dsgrid2</strong></a>. Here's an example:

<pre>
  NX = 21
  NY = 21

; Define the input data arrays.
  x = (/0.00, 1.00, 0.00, 1.00, 0.40, 0.75/)
  y = (/0.00, 0.00, 1.00, 1.00, 0.20, 0.65/)
  z = (/0.00, 0.00, 0.00, 0.00, 1.25, 0.80/)

; Define the output grid.
  xc = 1./(NX-1.) 
  xo = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(0,NX-1,1) * xc

  yc = 1./(NY-1.) 
  yo = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(0,NY-1,1) * yc

; Do the gridding using natgrid. "natout" will be a 2-dimensional array
; dimensioned 21 x 21.
  natout = <a href="../Document/Functions/Built-in/natgrid.html"><strong>natgrid</strong></a>(x, y, z, xo, yo)
  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(natout)

; Do the gridding using dsgrid2. "dsout" will be a 2-dimensional array
; dimensioned 21 x 21.
  dsout = <a href="../Document/Functions/Built-in/dsgrid2.html"><strong>dsgrid2</strong></a>(x, y, z, xo, yo)
  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(dsout)
</pre>

<p><p>

<a name="data_anal_004"></a>
<li><i>How do I interpolate my 3-dimensional random data to a 3-dimensional gridded array?</i>
<p>


First, see the question above on 2-dimensional grids.
<p>

Two functions for handling 3D random data are <a href="../Document/Functions/Built-in/triple2grid.html"><strong>triple2grid</strong></a>
and <a href="../Document/Functions/Built-in/dsgrid3.html"><strong>dsgrid3</strong></a>.
<p>

Here's an example of using <a href="../Document/Functions/Built-in/dsgrid3.html"><strong>dsgrid3</strong></a>:

<pre>
  NX = 21
  NY = 21
  NZ = 21
  x = (/0.00, 1.00, 0.00, 1.00, 0.40, 0.75/)
  y = (/0.00, 0.00, 1.00, 1.00, 0.20, 0.65/)
  z = (/0.00, 0.00, 0.00, 0.00, 1.25, 0.80/)
  u = x*x + y*y + z*z

  xo = <a href="../Document/Functions/Built-in/new.html"><strong>new</strong></a>((/NX/),float)
  yo = <a href="../Document/Functions/Built-in/new.html"><strong>new</strong></a>((/NY/),float)
  zo = <a href="../Document/Functions/Built-in/new.html"><strong>new</strong></a>((/NZ/),float)

;
; Create the output grid.
;
  xmin = -2.0
  ymin = -2.0
  zmin = -2.0
  xmax =  2.0
  ymax =  2.0
  zmax =  2.0

  ii = <a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a>(0,20.,21)
  xo = xmin + (ii/(NX-1)) * (xmax-xmin)
  yo = ymin + (ii/(NY-1)) * (ymax-ymin)
  zo = zmin + (ii/(NZ-1)) * (zmax-zmin)

;
; Interpolate.  "output" will be a 3-dimensional grid dimensioned 21x21x21.
;
  output = <a href="../Document/Functions/Built-in/dsgrid3.html"><strong>dsgrid3</strong></a>(x, y, z, u, xo, yo, zo)
  <a href="../Document/Functions/Built-in/print.html"><strong>print</strong></a>(output)
</pre>

<p><p>

<a name="data_anal_005"></a>
<li><i>How can I figure out if a particular latitude/longitude point is within a specific area, like Europe?</i>
<p>


There's no ready-made function that will do this based on just the
area name, like "Europe".  However, if you have the lat/lon
coordinates that define the particular area that you're interested in,
then you can use the <a href="../Document/Functions/Built-in/gc_inout.html"><strong>gc_inout</strong></a> function.  <p>

Otherwise, assume you have a <i>crude</i> regional approximation that
indicates the area you're interested in, say: <p>

<pre>
  latS =  36
  latN =  70
  lonW = -10
  lonE =  60
</pre>

Further assume you have a data array "x" with coordinate arrays "time" x
"lat" x "lon".  You can then set up a "Europe" mask (<tt>eMask</tt>):
<p>

<pre>
    work  =  x(0,:,:)
    LAT   = conform( work, work&lat, 0)
    LON   = conform( work, work&lon, 1)
    eMask = new ( (/nlat,mlon/), "logical", "No_FillValue")
    eMask = where(LAT.ge.latS .and. LAT.le.latN .and. \
                  LON.ge.lonE .and. LON.le.lonW,   True, False)

    copy_VarCoords(work, eMask)   ; Copy coordinate arrays

; Clean up
    delete(work)
    delete(LAT)
    delete(LON)
</pre>

To plot an area using your new mask variable to exclude the areas
you're not interested in, see example 5 on
the <a href="../Applications/mask.html">mask</a> applications page.

<p><p>

</ol><p>


<h3>Visualization</h3>
<p>

<ol>
<a name="vis_001"></a>
<li><i>How can I create an "editable" graphics file required for journal publication?</i>
<p>


Use "eps" as an output format, when you open a workstation for sending
the graphics to.<p>

For example, if you're using the <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a> function:

<pre>
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("eps","myplot")
</pre>

<p><p>

<a name="vis_002"></a>
<li><i>How can I maximize the size of a plot in the frame?</i>
<p>


If you are using one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_<i>xxx</i></a> plotting
scripts, then set the special resource <a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a> to True.
<p>

Run the following simple script and compare the two frames:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  data = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -19.69, 15.82, 0, (/129,129/))

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","max")

  plot = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,data,False)

  res             = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a> = True
  plot = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,data,res)
</pre>

<p><p>

<a name="vis_003"></a>
<li><i>How do I get multiple plots on a page?</i>
<p>


If your plots are all the same size, then you can use the procedure
<a href="../Document/Graphics/Interfaces/gsn_panel.html"><strong>gsn_panel</strong></a>. If your plots are not the
same size, then you can use the
<a href="../Document/glossary.html#Viewport">viewport</a>
resources <a href="../Document/Graphics/Resources/vp.html#vpXF"><em>vpXF</em></a>, <a href="../Document/Graphics/Resources/vp.html#vpYF"><em>vpYF</em></a>, <a href="../Document/Graphics/Resources/vp.html#vpWidthF"><em>vpWidthF</em></a>,
and <a href="../Document/Graphics/Resources/vp.html#vpHeightF"><em>vpHeightF</em></a>. 
<p>

For some panel examples, see the <a
href="../Applications/panel.html">panel applications page</a>.  This
page also shows you tricks on paneling plots that are not the same
size (<a href="../Applications/panel.html#ex9">#9</a> and <a
href="../Applications/panel.html#ex14">#14</a> are two such examples).

<p><p>

<a name="vis_004"></a>
<li><i>What's a good way to generate a color map (table)?</i>
<p>


See the page on <a
href="../Document/Graphics/create_color_table.html">creating your own
color map</a>, or the section "<a href="../Document/Manuals/Getting_Started/basics.html#CreatingColorMapHSV">Creating your own color map using HSV
values <a href="../Document/glossary.html#HSV">HSV</a> color wheel
and how it helps you create a color map.
<p>

For an example, try modifying the HSV values in the file "<inforef
uri="GSUNDIR/Scripts/gsn_color.ncl">gsn_color.ncl</a>"
and running it through NCL to see the different results you get.  <p>

You can use the function <a href="../Document/Graphics/Interfaces/gsn_draw_colormap.html"><strong>gsn_draw_colormap</strong></a> to draw the current color
map associated with the workstation:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("ncgm","gsn_draw_colormap")
  <a href="../Document/Graphics/Interfaces/gsn_draw_colormap.html"><strong>gsn_draw_colormap</strong></a>(wks)   ; Draw the default colormap

  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,"hotres")   ; Change color map and
  <a href="../Document/Graphics/Interfaces/gsn_draw_colormap.html"><strong>gsn_draw_colormap</strong></a>(wks)              ; draw it.
</pre>

<p><p>

<a name="vis_005"></a>
<li><i>My map projection doesn't look right.</i>
<p>


If you're plotting a subset of longitudes and getting a strange
looking map, then you may need to set the resource <a href="../Document/Graphics/Resources/mp.html#mpCenterLonF"><em>mpCenterLonF</em></a>. This will tell NCL where you
want the center longitude of the plot to be. Usually, this should be
set to the halfway point between <a href="../Document/Graphics/Resources/mp.html#mpMinLonF"><em>mpMinLonF</em></a> and <a href="../Document/Graphics/Resources/mp.html#mpMaxLonF"><em>mpMaxLonF</em></a>:

<pre>
  res@mpCenterLonF = (res@mpMinLonF + res@mpMaxLonF)/2.
</pre>

<p><p>

<a name="vis_006"></a>
<li><i>How do I change all of my fonts to be the same in my visualization?</i>
<p>


First select a font from the NCL <a
href="../Document/Graphics/font_tables.html">font tables</a>
and remember the name, i.e. "helvetica".
<p>

If you always want to use this font in all of your NCL scripts, then
put the following line in a file called "<a href="../Document/Graphics/hlures.html">.hluresfile</a>" in your
home directory:

<pre>
    *Font : helvetica
</pre>

(We <i>highly</i> recommend using the <a
href="../Document/Graphics/Images/font21.png">helvetica</a> font for all
NCL scripts, because the <a
href="../Document/Graphics/Images/font1.png">default font</a> doesn't
look good when you print it.)  <p>

If NCL sees a ".hluresfile" in your home directory, it will always
load it before running any NCL scripts.
<p>

If you want this font to apply only to a particular NCL script, first
create a file called <i>xxx</i>.res, where <i>xxx</i> is the second
argument to <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>. Then,
include the above line in that file.  <p>

Any fonts that you are explicitly setting in your NCL script will
override resources set in ~/.hluresfile or the NCL script-specific
resource file.
<p>

Here's an example (with the "font.res" below):

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","font")   ; Open an X11 workstation.

  y = (/1,3,-1,-2,0,2,3/)
  x = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(0,<a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(y)-1,1)

  res = True
  res@<a href="../Document/Graphics/Resources/ti.html#tiMainString"><em>tiMainString</em></a>  = "This is an XY plot"
  res@<a href="../Document/Graphics/Resources/ti.html#tiXAxisString"><em>tiXAxisString</em></a> = "X values"
  res@<a href="../Document/Graphics/Resources/ti.html#tiYAxisString"><em>tiYAxisString</em></a> = "Y values"

  xy = <a href="../Document/Graphics/Interfaces/gsn_xy.html"><strong>gsn_xy</strong></a>(wks,x,y,res)   ; Create and draw an XY plot.
</pre>

The "font.res" file:

<pre>
! Change all fonts to times-bold
*Font : times-bold
</pre>

Try changing "times-bold" in the "font.res" file to other fonts to see
the results. Use either a font name or a font index as listed in the
<a href="../Document/Graphics/font_tables.html">font
tables</a>.

<p><p>

<a name="vis_007"></a>
<li><i>How can I change the text function code to something other than a colon?</i>
<p>


If you want your <a href="../Document/Graphics/function_code.html">text
function code</a> permanently changed (to, say, a '~') for every time
you run NCL, then in the ~./<a href="../Document/Graphics/hlures.html">.hluresfile</a> put the
following line:

<pre>
    *TextFuncCode : ~
</pre>

TextFuncCode can be set to whatever character you want (the default is
a colon, ':').  This special resource can <i>only</i> be set in a
resource file and not in an NCL script.
<p>

To change the text function code to another character inside of an NCL
script, use any one of the <tt>*FuncCode</tt> resources that
corresponds with the resource you are using to set the text string.
<p>

For example, if you are setting the <a href="../Document/Graphics/Resources/tx.html#txString"><em>txString</em></a> resource: <p>

<pre>
    res@<a href="../Document/Graphics/Resources/tx.html#txString"><em>txString</em></a> = "Time : 0600 hours"
</pre>

then you change the function code associated with this resource to
another character (say '~') with the <a href="../Document/Graphics/Resources/tx.html#txFuncCode"><em>txFuncCode</em></a> resource:
<p>

<pre>
    res@<a href="../Document/Graphics/Resources/tx.html#txFuncCode"><em>txFuncCode</em></a> = "~"
    res@<a href="../Document/Graphics/Resources/tx.html#txString"><em>txString</em></a>   = "Time : 0600 hours"
</pre>

If you are setting the X axis label with <a href="../Document/Graphics/Resources/ti.html#tiXAxisString"><em>tiXAxisString</em></a>, then the corresponding function
code resource would be <a href="../Document/Graphics/Resources/ti.html#tiXAxisFuncCode"><em>tiXAxisFuncCode</em></a>,
and so on.

<p><p>

<a name="vis_008"></a>
<li><i>How can I get a degree symbol in a text string?</i>
<p>


You can use <a href="../Document/Graphics/Images/font34.png">font table
34</a> with the character "0" to get a degree symbol:
<p>

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

begin
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","degree")   
  
  res              = True                     ; plot mods desired

  res@<a href="../Document/Graphics/Resources/ti.html#tiMainString"><em>tiMainString</em></a> = "Example degree (~S~o~N~) symbol"

  res@<a href="../Document/Graphics/Resources/tm.html#tmXBMode"><em>tmXBMode</em></a>     = "Explicit"                ; explicit labels 
  res@<a href="../Document/Graphics/Resources/tm.html#tmXBValues"><em>tmXBValues</em></a>   = (/  0.2,          0.4,      0.6,          0.8/)
  res@<a href="../Document/Graphics/Resources/tm.html#tmXBLabels"><em>tmXBLabels</em></a>   = (/"20~F34~0~F~","40~F34~0~F~","60~F34~0~F~","80~F34~0~F~"/)
  res@<a href="../Document/Graphics/Resources/tm.html#tmXBLabelFontColor"><em>tmXBLabelFontColor</em></a> = "Red"

  plot = <a href="../Document/Graphics/Interfaces/gsn_blank_plot.html"><strong>gsn_blank_plot</strong></a>(wks,res)
end
</pre>


<p><p>

<a name="vis_009"></a>
<li><i>How can I get things like accents or umlauts over my text?</i>
<p>


It's not trivial, but it is doable, using <a href="../Document/Graphics/function_code.html">text function
codes</a>. Here's an example:

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

begin

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","text")

  res               = True
  res@<a href="../Document/Graphics/Resources/tx.html#txJust"><em>txJust</em></a>        = 4
  res@<a href="../Document/Graphics/Resources/tx.html#txFont"><em>txFont</em></a>        = 25
  res@<a href="../Document/Graphics/Resources/tx.html#txFontHeightF"><em>txFontHeightF</em></a> = .1
;
; Explanation of the text string function codes:
;
; :F22: - Select font 22 (Helvetica bold)
; :H-15F35: - Move 15 digitized font units left and select font 35.
; The character "H" in font 35 is an umlaut.
; :H4F22: - Move 4 digitized font units right and select font 22.
; :H-14F35: - Move 14 digitized font units left and select font 35.
; :H3F22: - Move 3 digitized font units right and select font 22.
;
  str1 = ":F22:u:H-15F35:H:H4F22:berho:H-14F35:H:H3F22:hen"

;
; Explanation of the text string function codes:
;
; :F22: - Select font 22.
; :H-16V6F35: - Move 16 digitized units left, 6 digitized units
; up, and select font 35.
; :V-6H5F22: - Move 6 digitized units down and select font 22.
; :H-13F35: - Move 13 digitized units left and select font 35.
; :F22H2: - Select font 22 and move 2 digitized units right.
;
  str2 = ":F22:U:H-16V6F35:H:V-6H5F22:bersta:H-13F35:H:F22H2:nder"

  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,str1,0.5,0.7,res)    ; Draw the text string
  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,str2,0.5,0.3,res)

  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a>(wks)
end 
</pre>
<p><p>

<a name="vis_010"></a>
<li><i>How can I get special characters, like Greek symbols, in my graphical text strings?</i>
<p>


First browse the <a href="../Document/Graphics/font_tables.html">font tables</a> to
find the one that contains the character(s) you want. Clicking on any
one of the font names, like "math_symbols", will show you all the
characters for that particular font.  <p>

Once you find the character you desire, note the font table index
("<a href="../Document/Graphics/Images/font18.png">math_symbols</a>" is
index 18, for example), and the corresponding character, then you
can use the <a href="../Document/Graphics/function_code.html">text
function code</a> 'F' to change the font.
<p>

For example, to get a bell symbol, you would see that character 'n' in
the "<a href="../Document/Graphics/Images/font19.png">symbol_set1</a>"
table (index 19) is a bell. You can then use the string "~F19~n~F~" in
any text string resource to indicate you want a bell symbol. The "~F~"
means go back to the original font.
<p>

For example, to use it in a title:

<pre>
   res@<a href="../Document/Graphics/Resources/ti.html#tiMainString"><em>tiMainString</em></a> = "Bell (~F19~n~F~)"
</pre>

Note that we're assuming the default function code (a colon, ':'), has
been changed to a tilde, '~'. See the question above on changing
function codes.
 
<p><p>

<a name="vis_011"></a>
<li><i>Can I use real PostScript fonts in my PostScript file?</i>
<p>


Essentially no, except in one situation that is discussed below.  When
you use NCL <a href="../Document/Graphics/Images/font4.png">font
number 4</a>, you will get the stroked simplex_roman font, no
matter what kind of workstation you are going to, even a PostScript
workstation.  If you change "4" to "Helvetica," then you will get NCL
<a href="../Document/Graphics/Images/font21.png">font 21</a>
which is a Helvetica font that is drawn using filled areas,
i.e. filled areas will be put into the output PostScript and not code
to use the built-in PostScript Helvetica font.
<p>

However, there is one circumstance which will allow you to use a
PostScript font directly and not have filled areas inserted into the
output PostScript.  This can be accomplished by setting the resource
<a href="../Document/Graphics/Resources/tx.html#txFontQuality"><em>txFontQuality</em></a> to "low."  There are
some significant downsides to this.  First, no matter what font you
select in NCL, the font used in the output PostScript will be
Helvetica.  If you select a character, such as a degree symbol, that
is not in the Helvetica font, it will not be drawn correctly.
Secondly, all text strings will be monospaced.  Thirdly, when plotting
to workstations other than PostScript or PDF, you will get a very
low-level stick font. 
<p>

The primary upside to this is a reduction in the size of the
output PostScript file.  Another advantage is that you will be
using a built-in PostScript font that will be produced with 
high fidelity, even at very small sizes.
<p>

Here is an example of using font quality "low":

<pre>
begin
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("ps","font_test")

  txres = True
  txres@<a href="../Document/Graphics/Resources/tx.html#txFontQuality"><em>txFontQuality</em></a> = "low"
  txres@<a href="../Document/Graphics/Resources/tx.html#txFontHeightF"><em>txFontHeightF</em></a> = 0.04
  txres@<a href="../Document/Graphics/Resources/tx.html#txFuncCode"><em>txFuncCode</em></a>    =  ":"
  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,"Test PS fonts",.5,.5,txres)
  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a>(wks)

  txres@<a href="../Document/Graphics/Resources/tx.html#txDirection"><em>txDirection</em></a> = "down"
  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,"Vertical",.5,.5,txres)
  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a>(wks)

  txres@<a href="../Document/Graphics/Resources/tx.html#txDirection"><em>txDirection</em></a> = "across"
  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,                                                   \
    "degree sign:: :F34:0:FC:superscript:: 1.3:F0L1:4:F:10:S:300",    \
    .5,.5,txres)
  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a>(wks)
end
</pre>
<p><p>

<a name="vis_012"></a>
<li><i>I'm having trouble importing a PS file into an application like Adobe Illustrator.</i>
<p>


You can try "fixing" the PostScript using an application like "ps2ps" or 
"convert" from <a href="http://www.imagemagick.org/">ImageMagick</a>:
<p>

<pre>
  convert test.ps test2.ps
</pre>

<p><p>

<a name="vis_013"></a>
<li><i>How can I get the length of my axes to be the same ratio as the range of my axes?</i>
<p>


You can use the <a href="../Document/Graphics/Resources/vp.html#vpWidthF"><em>vpWidthF</em></a> and <a href="../Document/Graphics/Resources/vp.html#vpHeightF"><em>vpHeightF</em></a> resources to control the width and
height. You will need to calculate the range of each of your axes, and
then figure out the normalized values (from 0 to 1) to use.  <p>

Or, if you are using any of the non-map gsn_<i>xxxx</i> plotting
functions, then you can set the special resource <a href="../Document/Graphics/Resources/gsn.html#gsnShape"><em>gsnShape</em></a> to True:
<p>

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl" 

begin
  ny = 100
  mx =  50

; Generate some dummy data.
  z = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(20,20,-136.,450.,0,(/ny,mx/))
  
; Open an X11 window.
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","axes_ratio")

; Generate contour plot with default axes.
  res = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a> = True

  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks, z ,res)

; Set resource to reshape axes.
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnShape"><em>gsnShape</em></a> = True
  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks, z ,res)

end
</pre>

<p><p>

<a name="vis_014"></a>
<li><i>How do I change the aspect ratio or size of my map or plot?</i>
<p>


For a plot that doesn't contain a map, you can use the
<a href="../Document/glossary.html#Viewport">viewport</a>
resources <a href="../Document/Graphics/Resources/vp.html#vpWidthF"><em>vpWidthF</em></a> and <a href="../Document/Graphics/Resources/vp.html#vpHeightF"><em>vpHeightF</em></a>.  The viewport coordinates are
normalized; that is, they take values from 0.0 to 1.0 (inclusive).
<p>

For example, if you want your plot to be wider than it is high, then
you might set <a href="../Document/Graphics/Resources/vp.html#vpWidthF"><em>vpWidthF</em></a> to 0.4 and
<a href="../Document/Graphics/Resources/vp.html#vpHeightF"><em>vpHeightF</em></a> = 0.75:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","viewport")   ; Open an X11 workstation.

  y = (/1,3,-1,-2,0,2,3/)
  x = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(0,<a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(y)-1,1)

  res = True
  res@<a href="../Document/Graphics/Resources/vp.html#vpWidthF"><em>vpWidthF</em></a>  = 0.75
  res@<a href="../Document/Graphics/Resources/vp.html#vpHeightF"><em>vpHeightF</em></a> = 0.4

  xy = <a href="../Document/Graphics/Interfaces/gsn_csm_xy.html"><strong>gsn_csm_xy</strong></a>(wks,x,y,res)   ; Create and draw an XY plot.
</pre>

In order to change the aspect ratio of a map, you can still use the
"vp" resources as above, but you must also set the resource <a href="../Document/Graphics/Resources/mp.html#mpShapeMode"><em>mpShapeMode</em></a> to "FreeAspect":

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","viewport")   ; Open an X11 workstation.
 
  mpres              = True
  mpres@<a href="../Document/Graphics/Resources/mp.html#mpShapeMode"><em>mpShapeMode</em></a>  = "FreeAspect"    ; Allow the aspect ratio to be changed.
  mpres@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a>   = True
  mpres@<a href="../Document/Graphics/Resources/vp.html#vpWidthF"><em>vpWidthF</em></a>     = 0.8
  mpres@<a href="../Document/Graphics/Resources/vp.html#vpHeightF"><em>vpHeightF</em></a>    = 0.8

  map = <a href="../Document/Graphics/Interfaces/gsn_map.html"><strong>gsn_map</strong></a>(wks,"CylindricalEquidistant",mpres)
</pre>

In the above script, to maximize the plot in the frame but retain the
aspect ratio, the special resource <a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a> is set to True.

<p><p>

<a name="vis_015"></a>
<li><i>Can I set color resources by color name rather than color index values?</i>
<p>


Yes, as long as the color you want to reference exists in your current
color map. Any place that you would normally use a color index value,
you can use a <a href="../Document/glossary.html#NamedColor">color name</a>
enclosed in double quotes. An ASCII list of the valid color names is
in the file "<a
href="../Document/Graphics/rgb.txt">$NCARG_ROOT/lib/ncarg/database/rgb.txt</a>",
and a <a href="../Document/Graphics/named_colors.html">graphical
representation</a> is also available".  <p>

For example, if color index 2 is red in your color map, and you want
to set the main title font color to red, then you can do it one of two
ways from an NCL script: <p>

<pre>
  res@<a href="../Document/Graphics/Resources/ti.html#tiMainFontColor"><em>tiMainFontColor</em></a> = 2     ; index value

  res@<a href="../Document/Graphics/Resources/ti.html#tiMainFontColor"><em>tiMainFontColor</em></a> = "red" ; color name

</pre>

Whenever a named color is used, the current color map is searched for
the color that is the closest match to that color.  This means that if
you access a color that doesn't have a close match in your color map,
you may not get the color you are expecting. To get around this
problem, make sure the color map you use contains all the named colors
you want by adding them explicitly to your color map.
<p>

For example, if you want your general color map to have the following
RGB values:

<pre>
(/(/0.0,0.0,0.0/),(/1.0,1.0,1.0/),(/1.0,0.0,0.0/),(/0.0,1.0,0.0/),
  (/0.0,0.0,1.0/),(/1.0,1.0,0.0/),(/0.0,1.0,1.0/),(/1.0,0.0,1.0/),
  (/0.5,0.0,0.0/),(/0.5,1.0,1.0/),(/0.0,0.0,0.5/),(/1.0,1.0,0.5/),
  (/0.5,0.0,1.0/),(/1.0,0.5,0.0/),(/0.0,0.5,1.0/),(/0.5,1.0,0.0/),
  (/0.5,0.0,0.5/)/)
</pre>

and you also want to include the named colors "Olive", "Plum", "Gold",
"MediumBlue", and "LightSlateGray", then set the new color map
as follows:

<pre>
  ...
  cmap = (/"(/0.0,0.0,0.0/)","(/1.0,1.0,1.0/)","(/1.0,0.0,0.0/)",\
           "(/0.0,1.0,0.0/)","(/0.0,0.0,1.0/)","(/1.0,1.0,0.0/)",\
           "(/0.0,1.0,1.0/)","(/1.0,0.0,1.0/)","(/0.5,0.0,0.0/)",\
           "(/0.5,1.0,1.0/)","(/0.0,0.0,0.5/)","(/1.0,1.0,0.5/)",\
           "(/0.5,0.0,1.0/)","(/1.0,0.5,0.0/)","(/0.0,0.5,1.0/)",\
           "(/0.5,1.0,0.0/)","(/0.5,0.0,0.5/)",\
           "Olive","Plum","Gold","MediumBlue","LightSlateGray"/)

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>(...)
  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,cmap)
  ...
</pre>

<b>Note:</b> in order to mix RGB values with color names, you must
enclose each entry in double quotes.  More information about named
colors is available in the <a href="../Applications/color.html">color
fill applications page</a>.

<p><p>

<a name="vis_016"></a>
<li><i>How can I speed up the drawing of filled contours in NCL?</i>
<p>


You can try setting the <a href="../Document/Graphics/Resources/cn.html#cnFillMode"><em>cnFillMode</em></a> resource to "RasterFill" (the
default is "AreaFill"), and further set <a href="../Document/Graphics/Resources/cn.html#cnRasterSmoothingOn"><em>cnRasterSmoothingOn</em></a> to True if you want
smoother contours.

<p><p>

<a name="vis_017"></a>
<li><i>Can I change color index values or color maps in mid-frame?</i>
<p>


The main consideration in doing this is changing the background
color.  If the background color is changed in mid-picture (color
index 0), then in most cases at the time you change the background
color your entire frame will be overwritten with that color.  As long
as you do not change the background color in mid-picture, your results
should be as desired.  See the simple example below.  
<p>

Trying to swap in an entire new color map is problematic, again
primarily due to considerations with resetting the background color.
If you are producing PS or PDF output and <i>if your background color
is the default</i>, then things should work.  Things
should work in all cases in going to NCGM and translating with ctrans.
Producing X11 output works unless you specifically reset the background 
color.  
<p>

But, to be on the safe side, what will work in all cases is starting 
off with any color map and then redefining any color indices except 
the background.  For example, if you have a color table with 256
defined colors and want to replace that in mid-picture with a different
color table, use the function <a href="../Document/Functions/Built-in/NhlSetColor.html"><strong>NhlSetColor</strong></a> to redefine
all color index values except for index 0.  The logic in the following
example illustrates this:

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

begin

  res = True

;
;  draw_cells draws cells fitting them into a box with lower left 
;  corner (xll,yll) and upper right corner (xur,yur) with nx cells 
;  in x and ny cells in y.  For each call each cell is colored 
;  using increasing indices in cmap, starting with index 0.
;
  procedure draw_cells(wks:graphic, xll:float,  yll:float,  xur:float, \
                       yur:float,   nx:integer, ny:integer,            \
                       cmap[*][3]:numeric)
  begin 
    xinc = (xur-xll)/nx
    yinc = (yur-yll)/ny
    do j=0,ny-1
      plly = yll + j*yinc
      pury = plly + yinc
      do i=0,nx-1
        pllx = xll + i*xinc
        purx = pllx + xinc
        x = (/pllx,purx,purx,pllx,pllx/)
        y = (/plly,plly,pury,pury,plly/)
        res@<a href="../Document/Graphics/Resources/gs.html#gsFillColor"><em>gsFillColor</em></a> = i+j*nx
        <a href="../Document/Graphics/Interfaces/gsn_polygon_ndc.html"><strong>gsn_polygon_ndc</strong></a>(wks,x,y,res)
      end do
    end do
  end

;
;  Original color map is "black", "red", "green", "blue".
;
  cmap = (/ (/0.,0.,0./), (/1.,0.,0./), (/0.,1.,0./), (/0.,0.,1./) /)
  rlist = True
  rlist@<a href="../Document/Graphics/Resources/wk.html#wkColorMap"><em>wkColorMap</em></a> = cmap
  wks_type = "x11"
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>(wks_type,"cell")
  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,cmap)

;
;  Draw color boxes using the original color map.
;
  draw_cells(wks, 0., 0., 1.0, 0.5, 2, 2, cmap)

;
;  Redefine indices 1-3.
;
  <a href="../Document/Functions/Built-in/NhlSetColor.html"><strong>NhlSetColor</strong></a>(wks, 1, 0., 1., 1.)  ; cyan
  NhlSetColor(wks, 2, 1., 0., 1.)  ; magenta
  NhlSetColor(wks, 3, 1., 1., 0.)  ; yellow

;
;  Draw color boxes using the redefined color map.
;
  draw_cells(wks, 0., 0.5, 1.0, 1.0, 2, 2, cmap)

  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a>(wks)
end
</pre>

<p><p>

<a name="vis_018"></a>
<li><i>How do I get my PostScript/PDF output to cover most of an 8-1/2" x 11" page?</i>
<p>


You can do this one of two ways.  If you are using one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_<i>xxx</i></a>
plotting scripts, then the easy way is to set the special resource
<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a> to True:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  data = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -19.69, 15.82, 0, (/129,129/))

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("pdf,"pdfmax")

  res             = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a> = True
  plot = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,data,res)
</pre>


Another (but harder) way is when you create your PostScript/PDF
workstation, use the resources <a href="../Document/Graphics/Resources/wk.html#wkDeviceLowerX"><em>wkDeviceLowerX</em></a>, <a href="../Document/Graphics/Resources/wk.html#wkDeviceLowerY"><em>wkDeviceLowerY</em></a>, <a href="../Document/Graphics/Resources/wk.html#wkDeviceUpperX"><em>wkDeviceUpperX</em></a>, and <a href="../Document/Graphics/Resources/wk.html#wkDeviceUpperY"><em>wkDeviceUpperY</em></a> to position the output
anywhere on the page.  <p>

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  type = "ps"
  type@wkDeviceLowerX = -75   ; These coordinates can be negative.
  type@wkDeviceLowerY = -50
  type@wkDeviceUpperX = 750
  type@wkDeviceUpperY = 950

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>(type,"psmax")

  res   = True
  blank = <a href="../Document/Graphics/Interfaces/gsn_blank_plot.html"><strong>gsn_blank_plot</strong></a>(wks,res)
</pre>

Note that it is possible to have negative values for these resources,
and to use them to change the aspect ratio of the plot.

<p><p>

<a name="vis_019"></a>
<li><i>How can I control the size and location of the X11 window that NCL brings up?</i>
<p>


Add the lines:

<pre>
! Make default X11 window larger (adjust as necessary)
*<a href="../Document/Graphics/Resources/wk.html#wkWidth"><em>wkWidth</em></a>   : 800
*<a href="../Document/Graphics/Resources/wk.html#wkHeight"><em>wkHeight</em></a>  : 800
</pre>

to your "~/<a href="../Document/Graphics/hlures.html">.hluresfile</a>" file.

<p><p>

<a name="vis_020"></a>
<li><i>How do I tell NCL to ignore missing values in my plot?</i>
<p>


If you are using <a
href="../Document/Graphics/Interfaces/index.html">gsn_<i>xxx</i></a> routines to
generate your graphics, then all you need to do is make sure that the
<a href="../Document/Language/fillval.html">_FillValue</a> attribute of
your data is set to the missing value.  <p>

Otherwise:

<ul>
<li>for contour data - use the <a href="../Document/HLUs/Classes/ScalarField.html"><strong>ScalarField</strong></a>
resource <a href="../Document/Graphics/Resources/sf.html#sfMissingValueV"><em>sfMissingValueV</em></a>
<p>

<li>for vector/streamline data, use the <a href="../Document/HLUs/Classes/VectorField.html"><strong>VectorField</strong></a>
<a href="../Document/Graphics/Resources/vf.html#vfMissingUValueV"><em>vfMissingUValueV</em></a> and/or
<a href="../Document/Graphics/Resources/vf.html#vfMissingVValueV"><em>vfMissingVValueV</em></a> resources
<p>

<li>for XY data, use the resources <a href="../Document/Graphics/Resources/ca.html#caXMissingV"><em>caXMissingV</em></a> and/or <a href="../Document/Graphics/Resources/ca.html#caYMissingV"><em>caYMissingV</em></a>
<p>

</ul>

For a contour example with missing values:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

; Create some dummy data for the contour plot.
  T = (/ (/  7,  7,   7,   7,   7,   7,   7,   7,   7, 7, 7 /),\
         (/  7,  5,   5,   5,   5,   5,   5,   5,   5, 5, 7 /),\
         (/  7,  5, 999, 999, 999, 999, 999, 999, 999, 5, 7 /),\
         (/  7,  5, 999,   3,   3,   3,   3,   3, 999, 5, 7 /),\
         (/  7,  5, 999,   3,   2,   2,   2,   3, 999, 5, 7 /),\
         (/  7,  5, 999,   3,   2,   1,   2,   3, 999, 5, 7 /),\
         (/  7,  5, 999,   3,   2,   2,   2,   3, 999, 5, 7 /),\
         (/  7,  5, 999,   3,   3,   3,   3,   3, 999, 5, 7 /),\
         (/  7,  5, 999, 999, 999, 999, 999, 999, 999, 5, 7 /),\
         (/  7,  5,   5,   5,   5,   5,   5,   5,   5, 5, 7 /),\
         (/  7,  7,   7,   7,   7,   7,   7,   7,   7, 7, 7 /)/)

  T@_FillValue = 999    ; Set _FillValue.

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","contour")
  contour = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,T,False)    ; Draw a contour plot.
</pre>

Note the hole in the middle of the contour plot due to the presence of
missing values.
<p>

For an XY plot example with missing values:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","xy")

  y = (/1,3,-1,-2,0,2,3,0,5,-2,1,0,0,8,10,5,-3/)

  y@_FillValue = 0               ; Set the missing value.

  xy = <a href="../Document/Graphics/Interfaces/gsn_y.html"><strong>gsn_y</strong></a>(wks,y,False)        ; Create and draw an XY plot.
</pre>

Note the gaps in the XY curve due to missing values.

<p><p>

<a name="vis_021"></a>
<li><i>How can I get more labels on my contour lines?</i>
<p>


NCL uses a complex algorithm to determine where to put contour line
labels, and sometimes this generates unexpected results, like not
getting enough contour labels.
<p>

You can set the <a href="../Document/Graphics/Resources/cn.html#cnLinelabelPlacementMode"><em>cnLinelabelPlacementMode</em></a> to different
values to try to control the way the contour lines are labeled. 
The default is "Randomized", and you can try the values "Constant"
or "Computed".
<p>

The resource <a href="../Document/Graphics/Resources/cn.html#cnLineLabelDensityF"><em>cnLineLabelDensityF</em></a>
allows you to increase the density of the contour labels, if
<a href="../Document/Graphics/Resources/cn.html#cnLinelabelPlacementMode"><em>cnLinelabelPlacementMode</em></a> is
set to "Computed" or "Randomized".
<p>

See the <a href="../Applications/contourLab.html">contour labels</a>
applications page for some examples.

<p><p>

<a name="vis_022"></a>
<li><i>My X or Y axis values are not linear. How can I change this?</i>
<p>


You can set the special gsn resources <a href="../Document/Graphics/Resources/gsn.html#gsnXAxisIrregular2Linear"><em>gsnXAxisIrregular2Linear</em></a> and/or <a href="../Document/Graphics/Resources/gsn.html#gsnYAxisIrregular2Linear"><em>gsnYAxisIrregular2Linear</em></a> to True.
<p>

For an example, run the following code:

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"

begin
;
; Generate some dummy data.
;
  level = (/1000, 850, 700, 500, 400, 300, 250, 200, 150, 100/)
  lat   = <a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a>(-90,90,20)

  nlat  = <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(lat)
  nlev  = <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(level)
  data  = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 12, -20., 17., 0, (/ nlev,nlat/))

  data!0   = "lev"     ; Name the dimensions and
  data!1   = "lat"     ; attach coordinate arrays
  data&lev = level     ; This coordinate array is irregulary spaced
  data&lat = lat

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","linear")
  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,"rainbow")

; Set up resources.
  res                     = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a>         = True        ; Maximize plot in frame
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColors"><em>gsnSpreadColors</em></a>     = True        ; Span full color map
  res@<a href="../Document/Graphics/Resources/cn.html#cnFillOn"><em>cnFillOn</em></a>            = True        ; Turn on contour fill
  res@<a href="../Document/Graphics/Resources/cn.html#cnLinesOn"><em>cnLinesOn</em></a>           = False       ; Turn off contour lines
  res@<a href="../Document/Graphics/Resources/lb.html#lbLabelAutoStride"><em>lbLabelAutoStride</em></a>   = True        ; Control labelbar spacing

  res@<a href="../Document/Graphics/Resources/ti.html#tiYAxisString"><em>tiYAxisString</em></a>       = "Irregularly-spaced values"
  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,data,res)  ; Create filled contours

  res@<a href="../Document/Graphics/Resources/ti.html#tiYAxisString"><em>tiYAxisString</em></a>       = "Y axis linearized"
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnYAxisIrregular2Linear"><em>gsnYAxisIrregular2Linear</em></a> = True
  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,data,res)  ; Create filled contours
end

</pre>

<p><p>

<a name="vis_023"></a>
<li><i>How do I get log scaling on either of my plot axes?</i>
<p>


For an XY plot, set the transformation resources <a href="../Document/Graphics/Resources/tr.html#trXLog"><em>trXLog</em></a> and/or <a href="../Document/Graphics/Resources/tr.html#trYLog"><em>trYLog</em></a> to True, depending on
which axes you want to be in log scaling.
<p>

Here's an example with default linear axes, and then with
the Y axis "logged":

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

; Create dummy data for XY plot.
  y =  (/10, 100, 5000, 10, 9000, 70, 300, 10000, 600/)

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","logxy")   ; Open an X11 workstation.

  xyres = True
  xyres@<a href="../Document/Graphics/Resources/ti.html#tiXAxisString"><em>tiXAxisString</em></a> = "linear"
  xyres@<a href="../Document/Graphics/Resources/ti.html#tiYAxisString"><em>tiYAxisString</em></a> = "linear"

  xyplot = <a href="../Document/Graphics/Interfaces/gsn_y.html"><strong>gsn_y</strong></a>(wks,y,xyres)  ; Create and draw the XY plot.

; Change the Y axis scale to be log and redraw the plot.
  xyres@<a href="../Document/Graphics/Resources/tr.html#trYLog"><em>trYLog</em></a>        = True
  xyres@<a href="../Document/Graphics/Resources/ti.html#tiYAxisString"><em>tiYAxisString</em></a> = "log"
  xyres@<a href="../Document/Graphics/Resources/xy.html#xyComputeYMin"><em>xyComputeYMin</em></a> = True   ; To keep from getting some warning msgs.

  xyplot = <a href="../Document/Graphics/Interfaces/gsn_y.html"><strong>gsn_y</strong></a>(wks,y,xyres)  ; Create and draw the XY plot.
</pre>

For a contour plot, the method for changing to log scaling depends on
whether the coordinates for the axis you want to log are regularly or
irregularly spaced. If they are regularly spaced, then use <a href="../Document/Graphics/Resources/tr.html#trXLog"><em>trXLog</em></a> or <a href="../Document/Graphics/Resources/tr.html#trYLog"><em>trYLog</em></a> just like it was done for the
XY plot above:
<p>

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

; Create some dummy data for the contour plot.
  N=25
  T = new((/N,N/),float)
  jspn = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(-N/2,N/2,1)^2
  ispn = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(-N/2,N/2,1)^2
  do i = 0, <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(ispn)-1
      T(i,:) = ispn(i) + jspn
  end do
  T = 100.0 - <a href="../Document/Functions/Built-in/sqrt.html"><strong>sqrt</strong></a>(8^2 * T)

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","logcon")   ; Open an X11 workstation.

  cnres = True
  cnres@<a href="../Document/Graphics/Resources/sf.html#sfYCStartV"><em>sfYCStartV</em></a>    = 10
  cnres@<a href="../Document/Graphics/Resources/sf.html#sfYCEndV"><em>sfYCEndV</em></a>      = 1000
  cnres@<a href="../Document/Graphics/Resources/ti.html#tiXAxisString"><em>tiXAxisString</em></a> = "linear"   ; Label for X axis.
  cnres@<a href="../Document/Graphics/Resources/ti.html#tiYAxisString"><em>tiYAxisString</em></a> = "log"    ; Label for Y axis.
  cnres@<a href="../Document/Graphics/Resources/tr.html#trYLog"><em>trYLog</em></a>        = True     ; Log scaling for Y axis

  contour = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,T,cnres)  ; Create and draw contour plot.
</pre>

If you are using one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_<i>xxx</i></a> plotting
functions, and if the coordinates for the axis you want to log are
irregularly spaced (as they are if your data contains coordinate
arrays or you set one of either the <a href="../Document/Graphics/Resources/sf.html#sfXArray"><em>sfXArray</em></a> or <a href="../Document/Graphics/Resources/sf.html#sfYArray"><em>sfYArray</em></a> resources), then you can set the
appropriate <a href="../Document/Graphics/Resources/gsn.html#gsnXAxisIrregular2Log"><em>gsnXAxisIrregular2Log</em></a> or
<a href="../Document/Graphics/Resources/gsn.html#gsnYAxisIrregular2Log"><em>gsnYAxisIrregular2Log</em></a> resource to True:
<p>

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

; Create some dummy data for the contour plot.
  N = 25
  T = <a href="../Document/Functions/Built-in/new.html"><strong>new</strong></a>((/N,N/),float)
  jspn = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(-N/2,N/2,1)^2
  ispn = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(-N/2,N/2,1)^2
  do i = 0, <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(ispn)-1
      T(i,:) = ispn(i) + jspn
  end do
  T = 100.0 - <a href="../Document/Functions/Built-in/sqrt.html"><strong>sqrt</strong></a>(8^2 * T)

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","logcon")

; Create some dummy data for the Y axis that is not regularly spaced.
  y = (/  10,   50,  100,  150,  250,  500,  750, 1000, 1100, 1300, 1500, \
        1750, 2000, 2200, 2400, 2600, 3000, 4000, 4500, 5000, 5100, 5500, \
        7000, 9000,10000/)

  cnres                       = True
  cnres@<a href="../Document/Graphics/Resources/sf.html#sfYArray"><em>sfYArray</em></a>              = y           ; Irregular Y axis
  cnres@<a href="../Document/Graphics/Resources/gsn.html#gsnYAxisIrregular2Log"><em>gsnYAxisIrregular2Log</em></a> = True        ; Force Y axis to be log.
  cnres@<a href="../Document/Graphics/Resources/ti.html#tiYAxisString"><em>tiYAxisString</em></a>         = "log"       ; Label for Y axis.
  cnres@<a href="../Document/Graphics/Resources/ti.html#tiXAxisString"><em>tiXAxisString</em></a>         = "linear"    ; Label for X axis.

  contour = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,T,cnres)  ; Create and draw contour plot.
</pre>

For some more complex examples, see examples 4-6 on the <a
href="../Applications/zonal.html">zonal applications page</a> for an
example of these and similar resources.

<p><p>

<a name="vis_024"></a>
<li><i>How do I fill my contour levels with various shading patterns and/or solid colors?</i>
<p>


If you just want to fill your contour levels with various solid
colors, set <a href="../Document/Graphics/Resources/cn.html#cnFillOn"><em>cnFillOn</em></a> to
True. If you are using <a
href="../Document/Graphics/Interfaces/index.html">gsn_<i>xxx</i></a> interfaces,
then you can additionally set <a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColors"><em>gsnSpreadColors</em></a> to make sure your full color map
is spanned. To change the default colors used for the contour levels,
set <a href="../Document/Graphics/Resources/cn.html#cnFillColors"><em>cnFillColors</em></a> to an array of
desired color indexes.
<p>

If you want to fill the contour levels with different shading
patterns, you must set <a href="../Document/Graphics/Resources/cn.html#cnMonoFillPattern"><em>cnMonoFillPattern</em></a> to False, and then set
<a href="../Document/Graphics/Resources/cn.html#cnFillPatterns"><em>cnFillPatterns</em></a> to an array of
desired fill pattern indexes.
<p>

There are <a href="../Document/Graphics/fill_patterns.html">18
different fill patterns</a>: pattern 0 is solid fill, patterns
1-16 are various fill patterns, and pattern 17 is a special
<a href="../Document/glossary.html#Stipple">stipple</a> fill pattern.
If you use "-1" for a fill pattern, this means to leave it transparent
(no fill).  <p>

There's a function called <a href="../Document/Graphics/Interfaces/gsn_contour_shade.html"><strong>gsn_contour_shade</strong></a> that allows you to specify
contour levels where you want specific shading or colors.
<p>

Here's an example showing how to create a contour plot using different
fill patterns and colors:
<p>

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"

; Create some data for the contour plot.
  data = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -19.69, 15.82, 0, (/129,129/))

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","fillcon")

  cnres                   = True
  cnres@<a href="../Document/Graphics/Resources/cn.html#cnFillOn"><em>cnFillOn</em></a>          = True   ; Turn on contour level fill.
  cnres@<a href="../Document/Graphics/Resources/cn.html#cnMonoFillPattern"><em>cnMonoFillPattern</em></a> = False  ; Indicate you want multiple fill patterns.
;
; Set cnFillPatterns and cnFillColors to various indexes representing
; fill patterns and colors.  A fill pattern index of "0" is solid fill.
; If you don't want any fill for a particular contour level, set it
; to "-1," which means "transparent."
;
  cnres@<a href="../Document/Graphics/Resources/cn.html#cnFillPatterns"><em>cnFillPatterns</em></a>    = (/0, 2, 3, 0, 6, 8,10,-1, 9, 0,11,12,17,16/)
  cnres@<a href="../Document/Graphics/Resources/cn.html#cnFillColors"><em>cnFillColors</em></a>      = (/6,10,14, 8, 4, 2, 9, 1,12, 3,20,13, 5, 7/)
  
  contour = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,data,cnres)
</pre>

For examples of <a href="../Document/Graphics/Interfaces/gsn_contour_shade.html"><strong>gsn_contour_shade</strong></a>,
see <a href="../Applications/coneff.html#ex13">example 13</a> on the <a
href="../Applications/coneff.html">contour effects applications
page</a>.

<p><p>

<a name="vis_025"></a>
<li><i>How do I overlay a contour plot (or a vector/streamline plot) on a map?</i>
<p>


The easiest way to do this is use one of the overlay functions found
in the list of <a
href="../Document/Graphics/Interfaces/index.html">gsn_<i>xxx</i></a> interfaces
(like <a href="../Document/Graphics/Interfaces/gsn_csm_contour_map.html"><strong>gsn_csm_contour_map</strong></a>, <a href="../Document/Graphics/Interfaces/gsn_csm_vector_scalar_map.html"><strong>gsn_csm_vector_scalar_map</strong></a>, etc).
<p>

If your data doesn't contain any
<a href="../Document/glossary.html#CoordinateArray">coordinate arrays</a>
and it hasn't already been transformed into some map
projection, then you need to set the resources <a href="../Document/Graphics/Resources/sf.html#sfXArray"><em>sfXArray</em></a> and <a href="../Document/Graphics/Resources/sf.html#sfYArray"><em>sfYArray</em></a> (<a href="../Document/Graphics/Resources/vf.html#vfXArray"><em>vfXArray</em></a> and <a href="../Document/Graphics/Resources/vf.html#vfYArray"><em>vfYArray</em></a> for vector/streamline plots) to
arrays that define the values for the axes. For overlaying on a map,
these values would be longitude and latitude respectively.

<p>

Here's a simple contour example:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

; Create some dummy data for the contour/map plot.
  data = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -19.69, 15.82, 0, (/64,128/))

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","fillcon")

  res          = True
  res@<a href="../Document/Graphics/Resources/sf.html#sfXArray"><em>sfXArray</em></a> = <a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a>(-180,180,128)
  res@<a href="../Document/Graphics/Resources/sf.html#sfYArray"><em>sfYArray</em></a> = <a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a>( -90, 90, 64)
  
  plot = <a href="../Document/Graphics/Interfaces/gsn_contour_map.html"><strong>gsn_contour_map</strong></a>(wks,data,res)
</pre>

If the plot has already been transformed to map coordinates, then you
can set the <a href="../Document/Graphics/Resources/tf.html#tfDoNDCOverlay"><em>tfDoNDCOverlay</em></a> resource
to True, indicating to NCL that no map transformation is to take
place.

In order for this to work, however, your map projection <i>must be set
up to exactly match the area your data represents</i>.  Sometimes this
information is available, say, on the same file that the data came
from.  <p>

Here's a simple (and rather crude) vector example using a cylindrical
equidistant map:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

; Create some dummy data for the contour/map plot.
  udata = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -19, 15, 0, (/32,64/))
  vdata = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -21, 17, 0, (/32,64/))

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","fillcon")

  res          = True
  res@<a href="../Document/Graphics/Resources/tf.html#tfDoNDCOverlay"><em>tfDoNDCOverlay</em></a> = True
  
  plot = <a href="../Document/Graphics/Interfaces/gsn_vector_map.html"><strong>gsn_vector_map</strong></a>(wks,udata,vdata,res)
</pre>

Of course, these types of plots are usually more complex than the
above, because if you don't know the map projection, it can be
difficult setting up the map limits correctly. For some more complex
examples, see the <a href="../Applications/native.html">native grid
application page</a>.

<p><p>

<a name="vis_026"></a>
<li><i>How do I force the tickmarks to point inward?</i>
<p>


If you are using one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_csm</a> plotting scripts in which
the tickmarks are pointing outward, then you can force them to point inward
by setting these four resources:

<pre>
  res@<a href="../Document/Graphics/Resources/tm.html#tmXBMajorOutwardLengthF"><em>tmXBMajorOutwardLengthF</em></a> = 0.0
  res@<a href="../Document/Graphics/Resources/tm.html#tmYLMajorOutwardLengthF"><em>tmYLMajorOutwardLengthF</em></a> = 0.0
  res@<a href="../Document/Graphics/Resources/tm.html#tmXBMinorOutwardLengthF"><em>tmXBMinorOutwardLengthF</em></a> = 0.0
  res@<a href="../Document/Graphics/Resources/tm.html#tmYLMinorOutwardLengthF"><em>tmYLMinorOutwardLengthF</em></a> = 0.0
</pre>


<p><p>

<a name="vis_027"></a>
<li><i>I'm trying to control the tickmarks on the top or right axis, and nothing is happening.</i>
<p>


By default, the top tickmarks and their labels are controlled by the
settings for the bottom tickmarks. Likewise, the right tickmarks are
controlled by the settings for the left tickmarks.
<p>

If you want to modify the top tickmarks individually of the bottom
tickmarks, then you need to set the resource <a href="../Document/Graphics/Resources/tm.html#tmXUseBottom"><em>tmXUseBottom</em></a> to False. For the right
tickmarks, set <a href="../Document/Graphics/Resources/tm.html#tmYUseLeft"><em>tmYUseLeft</em></a> to False.
<p>

See <a href="../Applications/xy.html#ex8">example 8</a> on the XY
applications page.

<p><p>

<a name="vis_028"></a>
<li><i>How can I improve the resolution of my map outlines?</i>
<p>


Use the <a href="../Document/Graphics/Resources/mp.html#mpDataBaseVersion"><em>mpDataBaseVersion</em></a>
resource.  The default is "LowRes".  If you change this to "MediumRes"
or "HighRes", you will improve the resolution of your map outlines.
<p>

Note: the "HighRes" resource shows coastal outlines only, and you
should not use this resolution for global maps (it's slow, and you may
see some strange artifacts).  The high-resolution database does not
come with NCL; instructions for downloading and installing this
database can be found on the <a
href="../Document/Graphics/rangs.html">high-resolution coastlines</a>
description page.  <p>

For an example comparing the three levels of resolutions:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","mapres")

  res                   = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a>       = True           ; Maximize plot in frame
  res@<a href="../Document/Graphics/Resources/mp.html#mpMinLonF"><em>mpMinLonF</em></a>         = -15.           ; Area to zoom in on.
  res@<a href="../Document/Graphics/Resources/mp.html#mpMaxLonF"><em>mpMaxLonF</em></a>         =  15
  res@<a href="../Document/Graphics/Resources/mp.html#mpMinLatF"><em>mpMinLatF</em></a>         =  40.
  res@<a href="../Document/Graphics/Resources/mp.html#mpMaxLatF"><em>mpMaxLatF</em></a>         =  70.

; Default "LowRes" database.
  map = <a href="../Document/Graphics/Interfaces/gsn_csm_map.html"><strong>gsn_csm_map</strong></a>(wks,res)

; "MediumRes" database.
  res@<a href="../Document/Graphics/Resources/mp.html#mpDataBaseVersion"><em>mpDataBaseVersion</em></a> = "MediumRes" 
  map = <a href="../Document/Graphics/Interfaces/gsn_csm_map.html"><strong>gsn_csm_map</strong></a>(wks,res)

; "HighRes" database.
  res@<a href="../Document/Graphics/Resources/mp.html#mpDataBaseVersion"><em>mpDataBaseVersion</em></a> = "HighRes" 
  map = <a href="../Document/Graphics/Interfaces/gsn_csm_map.html"><strong>gsn_csm_map</strong></a>(wks,res)
</pre>

<p><p>

<a name="vis_029"></a>
<li><i>When I draw a map using the high-resolution map database, I seem to randomly get different resolutions.</i>
<p>


This is because the high-res map database has 5 levels of resolutions,
and NCL dynamically chooses the best one based on the size of your plot
on the page, and the range of your map.
<p>

To control this, you can set the <a href="../Document/Graphics/Resources/mp.html#mpDataResolution"><em>mpDataResolution</em></a> resource to one of the values
"Coarsest", "Coarse", "Medium", "Fine" or "Finest".
<p>

You should only use "Fine" or "Finest" if you are zoomed in a fairly
small area of the map. These resolutions can take a long time to draw.
<p>

See <a href="../Applications/maponly.html#ex20">example
20</a> on the "maps only" applications page.

<p><p>

<a name="vis_030"></a>
<li><i>How can I get more geographical outlines in my map, like the provinces of China?</i>
<p>


We have added more outlines (like China provinces) to our map
databases, and they will be available in <a
href="../prev_releases.html#5.1.0">version 5.1.0</a>.  You can
see a sample of what this will look like by going to
<a href="../Applications/maponly.html#ex16">example 16</a>
on the "maps only" applications page.
<p>

Meanwhile, if you already have latitude/longitude locations for the
desired outlines, then you can draw them yourself. There are some
examples where extra map outlines for India and Brazil were added by
hand.
<p>

Go to:

<blockquote>
<a href="../Applications/polyg.html">http://www.ncl.ucar.edu/Applications/polyg.shtml</a>
</blockquote>

and see examples 9 and 11.

<p><p>

<a name="vis_031"></a>
<li><i>If I am creating a color contour or vector plot, how do I select my colors such that they are spread across my whole color map?</i>
<p>


If you are using one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_<i>xxx</i></a> interfaces,
then, you can set the special resource <a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColors"><em>gsnSpreadColors</em></a> to True.  Otherwise, you can set
the <a href="../Document/Graphics/Resources/cn.html#cnFillColors"><em>cnFillColors</em></a> or <a href="../Document/Graphics/Resources/vc.html#vcLevelColors"><em>vcLevelColors</em></a> to arrays of color indices
or names.
<p>

Run the following script and compare the color fills in the two
frames:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"

  cdf_file = <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>("$NCARG_ROOT/lib/ncarg/data/cdf/contour.cdf","r")

  Z    = cdf_file->Z(0,0,:,:)           ; geopotential height

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","spread_colors")   ; Open an X11 workstation.

  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,"temp1")      ; Use a rainbow color map that
                                        ; has 63 colors and goes from
                                        ; gray to blue to red.
  res                       = True
  res@<a href="../Document/Graphics/Resources/cn.html#cnFillOn"><em>cnFillOn</em></a>              = True   ; Turn on contour fill.
  res@<a href="../Document/Graphics/Resources/lb.html#lbLabelAutoStride"><em>lbLabelAutoStride</em></a>     = True   ; Control labelbar label spacing.

  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,Z,res)  ; Draw a filled contour plot.
                                     ; are mostly blue.

  res@<a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColors"><em>gsnSpreadColors</em></a> = True         ; Choose colors across whole color map.
  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,Z,res)  ; Note that the contour colors now
                                     ; span from gray to blue to red.
</pre>
<p>

If you want to only use a subset of the color map, then you can also
set <a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColorStart"><em>gsnSpreadColorStart</em></a> and <a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColorEnd"><em>gsnSpreadColorEnd</em></a> resources:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"

  cdf_file = <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>("$NCARG_ROOT/lib/ncarg/data/cdf/contour.cdf","r")
  Z        = cdf_file->Z(0,0,:,:)           ; geopotential height

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","spread_colors")
  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,"tbr_240-300")

  res                      = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a>          = True
  res@<a href="../Document/Graphics/Resources/cn.html#cnFillOn"><em>cnFillOn</em></a>             = True    ; Turn on contour fill
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColors"><em>gsnSpreadColors</em></a>      = True    ; Spread the colors
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColorStart"><em>gsnSpreadColorStart</em></a>  =  23     ; Start at 24th color
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColorEnd"><em>gsnSpreadColorEnd</em></a>    = 187     ; There are 201 colors
  res@<a href="../Document/Graphics/Resources/lb.html#lbLabelAutoStride"><em>lbLabelAutoStride</em></a>    = True    ; Control labelbar labels

  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,Z,res)
</pre> 


<p><p>

<a name="vis_032"></a>
<li><i>How do I generate a wire-frame surface or isosurface plot in NCL?</i>
<p>


There are a basic set of 3D plotting routines, based on a library
interface called <inforef
uri="http://www.ncarg.ucar.edu/supplements/tdpack/">Tdpack</a>.
<p>

For wire-frame plots, you can use <a href="../Document/Functions/Built-in/tdez2d.html"><strong>tdez2d</strong></a>, and for
isosurfaces you can use <a href="../Document/Functions/Built-in/tdez3d.html"><strong>tdez3d</strong></a>.  For some examples
of these and other Tdpack routines, see the <a
href="../Applications/tdpack.html">Tdpack applications page</a>.

<p><p>

<a name="vis_033"></a>
<li><i>How do I draw weather symbols (wind barbs, weather front lines, high and low pressure indicators, arrows, dots, weather icons, cloud symbols, lightning bolts, etc.) on a map?</i>
<p>


Use the procedures <a href="../Document/Functions/Built-in/wmbarb.html"><strong>wmbarb</strong></a>,
<a href="../Document/Functions/Built-in/wmdrft.html"><strong>wmdrft</strong></a>, and/or <a href="../Document/Functions/Built-in/wmlabs.html"><strong>wmlabs</strong></a> in
combination with one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_*map*</a> functions.  <p>

Here's an example of drawing a weather front and a couple of "High"
symbols on a satellite view map projection:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

;  Create a color map and an X11 workstation.
  cmap = (/ (/ 1., 1., 1. /),    \  ; 0 - White background.
            (/ 0., 0., 0. /),    \  ; 1 - Black foreground.
            (/ 1., 0., 0. /),    \  ; 2 - Red.
            (/ 0., 0., 1. /),    \  ; 3 - Blue.
            (/ 0., 1., 1. /),    \  ; 4 - Cyan.
            (/ 1., 0., 1. /)/)      ; 5 - Magenta.

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","wmlabs")
  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,cmap)

;  Create a satellite view projection.
  mpres = True
  mpres@<a href="../Document/Graphics/Resources/gsn.html#gsnFrame"><em>gsnFrame</em></a>              = False        ; Don't advance the frame.
  mpres@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a>           = True         ; Maximize plot on page.
  mpres@<a href="../Document/Graphics/Resources/mp.html#mpOutlineBoundarySets"><em>mpOutlineBoundarySets</em></a> = "National"
  mpres@<a href="../Document/Graphics/Resources/mp.html#mpGridLineColor"><em>mpGridLineColor</em></a>       = 0
  mpres@<a href="../Document/Graphics/Resources/mp.html#mpCenterLatF"><em>mpCenterLatF</em></a>          =   40.
  mpres@<a href="../Document/Graphics/Resources/mp.html#mpCenterLonF"><em>mpCenterLonF</em></a>          = -105.
  map = <a href="../Document/Graphics/Interfaces/gsn_map.html"><strong>gsn_map</strong></a>(wks,"Satellite",mpres)

;  Draw a stationary front.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("ezf",1)           ; Tell wmap we are using an existing map projection.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("lin",1.0)         ; Line width of front curve.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("fro","stationary"); Specify stationary front.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("cfc",3)           ; Use blue for the triangles.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("wfc",2)           ; Use red for the bumps.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("swi",0.04)        ; Increase the size of the bumps and triangles.
  xlat = (/  20.,   30.,   35.,   40.,  45. , 50./)   ; Latitudes.
  xlon = (/-195., -125., -115., -105., -95., -85./)   ; Longitudes.
  <a href="../Document/Functions/Built-in/wmdrft.html"><strong>wmdrft</strong></a>(wks, xlat, xlon)   ; Draw front.

;  Draw a couple of High symbols.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("hib",4)              ; Cyan for background.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("his",1)              ; Black for shadow.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("hic",5)              ; Magenta for bounding circle.
  <a href="../Document/Functions/Built-in/wmsetp.html"><strong>wmsetp</strong></a>("sht",0.02)           ; Increase size.
  xl = (/  50.,  50./)         ; Latitudes.
  yl = (/-105.,-145./)         ; Longitudes.
  <a href="../Document/Functions/Built-in/wmlabs.html"><strong>wmlabs</strong></a>(wks, xl, yl, "HI")    ; Draw symbols.
  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a>(wks)
</pre>

<p><p>

<a name="vis_034"></a>
<li><i>How can I have a new line as part of a graphical text string in NCL?</i>
<p>


Use the <a href="../Document/Graphics/function_code.html">text function
code</a> that represents a carriage return ('C'):

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
begin
    wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","test")

; Assumes '~' is the function code, and not the default ':'
    title = "This is a title~C~with a carriage return"
    txres = True
    txres@<a href="../Document/Graphics/Resources/tx.html#txFontHeightF"><em>txFontHeightF</em></a> = 0.03
    <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,title,0.5,0.5,txres)
end
</pre>

<p><p>

<a name="vis_035"></a>
<li><i>How come I get different line thicknesses on different output devices using the same thickness value?</i>
<p>


Line thicknesses displayed on different output devices (X11,
PostScript, PDF, etc.) can be significantly different for the same
line thickness value.  This is due to several factors.
<p>

Every device has a default, or nominal, line thickness (also sometimes
call line width).  This nominal line width is the width of a line
drawn with the default thickness value of 1.0.  In general this
nominal line width is different for different devices.  What a given
device considers its default line width can vary from barely visible
to fat.  For example, the nominal line width for PostScript output may
look thinner than a line drawn with the same width specification on an
X11 window.  Also, the results for X11 output can vary depending on
the resolution of the output device.
<p>

The linewidth scale factor is applied to the nominal line width on a
given device.  However, it will not necessarily produce lines that are
exactly that factor bigger than the default width.  In fact the scale
factor may have no effect, or unexpected effects.  In general the
scale factor is applied to the default line width of the device and
maps onto the nearest available hardware line width that a device
supports. For printed PostScript output the results you get will
probably be as accurate as you will want, but for X11 output, or
PostScript displayed on a computer monitor, you will get varying
results.
<p>

Different devices also interpret fractional, or zero, line widths
differently.  For example, PostScript and PDF will always produce a
line, no matter how small the line width value is - a zero linewidth
value will produce a line one pixel wide.  However, for X11 output any
line width value less than 0.5 will usually map to a zero-width line,
that being the closest available hardware line width.  In contrast to
PS or PDF, a zero-width line in X11 output is not drawn.
<p>

If you are trying to "zero" out a line, the recommendation is to do it
some other way than setting the line thickness to 0.  For example, you
can draw it in the background color.  This way you will get the same
results for X11 and PostScript.
<p>

The bottom line is that you should not be surprised by what you get
when it comes to line widths - it definitely depends on the output
device.
<p>

The following script can be run to get an idea what various lines
drawn with different thickness specifications will look like on
different devices.

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

begin
  wktype = "ps"
  wks  = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a> (wktype, "thickness")
  cmap = (/"White","Black"/)
  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,cmap)

;
;  Main title.
;
  txres = True
  txres@<a href="../Document/Graphics/Resources/tx.html#txFontHeightF"><em>txFontHeightF</em></a> = 0.04
  txres@<a href="../Document/Graphics/Resources/tx.html#txFont"><em>txFont</em></a> = 22
  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,"Line thicknesses",0.5,0.95,txres)
  txres@<a href="../Document/Graphics/Resources/tx.html#txFontHeightF"><em>txFontHeightF</em></a> = 0.025
  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks, \
     "(results will vary depending on the output device)",0.5,0.88,txres)
 
;
;  Specify the sample line thicknesses.
;
  thicknesses = (/8.00, 4.00, 2.00, 1.00, 0.75, 0.50, 0.25, 0.00/)

;
;  Draw and label lines with the sample thicknesses.
;
  pres = True
  ytop = 0.78
  txres@<a href="../Document/Graphics/Resources/tx.html#txFontHeightF"><em>txFontHeightF</em></a> = 0.02
  txres@<a href="../Document/Graphics/Resources/tx.html#txJust"><em>txJust</em></a> = "CenterLeft"
  do i = 0,dimsizes(thicknesses)-1
    pres@<a href="../Document/Graphics/Resources/gs.html#gsLineThicknessF"><em>gsLineThicknessF</em></a>  = thicknesses(i)
    yh = ytop - 0.1*i
    <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,"Thickness = " + thicknesses(i),0.05,yh+0.025,txres)
    <a href="../Document/Graphics/Interfaces/gsn_polyline_ndc.html"><strong>gsn_polyline_ndc</strong></a>(wks,(/0.05,0.95/),(/yh,yh/),pres)
  end do

  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a> (wks)
end
</pre>


<p><p>

<a name="vis_036"></a>
<li><i>How can I put a timestamp on my plot?</i>
<p>


Use the <a href="../Document/Functions/Shea_util/infoTimeStamp.html"><strong>infoTimeStamp</strong></a> procedure:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/shea_util.ncl"

  data = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -19.69, 15.82, 0, (/129,129/))

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","max")

  plot = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,data,False)

  res             = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnFrame"><em>gsnFrame</em></a>    = False
  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,data,res)

  <a href="../Document/Functions/Shea_util/infoTimeStamp.html"><strong>infoTimeStamp</strong></a>(wks,0.02,"")

  <a href="../Document/Functions/Built-in/frame.html"><strong>frame</strong></a>(wks)
</pre>

<p><p>

<a name="vis_037"></a>
<li><i>Why am I not getting the color I expect when I reference a named color?</i>
<p>


Each <a href="../Document/glossary.html#NamedColor">named color</a>
has a specific <a href="../Document/glossary.html#RGB">RGB</a>
value associated with it. If this RGB value
is not in your current color map, then NCL will try to find the next
closest color using a special algorithm. Depending on your current
color map, this may yield surprising results.
<p>

The most common example of this problem is when somebody is using one
of the <a href="../Document/Graphics/Interfaces/index.html">gsn_csm_xxxx_map</a>
examples, which by default fill the land areas in light gray. If you
change your color map to one that doesn't have any shades of gray in
it, then the land masses will be filled in with the closest thing it
can find to gray.
<p>

The solution is to explicitly add gray (or whatever named color you
are referencing) to your color map:

<pre>
   wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","test")
   igray = <a href="../Document/Functions/Built-in/NhlNewColor.html"><strong>NhlNewColor</strong></a>(wks,0.7,0.7,0.7)
</pre>

You can see RGB values for every named color by clicking on any one of
the <a href="../Document/Graphics/named_colors.html">named color
thumbnails</a>, or looking at the big <a
href="../Document/Graphics/rgb.txt">RGB text file</a> that defines all
the named colors.

<p><p>

<a name="vis_038"></a>
<li><i>Why is my land not being filled in the color I expect?</i>
<p>


By default, the <a
href="../Document/Graphics/Interfaces/index.html">gsn_csm_xxxx_map</a> scripts try
to fill the land with gray. If you are using a color map that doesn't
have gray in it, then NCL will try to find the closest color to
gray. This might be white, or it might be something else entirely,
like pink.
<p>

There are three possible solutions:
<p>

<ol>

<li>If you don't want any land fill, then the solution is to turn off
map fill by setting res@<a href="../Document/Graphics/Resources/mp.html#mpFillOn"><em>mpFillOn</em></a>
= False.
<p>

<li>If you want the land filled in gray, then you will need to add
gray to your color map:
<p>

<pre>
   wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","test")
   <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,"some_color_map")
   igray = <a href="../Document/Functions/Built-in/NhlNewColor.html"><strong>NhlNewColor</strong></a>(wks,0.7,0.7,0.7)
</pre>
<p>

Gray will be added to the end of your existing color map, so if you
are creating filled contours or vectors, you may need to further set:
<p>

<pre>
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColorEnd"><em>gsnSpreadColorEnd</em></a> = -2   ; default is -1
</pre>
<p>

so that the last color is not included in your color contour or vector plot.
<p>

<li>If you want to fill the land in some other color, then set
res@<a href="../Document/Graphics/Resources/mp.html#mpLandFillColor"><em>mpLandFillColor</em></a> to a different
color.  </ol>

<p><p>

<a name="vis_039"></a>
<li><i>How do I set up my NCL script so that it uses a resource file?</i>
<p>


If you call <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a> to open a
workstation, then the second argument is what allows you to have an
optional resource file. For example, if you have the following
script:
<p>

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

begin  
; Create an X Workstation object.
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","title_app")

; Draw a text string
  <a href="../Document/Graphics/Interfaces/gsn_text_ndc.html"><strong>gsn_text_ndc</strong></a>(wks,"Hello, World",0.5,0.5,False)
end
</pre>

then it will look for a resource file called "title_app.res".  If you
then have the following lines in your "title_app.res" file:

<pre>
*<a href="../Document/Graphics/Resources/tx.html#txFontColor"><em>txFontColor</em></a>   : 2
*<a href="../Document/Graphics/Resources/tx.html#txFont"><em>txFont</em></a>        : helvetica-bold
*<a href="../Document/Graphics/Resources/tx.html#txFontHeightF"><em>txFontHeightF</em></a> : 0.06
</pre>

you should see a red "Hello, World" string in the center of the
frame.
<p>

Note that you cannot put the special <a
href="../Document/Graphics/Resources/gsn.html">gsn</a> resources in a
resource file!

<p><p>

<a name="vis_040"></a>
<li><i>How can I move and resize my labelbar and/or legend?</i>
<p>


This one confuses users, because they're not "lb" or "lg" resources as
one might expect. Instead, you need to use what
are called <a href="../Document/HLUs/Classes/PlotManager.html"><strong>PlotManager</strong></a> resources:

<dl>

<dt><a href="../Document/Graphics/Resources/pm.html#pmLabelBarOrthogonalPosF"><em>pmLabelBarOrthogonalPosF</em></a> /
    <a href="../Document/Graphics/Resources/pm.html#pmLegendOrthogonalPosF"><em>pmLegendOrthogonalPosF</em></a>
<dd>Moves labelbar or legend perpendicularly to the plot; start with
small values like 0.02 or -0.05.

<dt><a href="../Document/Graphics/Resources/pm.html#pmLabelBarParallelPosF"><em>pmLabelBarParallelPosF</em></a> / 
     <a href="../Document/Graphics/Resources/pm.html#pmLegendParallelPosF"><em>pmLegendParallelPosF</em></a>
<dd>Moves labelbar or legend parallel to plot; start with small
values like 0.02 or -0.05.

<dt><a href="../Document/Graphics/Resources/pm.html#pmLabelBarWidthF"><em>pmLabelBarWidthF</em></a> / 
    <a href="../Document/Graphics/Resources/pm.html#pmLegendWidthF"><em>pmLegendWidthF</em></a>
<dd>Sets width of labelbar or legend; use values between 0 and 1.

<dt><a href="../Document/Graphics/Resources/pm.html#pmLabelBarHeightF"><em>pmLabelBarHeightF</em></a> / 
    <a href="../Document/Graphics/Resources/pm.html#pmLegendHeightF"><em>pmLegendHeightF</em></a>
<dd>Sets height of labelbar or legend; use values between 0 and 1.

</dl>

Here's an example that changes the labelbar width, height, and
location:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"

  cdf_file = <a href="../Document/Functions/Built-in/addfile.html"><strong>addfile</strong></a>("$NCARG_ROOT/lib/ncarg/data/cdf/contour.cdf","r")
  Z        = cdf_file->Z(0,0,:,:)           ; geopotential height

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","labelbar")
  <a href="../Document/Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,"temp1")

  res                          = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a>              = True   ; Maximize plot
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnSpreadColors"><em>gsnSpreadColors</em></a>          = True   ; Span full color map
  res@<a href="../Document/Graphics/Resources/cn.html#cnFillOn"><em>cnFillOn</em></a>                 = True   ; Turn on contour fill.
  res@<a href="../Document/Graphics/Resources/lb.html#lbLabelAutoStride"><em>lbLabelAutoStride</em></a>        = True   ; Control labelbar label spacing

  res@<a href="../Document/Graphics/Resources/pm.html#pmLabelBarOrthogonalPosF"><em>pmLabelBarOrthogonalPosF</em></a> = -0.03  ; Move labelbar towards plot
  res@<a href="../Document/Graphics/Resources/pm.html#pmLabelBarWidthF"><em>pmLabelBarWidthF</em></a>         =  0.50  ; Width of labelbar
  res@<a href="../Document/Graphics/Resources/pm.html#pmLabelBarHeightF"><em>pmLabelBarHeightF</em></a>        =  0.10  ; Height of labelbar

  plot = <a href="../Document/Graphics/Interfaces/gsn_csm_contour.html"><strong>gsn_csm_contour</strong></a>(wks,Z,res)
</pre>

<p><p>

<a name="vis_041"></a>
<li><i>How can I set the precision of the label bar labels?</i>
<p>


For contour plots, you can use the <a href="../Document/Graphics/Resources/cn.html#cnLineLabelFormat"><em>cnLineLabelFormat</em></a> resource.

<p><p>

<a name="vis_042"></a>
<li><i>How can I generate some "nice" 2D random data for a contour and/or vector plot?</i>
<p>


Use the <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a> function:

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

  data = <a href="../Document/Functions/Built-in/generate_2d_array.html"><strong>generate_2d_array</strong></a>(10, 10, -19.69, 15.82, 0, (/129,129/))

  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("x11","max")

  plot = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,data,False)

  res             = True
  res@<a href="../Document/Graphics/Resources/gsn.html#gsnMaximize"><em>gsnMaximize</em></a> = True
  plot = <a href="../Document/Graphics/Interfaces/gsn_contour.html"><strong>gsn_contour</strong></a>(wks,data,res)
</pre>


Also, see example 17 on the <a href="../Applications/panel.html#ex17">panel applications page</a>.

<p><p>

</ol><p>


<h3>Array functions</h3>
<p>

<ol>
<a name="array_funcs_001"></a>
<li><i>How do I get the dimensions of an array?</i>
<p>


Use the <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a> function, which returns the
dimension sizes as a one-dimensional array.  For example, if your array
was set with:<p>

<pre>
  x = (/(/(/5,2/), (/2,3/), (/4,4/)/), (/(/0,8/), (/5,1/), (/3,6/)/), \
        (/(/9,9/), (/3,0/), (/5,7/)/), (/(/2,1/), (/4,7/), (/1,6/)/)/)
</pre>

then the following code

<pre>
  y = <a href="../Document/Functions/Built-in/dimsizes.html"><strong>dimsizes</strong></a>(x)
</pre>

will return <TT>y</TT> equal to (/4, 3, 2/).

<p><p>

<a name="array_funcs_002"></a>
<li><i>How do I create unique random subscripts?</i>
<p>


Use the function <a href="../Document/Functions/Contributed/generate_unique_indices.html"><strong>generate_unique_indices</strong></a>.
<p>

You can also do this by hand. For example, to generate 1000 unique
subscripts:

<pre>
  r = <a href="../Document/Functions/Built-in/random_uniform.html"><strong>random_uniform</strong></a>(0,1,1000)  ; random numbers
  i = <a href="../Document/Functions/Built-in/dim_pqsort.html"><strong>dim_pqsort</strong></a>(r, 1)           ; return indices
</pre>

<p><p>

<a name="array_funcs_003"></a>
<li><i>How do I eliminate missing values from a one-dimensional array?</i>
<p>


Say you have a triplet: lat[*], lon[*], val[*] where "val"
has some values set to _FillValue. One approach to eliminating 
triplets that have missing values is to use the <a href="../Document/Functions/Built-in/ind.html"><strong>ind</strong></a>
and <a href="../Document/Functions/Built-in/ismissing.html"><strong>ismissing</strong></a> functions and the <b>.not.</b>
relational operator:

<pre>
  ii = <a href="../Document/Functions/Built-in/ind.html"><strong>ind</strong></a>( <b>.not.</b><a href="../Document/Functions/Built-in/ismissing.html"><strong>ismissing</strong></a>(val) )
  if(.not.<a href="../Document/Functions/Built-in/any.html"><strong>any</strong></a>(<a href="../Document/Functions/Built-in/ismissing.html"><strong>ismissing</strong></a>(ii))) then
    LAT = lat(ii)    ; triplet with no "val" set to _FillValue
    LON = lon(ii)
    VAL = val(ii)
  else
    LAT = lat
    LON = lon
    VAL = val
  end if
</pre>

The "if" statement is necessary, because if "val" doesn't contain any
missing values, then "ii" will be a missing value and trying to use
it as a subscript will cause a fatal error.

<p><p>

<a name="array_funcs_004"></a>
<li><i>How do I generate a one-dimensional array of equally-spaced integers or floating point numbers?</i>
<p>


Use the function <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a> to generate integers and
<a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a> to generate floats. For example, to generate
the list of integers (9, 12, 15, ..., 96, 99):

<pre>
   iarray = <a href="../Document/Functions/Built-in/ispan.html"><strong>ispan</strong></a>(9,99,3)
</pre>

To generate 20 equally-spaced floating point numbers between 0.0 and
50.0:

<pre>
   farray = <a href="../Document/Functions/Built-in/fspan.html"><strong>fspan</strong></a>(0.0,50.0,20)
</pre>

<p><p>

<a name="array_funcs_005"></a>
<li><i>How do I find or print the minimum/maximum values of my data array?</i>
<p>


Use the functions <a href="../Document/Functions/Built-in/min.html"><strong>min</strong></a> and <a href="../Document/Functions/Built-in/max.html"><strong>max</strong></a>.
For example, in the following NCL code where <tt>x</tt> is a 4 x 2
array, <tt>xmin</tt> will be equal to -3 and <tt>xmax</tt> will be
equal to 8:

<pre>
   x = (/(/-1,3/), (/0,5/), (/1,-2/), (/-3,8/)/)
   xmin = <a href="../Document/Functions/Built-in/min.html"><strong>min</strong></a>(x)
   xmax = <a href="../Document/Functions/Built-in/max.html"><strong>max</strong></a>(x)
</pre>

You can use the <a href="../Document/Functions/Contributed/printMinMax.html"><strong>printMinMax</strong></a>
procedure to "pretty" print the min/max values.

<p><p>

</ol><p>


<h3>Graphical output</h3>
<p>

<ol>
<a name="o_formats_001"></a>
<li><i>How do I change the default NCGM/PostScript/PDF file name to something else?</i>
<p>


Change the second argument in the call to <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>.  Here's an example of changing
the PS file name to "plot1.ps":
<p>

<pre>
  load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"

begin
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("ps","plot1")

  plot = <a href="../Document/Graphics/Interfaces/gsn_map.html"><strong>gsn_map</strong></a>(wks,"CylindricalEquidistant",False)

end
</pre>

<p><p>

<a name="o_formats_002"></a>
<li><i>How do I convert my NCL graphics file to another format, like PNG, to put on the web or in a presentation?</i>
<p>


You can directly write your graphics to a "PNG" file using "png" as
the first argument to <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>.
<p>

If you want more control over the PNG image, or you want to send it to
a different output format, you can first write the output to a
PostScript (PS) or Encapsulated PostScript (EPS) file, and then use
"convert" from the ImageMagick suite of tools or <a
href="#pstoimg">pstoimg</a> to convert to "png" or another format.<p>

You can get the ImageMagick suite from: 

<BLOCKQUOTE>
<a href="http://www.imagemagick.org/">http://www.imagemagick.org/</a>
</BLOCKQUOTE>

Click on the "download" link on the left side and you will be
presented with lots of options for download locations.
<p>

Once you have the tools built and installed, you can convert your PS 
files to other formats using: 
<p>

<pre>
    convert -geometry 800x800 -density 300 -trim file.ps file.png 
</pre>

The "geometry" option allows you to specify a pixel size for the
image.  This must be a square. The "-density" option allows you to
increase the quality of the image, which is especially important if
you plan to make a large poster. The "-trim" option removes white
space around the image.  <p>

You can put the "convert" command right in your NCL script, after
all the calls that generate graphics, but you must delete the
workstation first:

<pre>
  fname = "example"
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("ps",fname)
  ...code for generating graphics
  <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a>(wks)

  cmd = "convert -geometry 800x800 -density 300 -trim " + fname + ".ps " + \
                                                          fname + ".png"
  <a href="../Document/Functions/Built-in/system.html"><strong>system</strong></a>(cmd)
</pre>

The <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a> procedure effectively causes your PS file
to be closed properly.
<p>

Documentation on "convert" can be found at: 
<p>

<BLOCKQUOTE>
<a href="http://www.imagemagick.org/script/convert.php">http://www.imagemagick.org/script/convert.php</a>
</BLOCKQUOTE>

There are lots of options available with convert, that, according to 
their web page, allow you to "resize an image, blur, despeckle, 
dither, draw on, flip, join, re-sample, and much more." 
<p>

<a name="pstoimg"></a>
Another tool recommended by a user is "pstoimg", which 
can create smaller PNG files and of better bettery quality (we
haven't verified this personally). Here's a sample conversion
line for going from PDF to PNG:

<pre>
   pstoimg -trans -interlace -type png -density 120 -crop a -multi *.pdf
</pre>

<p><p>

<a name="o_formats_003"></a>
<li><i>How do I remove all the white space from an image?</i>
<p>


See the question above on how to create a PNG image for web or presentation
tools.  If you're using "convert" to convert images, you can use the
"-trim" option as a start.

<p><p>

<a name="o_formats_004"></a>
<li><i>Is there a way to make the PostScript files generated by NCL smaller?</i>
<p>


We hope to fix the problem of large PostScript files in V5.2.0 of NCL.
Meanwhile, check if your system has an application called "ps2pdf".
This application will compress a PS file and create a smaller PDF
file.
<p>

<pre>
  ps2pdf input_postscript_file ouput_pdf_file
</pre>

If you are on a Mac, you can use "Preview" to reduce the file size.
Open the file with "Preview", click "Save as ..."  under the file
menu, and select "Reduce File Size" for the Quartz Filter in the
pop-up menu.

<p><p>

<a name="o_formats_005"></a>
<li><i>Can I produce a PNG image directly from NCL?</i>
<p>


You can call the <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>
function with "png" as the type (first argument). 

<p><p>

<a name="o_formats_006"></a>
<li><i>Is there a way to remove the ".000001." from the PNG filename?</i>
<p>


We plan to add an option in a future release of NCL to not include
the frame number if you are generating a single image.
<p>

Meanwhile, you can use the <a href="../Document/Functions/Built-in/system.html"><strong>system</strong></a> command to rename
the file.  You have to be sure to call <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a> on
the workstation first, to properly close the file.  <p>

<pre>
  fname = "example"
  wks = <a href="../Document/Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("ps",fname)
  ...code for generating graphics
  <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a>(wks)

  cmd = "mv " + fname + ".000001.png " + fname + ".png")
  <a href="../Document/Functions/Built-in/system.html"><strong>system</strong></a>(cmd)
</pre>
<p><p>

<a name="o_formats_007"></a>
<li><i>How can I tilt an NCL graphic?</i>
<p>


You can't do this with NCL directly, but if you send the output to a PNG file:
<pre>
   wks = gsn_open_wks("png","file")
</pre>

Then you can use the free <a href="http://www.fmwconcepts.com/imagemagick/rotate3D/index.php">rotate3D</a>
tool, that depends on <a href="http://www.imagemagick.org/script/index.php">ImageMagick</a>. You may already
have ImageMagick installed if you use a tool called "convert".
<p>

To use rotate3D, you can do it after you run the NCL script:

<pre>
   rotate3D 0,45,0 file.png file_tilt.png
</pre>
<p>

Or, you can do it directly in the NCL script, after you are done
drawing to the PNG file. You first have to call
<a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a> on the workstation object to make sure the
PNG file is properly closed:

<pre>
  wks = gsn_open_wks("png","file")
  . . . draw some graphics . . .
  delete(wks)

  system("rotate3D 0,45,0 file.png file_tilt.png")
</pre>

<p><p>

<a name="o_formats_008"></a>
<li><i>How can I convert a series of PS or EPS files to an animation?</i>
<p>


Take a look at:

<blockquote>
<a href="http://www.imagemagick.org/Usage/anim_basics/#loop">http://www.imagemagick.org/Usage/anim_basics/#loop</a>
</blockquote>
<p>

It shows how to create animations with <a
href="http://www.imagemagick.org/">ImageMagick</a>, a graphical suite
for image manipulation. For example, using "convert" from ImageMagick,
you can do something like this: <p>

<pre>
   convert -delay 50 *.eps anim.gif
</pre>
<p>

Then display "anim.gif" in your browser or other suitable viewer.
<p>

[Thanks to Matues Teixeira and Dave Allured for these suggestions.]
<p>

Another suggestion came from Robert Cohen of East Stroudsburg University:

<ul>
<li>Generate one PostScript for each image.

<li>Run ImageMagick's "convert" tool to convert each to an mpeg file
(Robert had to use a Windows version of "convert" since the Cygwin version
had problems)

<li>Run "<a href="http://www.ffmpeg.org/">ffmpeg</a>" to combine all of
the files into one AVI file. (Robert found that AVI produced a better
video loop than MPEG).

<li>The end result ran fine on a 32-bit machine and looked fine in
Windows Media Player or PowerPoint.

</ul>

<p><p>

<a name="o_formats_009"></a>
<li><i>How can I produce Google Earth kmz files?</i>
<p>


Ryan Pavlick of the Max Planck Institute for Biogeochemistry created
an NCL script showing how to do this. See:
<p>

<blockquote>
<a href="http://rpavlick.github.io/kmlncl"> http://rpavlick.github.io/kmlncl</a>

</blockquote>

<p><p>

<a name="o_formats_010"></a>
<li><i>How do I convert my multi-frame NCL graphics file to an MPEG movie file?</i>
<p>


You can start with a PostScript (PS) file, and then use "convert" from
the ImageMagick suite of tools to convert the PS file to an MPEG file.
<p>

First install the <a
href="http://www.imagemagick.org/">ImageMagick</a> tools installed on
your system. These are a suite of free tools from converting from one
format to another.  <p>

You will also need to download the program "mpeg2encode". The source
code for this can be downloaded from:
<p>

<BLOCKQUOTE>
<a href="http://www.mpeg.org/">http://www.mpeg.org/</a>
</BLOCKQUOTE>
<p>

From here you want to download the source code for "mpeg2vidcodec".
The "mpeg2encode" code is pretty straightforward to build (in the
directory mpeg2/src/mpeg2enc).
<p>

Once you have mpeg2encode installed, you can convert your 
PS file to MPEG with: 
<p>

<pre>
   convert file.ps file.mpg 
</pre>


<p><p>

<a name="o_formats_011"></a>
<li><i>How do I include an encapsulated PostScript file from NCL in a LaTex document?</i>
<p>


Let's say that you need to include an encapsuled postscript 
generated by NCL in your LaTeX document. If this image contains 
character strings, you may want them to be written in your own 
LaTeX style. Here is a solution contributed by Raphael Pierre, 
a PhD student at Fresnel Institute in France:
<p>

As an example, let's consider the x-axis label of some plot.

<ol>
<li>  Adapting the NCL source file.
<p>

A priori, no matter the font you specify in your .ncl file, just pick one.
<pre>
       res@<a href="../Document/Graphics/Resources/ti.html#tiXAxisFont"><em>tiXAxisFont</em></a> = 21 ; Helvetica.
</pre>
Choose a dummy character (you'll have to reuse it afterwards) but avoid character strings.
<pre>
       res@<a href="../Document/Graphics/Resources/ti.html#tiXAxisString"><em>tiXAxisString</em></a> = "a"
</pre>
    The important step is the one that follows.
<pre>
       res@<a href="../Document/Graphics/Resources/ti.html#tiXAxisFontQuality"><em>tiXAxisFontQuality</em></a> = "Low"
</pre>
    This option forces NCL to include the font in the output file, the .eps image.
<p>

    To ensure this has been done correctly, open the .eps file with a text editor and check if a line like that:
<pre>
    %%DocumentFonts: Helvetica
</pre>
    appears at the bottom.
<p>

<li>Adapting the LaTeX source file.
<p>

Add the usual packages for including graphics (e.g. graphicx). 
Add the PSfrag package (available on CTAN and in usual LaTeX distros) 
which will permit you to replace the dummy character by the adequate string.

<pre>
   \usepackage{psfrag}
</pre>

Use the appropriate command.
<pre>
       \begin{figure}
       \psfrag{a}{$x$}
       \includegraphics{figure.eps}
       \end{figure}
</pre>
    And you're done.

<p><p>

</ol><p>


<h3>Error messages and other issues</h3>
<p>

<ol>
<a name="err_msgs_001"></a>
<li><i>When I send my NCL graphics to an X11 window, only a partial image is drawn.</i>
<p>


We have seen issues with X11 on machines that have embedded Intel
graphics processors. The behavior is that the plot is only partially
drawn, and if you run the script several times back-to-back you may
see the plot is drawn to varying/random levels of (in)completeness.
<p>

If you determine you have an Intel GPU on your machine, make
sure you have their latest graphics drivers installed.

<p><p>

<a name="err_msgs_002"></a>
<li><i>When I run my script, I'm getting a "fatal:NclMalloc Failed" error message.</i>
<p>


This message likely means the memory requirements of the variable(s) in an
NCL script have exceeded the available memory on your machine. This can 
happen if you are trying to read or create very large arrays, or if you 
have lots and lots of variables.
<p>

Say, for example, there is 8 GB of available memory and there are two
variables of type float (4 bytes) that have the following dimensions:
<p>

<pre>
  x(ntim,nlat,mlon)      (1320,360,720)
  x: 1320*360*720       = 342144000 values
  x: bytes              = 342144000*4  = 1368576000 bytes (~1.37GB)

  y(ntim,klev,nlat,mlon) (1320,6,360,720)
  y: 1320*6*360*720     = 2052864000 values
  y: bytes              = 2052864000*4 = 8211456000 bytes (~8.21GB)
</pre>
<p>

These two arrays require 9,580,032,000 bytes (~9.58 GB). This will lead to an error:
<p>

<pre>
    fatal:NclMalloc Failed
</pre>
<p>

Possible approaches:
<p>

<ul>
<li>Read fewer 'time' steps and retain the spatial dimensions:<p>

<pre>
  x = f->X(0:ntim/2,:,:)   or   x = f->X(ntim/2:,:,)
  y = f->Y(0:ntim/2,:,:,:) or   y = f->Y(ntim/2:,:,:,:)
</pre>

<li>Reduce the spatial dimensions:
<p>

<pre>
  x = f->X(:,::2,::2)    or   x = f->X(:,::2,::4)
  y = f->Y(:,:,::2,::2)  or   y = f->Y(:,:,::2,::4)
</pre>
</ul>
<p>

If you don't have really big arrays, but you have created lots of variables in
your script, then use <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a> to remove variables you no longer need:<p>
<p>

<pre>
   f = addfile("some_file.nc","r")
   T      = f->T
   P      = f->P
   QVAPOR = f->QVAPOR
   PH     = f->PH
   T      = T + 300.
   P      = P + f->PB
   QVAPOR = QVAPOR > 0.000
   PH     = ( PH + f->PHB ) / 9.81

   z      = wrf_user_unstagger(PH,PH@stagger)
   tk     = wrf_tk( P , T )    ; calculate TK                                                     
   delete([/PH,T/])

   slp    = wrf_slp( z, tk, P, QVAPOR )
   delete([/z,tk,P,QVAPOR/])
</pre>
<p>

Note that several <a href="../Document/Functions/Built-in/delete.html"><strong>delete</strong></a> commands are used, rather than one big one at the
end. This is so you can free up memory as you go, in case new calculations cause you to
exceed your machine's memory limit.
<p><p>

<a name="err_msgs_003"></a>
<li><i>When I run NCL, I get an error message about being unable to load the "System Resource File".</i>
<p>


If your error message looks like this:

<pre>
warning:Unable to load System Resource File /usr/local/lib/ncarg/sysresfile
warning:WorkstationClassInitialize:Unable to access rgb color database - 
        named colors unsupported:[errno=2]
warning:["Palette.c":1533]:NhlLoadColormapFiles: Invalid colormap directory:
        /usr/local/lib/ncarg/colormaps
</pre>
<p>

then you likely don't have your NCARG_ROOT environment variable set correctly.
<p>

If it looks like this:
<p>

<pre>
warning:Unable to Get System Resource File Name?
warning:Unable to load System Resource File (null)
fatal:GetSysAppDir:Unable to get a default value for the system App Resource directory
</pre>
<p>

then you likely don't have your NCARG_ROOT environment set at all.
<p>

NCARG_ROOT needs to be set to the <i>root</i> location of where the NCL
software is installed.  If you are not sure what NCARG_ROOT should be
set to, type (on the UNIX command line):
<p>

<pre>
    which ncl
</pre>
<p>

If this returns (for example), "/usr/local/ncl/bin", then NCARG_ROOT
should be set to /usr/local/ncl.  See the section "<a
href="../Download/install.html#SetNCARG_ROOT">Set the NCARG_ROOT
environment variable</a>" section on the <a href=".edu/Download/index.html">NCL
download page</a> for more information.

<p><p>

<a name="err_msgs_004"></a>
<li><i>When I run NCL, I get an error message about the X driver, like "error opening display".</i>
<p>


If your error message looks like this:

<pre>
warning:GKS:GOPWK: --X driver error: DISPLAY environment variable not set
warning:GKS:GESC: --SPECIFIED WORKSTATION IS NOT OPEN
fatal:Workstation with PID#8 is not open
fatal:Unable to open Workstation-Can't Create
fatal:Unable to access object with id:-4
...
</pre>

then this means that NCL is trying to open an X11 window on your
screen, but your DISPLAY environment variable is not set. This is
necessary in order to display <i>any</i> kind of X application
to your screen.
<p>

See the section "<a href="../Download/install.html#SetDISPLAY">Set the
DISPLAY environment variable</a>" section on the <a
href=".edu/Download/index.html">NCL download page</a> for information on how to
set it.

<p><p>

<a name="err_msgs_005"></a>
<li><i>What's the deal with the error message "error: line -1 before or near..."?</i>
<p>


If you get this error message when running an NCL script:

<pre>
  fatal:syntax error: line -1 before or near

  ^

  fatal:error in statement
</pre>

then you probably have a "begin" statement in your script, but no
"end" statement.

<p><p>

<a name="err_msgs_006"></a>
<li><i>How can I redirect NCL's error messages to another file?</i>
<p>


You can add the following code near the top of your NCL script:
<p>

<pre>
  err = NhlGetErrorObjectId()
  setvalues err
    "errFileName" : "my_script_errors"
  end setvalues
</pre>

For more information about error reporting, see
the documentation for <a href="../Document/Functions/Built-in/NhlGetErrorObjectId.html"><strong>NhlGetErrorObjectId</strong></a>.

<p><p>

<a name="err_msgs_007"></a>
<li><i>How can I turn off NCL warning messages?</i>
<p>


You can add the following code near the top of your NCL script:
<p>

<pre>
  err = NhlGetErrorObjectId()
  setvalues err
    "errLevel" : "Fatal"          ; only report Fatal errors
  end setvalues
</pre>

This will turn off <b>all</b> "warning" type messages, so only
do this if you are feeling pretty confident about your code.
<p>

For more information about error reporting, see
the documentation for <a href="../Document/Functions/Built-in/NhlGetErrorObjectId.html"><strong>NhlGetErrorObjectId</strong></a>.

<p><p>

<a name="err_msgs_008"></a>
<li><i>I'm trying to list some files, and getting an error "Argument list too long".</i>
<p>


If you are using something like NCL's <a href="../Document/Functions/Built-in/systemfunc.html"><strong>systemfunc</strong></a>
command to create a list of files.
<p>

<pre>
  diri  = "/some/directory/path/"
  files = systemfunc("ls -1 " + diri + "sgp15swfcldgrid*")
</pre>
<p>

and getting the following error:
<p>

<pre>
  sh: /bin/ls: Argument list too long
</pre>
<p>

Then you can use one of the two methods instead:
<p>

<pre>
  files = systemfunc("cd "+diri+" ; echo sgp15swfcldgrid* | xargs ls")

  files = systemfunc("find " + diri + " -name 'sgp15swfcldgrid*' -print | xargs basename")
</pre>

<p><p>

<a name="err_msgs_009"></a>
<li><i>When I try to run ncl, I get an error about "libgfortran.so.x" not being found.</i>
<p>


This can happen if your version of NCL was compiled with a different
version of "gfortran" than what you have installed on your system.
<p>

To fix this, you can try one of these things:

<ol>

<li>Make sure you downloaded the correct NCL for your system. For
Linux systems, we offer binaries compiled with different versions of
"gcc", so make sure you downloaded the correct one. See <a
href="../Download/linux.html">http://www.ncl.ucar.edu/Download/linux.shtml</a>
for more information.
<p>

<li>Try to find the libgfortran.so.<i>x</i> file that it is
complaining about. If found, add this path to your LD_LIBRARY_PATH
(or DYLD_LIBRARY_PATH for MacOS) environment variable.
<p>

<li>For Linux systems, install the "compat-libgfortran" runtime
library. See one of these sites for starters: <p>

<ul>

<li><a href="http://rpmfind.net/linux/rpm2html/search.php?query=compat-libgfortran-41">http://rpmfind.net/linux/rpm2html/search.php?query=compat-libgfortran-41</a>

<li><a href="https://admin.fedoraproject.org/pkgdb/acls/name/compat-libgfortran-41?_csrf_token=8a34a015d0f0b3ccca2627a1a58108960859779f">https://admin.fedoraproject.org/pkgdb/acls/name/compat-libgfortran-41?_csrf_token=8a34a015d0f0b3ccca2627a1a58108960859779f</a>

</ul>
<p>

<li>Install the version of gfortran that your version of NCL was built
with. (It is possible to have multiple versions of gfortran installed
on the same system without conflict.)
<p>

For MacOS systems, you can use <a href="http://www.macports.org/ports.php">MacPorts</a>
to get gcc/gfortran. Enter "gcc" in the search box and look for packages
called something like "gcc45", or "gcc46", depending on which version you need.
<p>


Once you install gcc/gfortran, it may then be necessary to set the
LD_LIBRARY_PATH (or DYLD_LIBRARY_PATH for MacOS) environment variable
to the path of the "libgfortran.so.<i>x</i>" file.  <p>

<li>If all else fails, send email to the <a
href="http://mailman.ucar.edu/mailman/listinfo/ncl-install">ncl-install</a>
list.

</ol>
<p>

<p><p>

<a name="err_msgs_010"></a>
<li><i>I'm trying to compile my NCAR Graphics program using the Intel or gfortran compiler, but getting some undefined references.</i>
<p>


If your undefined references contain the string "gfortran", like
"_gfortran_copy_string", then you may need to link in "-lgfortran":

<pre>
  ifort -O agex01.f -L/usr/local/lib -L/usr/X11R6/lib -lncarg -lncarg_gks \
        -lncarg_c -lXpm -lX11 -lXext -lgfortran
</pre>


Note: if you use "ncargf77" or "nhlf77" to compile your programs, then
you can modify these to include the extra libraries needed (and change
the compiler if desired).  Edit the files $NCARG_ROOT/bin/ncargf77 and
$NCARG_ROOT/bin/nhlf77 with your favorite UNIX editor and first change
the line:
<p>

<pre>
set fortran = "gfortran"
</pre>

or
<p>

<pre>
set f77 = "gfortran"
</pre>

to whatever Fortran compiler you are using, and 
<p>

<pre>
set libextra = ""
</pre>

or
<p>

<pre>
set extralibs = ""
</pre>

to whatever additional libraries you might need, for example:
<p>

<pre>
set libextra = "-lgcc -lg2c"
</pre>

or
<p>

<pre>
set libextra = "-lgfortran"
</pre>
<p>

If you are getting some undefined references (like "s_cmp" or
"s_copy") when you compile your NCAR Graphics program, then you may
need to link in some additional compiler libraries.  <p>

For example, if your undefined references are "s_cmp", etc, then the
additional system libraries should be "-lgcc -lg2c":
<p>

<pre>
  ifort -O agex01.f -L/usr/local/lib -L/usr/X11R6/lib -lncarg -lncarg_gks \
        -lncarg_c -lXpm -lX11 -lXext -lgcc -lg2c
</pre>

These librares may available through the "compat-g77" package.
<p>

<p><p>

<a name="err_msgs_011"></a>
<li><i>When I run ncl version 5.2.0, I get an error "warning:ut_calendar: Invalid specification string."</i>
<p>


NCL Version 5.2.0 was built against UDUNITS-2, V2.1.14. It needs to
have the correct path to some UDUNITS xml files in order to work
properly.<p>

If you have the environment variable UDUNITS2_XML_PATH set to point to
an different version of UDUNITS-2, then you may see this message. Try
unsetting this environment variable with "unset" or "unsetenv".

<p><p>

<a name="err_msgs_012"></a>
<li><i>When I run ncl, I get an error about libpng not being current.</i>
<p>


The "ncl" executable has several dependencies on the PNG library
(libpng), and there may be a dependency on a shared version of this
library.  Most Linux and MacOS systems come with this library already
installed.  <p>

In some cases, however, you may have an older version of this library
on your system, and "ncl" may complain that it is not current enough.
<p>

We ran into one case where upgrading an Apple system from MacOS 10.5.2
to MacOS 10.5.8 solved the problem, because that caused the PNG
library to be upgraded.  <p>

If you don't have this library, then it is fairly simple to build and
install if you have a C compiler, or you can download an already
compiled library for your system. First check with your system
administrator about upgrading your version of this library.
<p>

To get an updated version yourself:

<ul>
<li>Go to <a
href="http://www.libpng.org/pub/png/libpng.html">http://www.libpng.org/pub/png/libpng.html</a>
and either download a precompiled binary, or the source code (the
".tar.gz" file under "with config script").
<p>

<li>For instructions on building from source code, go to:
<blockquote>
<a href="../Download/build_from_src.html#PNG">http://www.ncl.ucar.edu/Download/build_from_src.shtml#PNG</a>
</blockquote>
<p>

</ul>

<p><p>

<a name="err_msgs_013"></a>
<li><i>I'm getting an error from WRAPIT about being unable to find "-lgfortran".</i>
<p>


On LINUX and MacOS systems, WRAPIT will use the gfortran compiler by
default.  On some systems, the gfortran library (libgfortran.a)
may be installed in a location that can't be automatically "seen" by
WRAPIT.  You can use the UNIX "locate" command to find the gfortran library,
and the the "-L" option with WRAPIT to indicate where it is.
<p>

For example, if:

<pre>
   locate libgfortran.a
</pre>

returns:<p>

<pre>
   /usr/lib/gcc/x86_64-redhat-linux/4.1.1/libgfortran.a
</pre>

then your WRAPIT command will look like this:
<p>

<pre>
   WRAPIT -L /usr/lib/gcc/x86_64-redhat-linux/4.1.1 yourfile.f
</pre>

<p><p>

<a name="err_msgs_014"></a>
<li><i>I'm getting a strange "workspace reallocation" error message.</i>
<p>


If you get an error message that looks something like this:

<pre>
    fatal:ContourPlotDraw: Workspace reallocation would exceed maximum size
    16777216
    fatal:ContourPlotDraw: draw error
    fatal:ContourPlotDraw: draw error
    fatal:PlotManagerDraw: error in plot draw
    fatal:_NhlPlotManagerDraw: Draw error
</pre>

then you need to bump up your workspace size. First, retrieve the
default "workspace id", and then set the "<a href="../Document/Graphics/Resources/ws.html#wsMaximumSize"><em>wsMaximumSize</em></a>" resource to a value larger
than 100000000, the default value.  To do this, add the following code
right after you create a workstation: <p>

<pre>
  setvalues <a href="../Document/Functions/Built-in/NhlGetWorkspaceObjectId.html"><strong>NhlGetWorkspaceObjectId</strong></a>() 
    "<a href="../Document/Graphics/Resources/ws.html#wsMaximumSize"><em>wsMaximumSize</em></a>" : 300000000
  end setvalues 
</pre>

You can permanently bump up the workspace size by setting this
resource in your <a
href="../Document/Graphics/hlures.html">~/.hluresfile</a>:

<pre>
  *<a href="../Document/Graphics/Resources/ws.html#wsMaximumSize"><em>wsMaximumSize</em></a> : 300000000
</pre>

You may also need to play with the 300000000 value. This is just
a first guess.<p>

If you are drawing a contour plot, you might instead try switching to
raster contouring, by setting the resource "<a href="../Document/Graphics/Resources/cn.html#cnFillMode"><em>cnFillMode</em></a>" to "RasterFill".

<p><p>

<a name="err_msgs_015"></a>
<li><i>I am trying to create a contour plot and getting an error about the scalar field being constant.</i>
<p>


If you see this error message:
<p>
<pre>
warning:ContourPlotInitialize: scalar field is constant; ContourPlot not possible:[errno=1102]
</pre>
<p>

it's because you are either 1) trying to contour an array that is all
equal to the same value or 2) trying to contour an array that's a mix
of one value and missing values. There is currently no way to generate
contours from the first case, but if you have the second case, then
you can use a work-around of setting the missing values to a valid
value, thus giving you two valid values that you can contour.  <p>

See example "conLev_4.ncl" on the <a
href="../Applications/contourLev.html#ex4">contour levels</a> page.

<p><p>

<a name="err_msgs_016"></a>
<li><i>I am trying to create a contour plot and getting errors about sfXArray and sfYArray having an incorrect dimension size.</i>
<p>


If the error looks like this:
<p>

<pre>
warning:ScalarFieldSetValues: 2d coordinate array sfXArray has an incorrect dimension size: defaulting sfXArray
warning:ScalarFieldSetValues: 2d coordinate array sfYArray has an incorrect dimension size: defaulting sfYArray
</pre>
<p>

Then it may be that you are calling one of the gsn_csm_contour_xxxx
plotting scripts, which try to add a longitude cyclic point by
default. You can turn this off by setting <a href="../Document/Graphics/Resources/gsn.html#gsnAddCyclic"><em>gsnAddCyclic</em></a> to False.

<p><p>

<a name="err_msgs_017"></a>
<li><i>I'm getting a warning, "ContourPlotSetValues: Data values out of range of levels set by EXPLICITLEVELS mode".</i>
<p>


This warning is telling you that the explicit contour levels you chose
are not in the same range of your data. You need to look at the levels
you are choosing (via the <a href="../Document/Graphics/Resources/cn.html#cnLevels"><em>cnLevels</em></a> resources)
and compare them with the minimum / maximum of the data you are trying to plot,
to make sure the range of the levels and your data intersect at some point.
<p>

Use the <a href="../Document/Functions/Contributed/printMinMax.html"><strong>printMinMax</strong></a> procedure to
check the min/max of your data.

<p><p>

<a name="err_msgs_018"></a>
<li><i>I'm getting an "ARSCAM/ARPRAM ALGORITHM FAILURE" error message.</i>
<p>


This bug was fixed in <a href="../prev_releases.html#5.2.1">version
5.2.1</a> for a large percentage of NCL scripts, but we occasionally
see this bug creep up in newer versions of NCL in special cases. If
you do run into it with a newer version of NCL, please keep reading
for suggestions.  <p>

This bug is usually caused by a precision error in our low-level
contouring algorithm. It seems to occur when you have very "twisty"
contours in a small area, like in a panel plot. It is also more likely
happen when you are drawing filled contours using the default "area
fill" mode.
<p>

One thing you can try as a work-around is to fill the contours using
"raster fill" mode instead:

<pre>
   res@<a href="../Document/Graphics/Resources/cn.html#cnFillMode"><em>cnFillMode</em></a> = "RasterFill"
</pre>

In addition, you can smooth the raster contours, making them 
closer in appearance to area-filled contours: <p>

<pre>
  res@<a href="../Document/Graphics/Resources/cn.html#cnRasterSmoothingOn"><em>cnRasterSmoothingOn</em></a> = True
</pre>
<p>

Unfortunately, if you need "area fill", there's no instant fix for
this. We found that if you tweak certain things, like the rotation of
your plot (<a href="../Document/Graphics/Resources/mp.html#mpCenterLonF"><em>mpCenterLonF</em></a>), the size of
the plot (<a href="../Document/Graphics/Resources/vp.html#vpWidthF"><em>vpWidthF</em></a>/<a href="../Document/Graphics/Resources/vp.html#vpHeightF"><em>vpHeightF</em></a>), or the contour levels themselves,
you might be able to get rid of this error message.  <p>

There's a more <a href="../Document/Language/error_messages.html#ARSCAMError">detailed and low-level description</a>.
<p>

We are interested in hearing from folks who run into this problem and
for whom the above suggestions don't help.  You can help us debug the
problem by sending email to the ncl-talk@ucar.edu list (you must <a
href="http://mailman.ucar.edu/mailman/listinfo/ncl-talk">subscribe
first</a>) and providing us with the smallest script possible that shows
the problem and the data.

<p><p>

<a name="err_msgs_019"></a>
<li><i>I'm getting the error message "PLCHHQ - CHARACTER NUMBER 10 (w) IS NOT A LEGAL FUNCTION CODE".</i>
<p>


This is happening because you are using a character in a plot text
string that is a reserved <a href="../Document/Graphics/function_code.html">function code</a>
character. The default function code is a colon (':').
<p>

You've probably forgotten to download this "<a href="../Document/Graphics/hlures.html">.hluresfile</a>" file and
put it in your home directory. It will set the function code to the
tilde ('~') character.

<p><p>

<a name="err_msgs_020"></a>
<li><i>I'm getting the error "fatal:NhlCvtStringToEnum: Unable to convert string".</i>
<p>


This fatal message occurs when you are setting a resource that expects
a certain set of string values, and you give it something invalid.
<p>

For example, the <a href="../Document/Graphics/Resources/mp.html#mpProjection"><em>mpProjection</em></a>
resource only recognizes a fixed set of values, like
"LambertConformal", "Stereographic", or "Mercator", to name a few. If
you try to set it to "IAmTheBest", you will get this error.  <p>


<p><p>

<a name="err_msgs_021"></a>
<li><i>I'm getting an error from the "shea_util.ncl" script about "copy_VarCoords" being an undefined procedure.</i>
<p>


If you are seeing this error:
<p>

<pre>
  fatal:syntax error: line 3200 in file $NCARG_ROOT/lib/ncarg/  
  nclscripts/csm/shea_util.ncl before or near \n
     copy_VarCoords(x, advect)
  ---------------------------^
  fatal:syntax error: possibly an undefined procedure
  fatal:Syntax Error in block, block not executed
</pre>

then you probably simply need to swap the order that "contributed.ncl"
and "shea_util.ncl" are loaded. Make sure "contributed.ncl" is loaded
first:
<p>

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/contributed.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/shea_util.ncl"
</pre>

<p><p>

<a name="err_msgs_022"></a>
<li><i>When running a script with overlaid plots, I'm getting an error "cannot draw Plot Member".</i>
<p>


If your error message looks something like this:
<p>

<pre>
   warning:NhlDraw: cannot draw Plot Member, ID 11, independently
</pre>

Then you are probably trying to draw a plot that has been overlaid
on another plot. For example, the following code would cause
this error:
<p>

<pre>
  . . .
  wks = gsn_open_wks("x11","test")

  res         = True
  res@gsnDraw = False
  res@gsnFrame = False

  contour_line = gsn_csm_contour(wks,z1,res)

  res@cnFillOn = True
  contour_fill = gsn_csm_contour(wks,z2,res)

  overlay(contour_fill,contour_line)

  draw(contour_line)    ; contour_line is now an "overlay" plot, and
                        ; can't be drawn individually.
  frame(wks)
</pre>

The above <a href="../Document/Functions/Built-in/draw.html"><strong>draw</strong></a> command needs to be:
<p>

<pre>
  draw(contour_fill)
</pre>

If you need to draw "contour_line" by itself, then you will
need to do this before the <a href="../Document/Functions/Built-in/overlay.html"><strong>overlay</strong></a> call:
<p>

<pre>
  . . .
  res         = True
  res@gsnDraw = False
  res@gsnFrame = False

  contour_line = gsn_csm_contour(wks,z1,res)

  res@cnFillOn = True
  contour_fill = gsn_csm_contour(wks,z2,res)

  draw(contour_line)
  frame(wks)

  overlay(contour_fill,contour_line)

  draw(contour_fill)
  frame(wks)
</pre>

<p><p>

<a name="err_msgs_023"></a>
<li><i>When I use NCL's systemfunc on a X/Cygwin system, I get the error "cannot create child process".</i>
<p>


This problem was originally reported in ncl-talk:<p>

<a href="../Support/talk_archives/2008/1642.html">http://www.ncl.ucar.edu/Support/talk_archives/2008/1642.html</a>  
<p>

Vladyslav Lyubartsev was kind enough to post a solution to this problem:
<p>

The solution has been found here:
<p>

<a href="http://www.mylifestartingup.com/2009/04/fatal-error-unable-to-remap-to-same.html">http://www.mylifestartingup.com/2009/04/fatal-error-unable-to-remap-to-same.html</a> 
<p>

<ol>

<li>Close out of Cygwin (and all Cygwin processes).

<li>Open a Windows command prompt (start -> run - > type 'cmd' or on
vista : start -> type 'cmd' in the start search window)

<li>Go to your cygwin bin directory. For me it is c:\cygwin\bin.

<li>Type 'ash'

<li>Type '/usr/bin/rebaseall'

<li>Resolve any errors (I had a warning that went unresolved and it
still worked fine)

<li>Reboot...and you should be good.

</ol>


<p><p>

<a name="err_msgs_024"></a>
<li><i>When I compile an NCAR Graphics program, I get errors about undefined symbols like "_png_set_rows", "_png_destroy_write_struct", "_png_malloc", etc.</i>
<p>


If you are building against a pre-compiled set of NCAR Graphics libraries,
then these libraries were likely built with PNG support built in. This
gives you the ability to have direct PNG output.
<p>

However, it also means that you must include the PNG library ("-lpng")
and "-lz" at the end of your application's compile line.
<p>

You can either build NCAR Graphics from source code yourself, without
"png" support, or you can build and install the PNG library yourself.
The latter is much easier.
<p>

See the next question for more information about building the PNG
library.  Once you have the library, add "-lpng -lz" to the end
of the compile line that contains all the NCAR Graphics libraries.

<p><p>

<a name="err_msgs_025"></a>
<li><i>When I use "ncargex" or "ncargf77", I get an error "cannot find -lpng".</i>
<p>


NCAR Graphics has an internal PNG driver, and hence NCAR Graphics
programs require the PNG library to be linked in.
<p>


You might already have the PNG library on your system.
Look for files called something like "libpng.a", "libpng.so",
or "libpng.dylib" (for Macs).
<p>

If you don't have this library, then it is fairly simple to build and
install if you have a C compiler, or you can download an already
compiled library for your system.
<p>

<ul>
<li>Go to <a
href="http://www.libpng.org/pub/png/libpng.html">http://www.libpng.org/pub/png/libpng.html</a>
and either download a precompiled binary, or the source code (the
".tar.gz" file under "with config script").
<p>

<li>For instructions on building from source code, go to:
<blockquote>
<a href="../Download/build_from_src.html#PNG">http://www.ncl.ucar.edu/Download/build_from_src.shtml#PNG</a>
</blockquote>
<p>

Note that "/usr/local" is just an example here, use whatever
installation path you want.  <p>

<li>If you are using "ncargcc" or "ncargf77" to compile your program,
then edit each of the files "ncargcc", "ncargf77", and "ncargf90" in
$NCARG_ROOT/bin and add "-L<i>/path/to/libpng</i> " to the front of
"-lpng", where <i>/path/to/libpng</i> is the location of this library
on your system. For example, if it's in "/usr/local/lib", then change
the line:
<p>

<pre>
    set pnglib   = "-lpng -lz"
</pre>

to
<p>
 
<pre>
    set pnglib   = "-L/usr/local/lib -lpng -lz"
</pre>
<p>

</ul>

<p><p>

<a name="err_msgs_026"></a>
<li><i>I'm trying to assign a value to an NCL variable, but getting a "right hand side can't be coerced to type of left hand side" error message.</i>
<p>


If you see this when you run your NCL script:
<p>

<pre>
fatal:Assignment type mismatch, right hand side can't be coerced to type
      of left hand side
</pre>

this means that you are trying to assign the wrong type of value to an
NCL variable that already exists. For example, you will see this error
message if you do this:
<p>

<pre>
  x = 1
  x = 5.
</pre>

because a floating point value can't be assigned to an integer
variable.  This is to protect the user against possible data loss.  To
do the above, use <a href="../Document/Functions/Built-in/floattointeger.html"><strong>floattointeger</strong></a>:
<p>

<pre>
  x = 1
  x = floattointeger(5.)
</pre>

There are many other <a
href="../Document/Functions/type_convert.html">conversion routines</a>.

<p><p>

<a name="err_msgs_027"></a>
<li><i>I'm calling NCL from a shell script and getting a fatal error on line -1.</i>
<p>


If you are calling NCL from a C-shell, bash shell, or some other shell script,
and it's exiting with the error:

<pre>
fatal:syntax error: line -1 before or near .
</pre>
<p>

then you may need to include an "exit" statement right at the very end
of your NCL script to make sure it terminates properly. We are
considering this a bug and hope to fix it sometime.

<p><p>

<a name="err_msgs_028"></a>
<li><i>I'm getting an "MDRGSF/MDRGOF - ERROR OPENING RANGS/GSHHS CAT FILE" error message.</i>
<p>


If you are trying to draw maps with NCL and getting the following
error message:
<p>

<pre>
  fatal:MapRGDHDrawMapList: MDRGSF/MDRGOF - ERROR OPENING RANGS/GSHHS CAT FILE
  fatal:PlotManagerDraw: error in plot draw
  fatal:_NhlPlotManagerDraw: Draw error
</pre>

then this means you are trying to use the high-resolution map database
(res@<a href="../Document/Graphics/Resources/mp.html#mpDataBaseVersion"><em>mpDataBaseVersion</em></a> = "HighRes"),
but you haven't downloaded the necessary map database files.
<p>

For information on how to get the database, go to the page on <a
href="../Document/Graphics/rangs.html">high-resolution coastlines</a>.

<p><p>

<a name="err_msgs_029"></a>
<li><i>I'm trying to draw primitives (markers, lines, polygons) on my plot, and getting an error essage "tfPolyDrawList element 0 is invalid".</i>
<p>


If you are using one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_add_poly<i>xxx</i></a> functions
to add primitives to your plot, and seeing one or more error messages:
<p>

<pre>
warning:TransformPostDraw: tfPolyDrawList element 1 is invalid 
warning:TransformPostDraw: tfPolyDrawList element 2 is invalid 
</pre>

then this most likely means that the variable being used to hold
the return value from this function is not unique. For example,
the following code will produce this error message, because the
second usage of "dum" will cause the first usage of "dum" to be
clobbered:
<p>

<pre>
  dum = <a href="../Document/Graphics/Interfaces/gsn_add_polyline.html"><strong>gsn_add_polyline</strong></a>(wks,plot,x,y,lnres)
  dum = <a href="../Document/Graphics/Interfaces/gsn_add_polymarker.html"><strong>gsn_add_polymarker</strong></a>(wks,plot,x2,y2,mkres)
</pre>

To fix the above code, you need to use unique variables for both calls:
<p>

<pre>
  dum1 = <a href="../Document/Graphics/Interfaces/gsn_add_polyline.html"><strong>gsn_add_polyline</strong></a>(wks,plot,x,y,lnres)
  dum2 = <a href="../Document/Graphics/Interfaces/gsn_add_polymarker.html"><strong>gsn_add_polymarker</strong></a>(wks,plot,x2,y2,mkres)
</pre>

It is also important to note that variables holding return values from
one of the gsn_add_poly<i>xxx</i> functions must live for the duration
of the script. So, if the primitive function calls are inside a
function, you need to make sure their return values "live" outside the
function.  You can do this by returning the variable as an attribute
of the return variable: <p>

<pre>
function add_primitives_to_plot(wks,plot)
local i, nlines, x1, y2, lnres
begin
;---Assume we want to add four lines to the plot
  nlines = 4
  dum = <a href="../Document/Functions/Built-in/new.html"><strong>new</strong></a>(nlines,graphic) 
  lnres = True
  <i>...</i>
  do i = 0,nlines-1
    x1 = <i>...</i>
    y1 = <i>...</i>
    dum(i) = <a href="../Document/Graphics/Interfaces/gsn_add_polyline.html"><strong>gsn_add_polyline</strong></a>(wks,plot,x1,y1,lnres)
  end do 
  ...
  plot@dum = dum
  return(plot)
end
</pre>
<p>

Another way to do this that doesn't require preallocating a "dum"
graphic array is to use the <a href="../Document/Functions/Built-in/unique_string.html"><strong>unique_string</strong></a> function
to return a unique name. You can then use this as a unique variable
name, and attach it directly to "plot" using the special <b>$</b>...<b>$</b> syntax:
<p>

<pre>
  do i = 0,nlines-1
    x1 = <i>...</i>
    y1 = <i>...</i>
    tmpstr = <a href="../Document/Functions/Built-in/unique_string.html"><strong>unique_string</strong></a>("dum")   ; "dum1", "dum2", ...
    plot@<b>$</b>tmpstr<b>$</b> = <a href="../Document/Graphics/Interfaces/gsn_add_polyline.html"><strong>gsn_add_polyline</strong></a>(wks,plot,x1,y1,lnres)
  end do 
</pre>
<p>
or

<pre>
  do i = 0,nlines-1
    x1 = <i>...</i>
    y1 = <i>...</i>
    plot@<b>$</b><a href="../Document/Functions/Built-in/unique_string.html"><strong>unique_string</strong></a>("dum")<b>$</b> = <a href="../Document/Graphics/Interfaces/gsn_add_polyline.html"><strong>gsn_add_polyline</strong></a>(wks,plot,x1,y1,lnres)
  end do 
</pre>

<p><p>

<a name="err_msgs_030"></a>
<li><i>When I call one of the gsn_csm_xxxx_map plotting scripts, I get an error message about a units attribute not being correct.</i>
<p>


If you are using one of the <a
href="../Document/Graphics/Interfaces/index.html">gsn_csm_<i>xxx</i>_map</a>
functions to overlay data on a map, and seeing one or both of the
following error messages:
<p>
 
<pre>
    (0)   is_valid_lat_ycoord: Warning: The units attribute of 
    the Y coordinate array is not set to one of the allowable 
    units values (i.e. 'degrees_north'). Your latitude labels 
    may not be correct.

    (0)   is_valid_lat_xcoord: Warning: The units attribute of 
    the X coordinate array is not set to one of the allowable 
    units values (i.e. 'degrees_east'). Your longitude labels 
    may not be correct.
</pre>

then this means that your data contains
<a href="../Document/glossary.html#CoordinateArray">coordinate arrays</a>,
but the coordinate arrays either don't have the necessary "units"
attribute, or it's not set to one of the allowable values
("degrees_east" for longitude values and "degrees_north" for latitude
values).  <p>

If your coordinate arrays are indeed degrees east and degrees north,
then you can set the units attribute as follows (this code snippet
assumes your data array is called "data" and that the coordinate
arrays are called "lat" and "lon"):
<p>

<pre>
  data&lat@units = "degrees_north"
  data&lon@units = "degrees_east"
</pre>
    
<p><p>

<a name="err_msgs_031"></a>
<li><i>I'm trying to create a contour, vector, or contour plot, and getting a weird error about spline approximation.</i>
<p>


If you see this error:
<p>

<pre>
     warning:_NhlCreateSplineCoordApprox: Attempt to create spline
     approximation for Y axis failed: consider adjusting trYTensionF value
     warning:IrTransInitialize: error creating spline approximation for
     trYCoordPoints; defaulting to linear
</pre>
     
then this usually means that your X or Y
<glossary term="CoordinateArray">coordinate array</inforef>
values are spaced irregularly enough such that NCL can't
figure out how to "interpolate" them to a linear axis.  <p>

This error is most commonly seen when there are gaps in the coordinate
variable; for example, if you have data only over the poles, and not
in the tropical region.
<p>

One possible solution is to zoom in on your data such that the
coordinate arrays of the zoomed in portion are more "regular".  You
can use <a href="../Document/Language/subscript_coord.html">coordinate
subscripting</a> to accomplish this.  <p>

Another possibility is that your longitude coordinate array is not
cyclic, but you are trying to plot a global map. In this case, you may
need to set <a href="../Document/Graphics/Resources/gsn.html#gsnAddCyclic"><em>gsnAddCyclic</em></a> to False.

<p><p>

<a name="err_msgs_032"></a>
<li><i>When I print something in NCL, I get an error about my PAGER environment variable.</i>
<p>


If you see an error like this:
<p>

<pre>
  warning:Error Forking pager check PAGER environment variable and restart, continuing using "more"
</pre>

This is probably due to your PAGER environment variable being set to
something NCL doesn't recognize. A work-around is to set the <a
href="../Document/Language/env.html#NCL_NO_SYSTEM_PAGER">NCL_NO_SYSTEM_PAGER</a>
environment variable.
<p>

From csh/tcsh:
<p>

<pre>
  setenv NCL_NO_SYSTEM_PAGER
</pre>
<p>

From bash/ksh/sh:
<p>

<pre>
  export NCL_NO_SYSTEM_PAGER=
</pre>
<p>


<p><p>

</ol><p>


<h3>Memory issues</h3>
<p>

<ol>
<a name="mem_issues_001"></a>
<li><i>What's the biggest array that NCL can allocate?</i>
<p>


As of version 6.0.0 of NCL, you can create variables larger than 2 GB
on a 64-bit system. Of course, you may be limited by the memory on
your machine.
<p>

On a 32-bit system, NCL is limited to creating arrays whose dimension
sizes can be represented by a C signed integer (32-bit integer). This
means that you can only allocate up to 2 GB [(2^31)-1] bytes of total
memory, regardless of how much memory you have on your machine.  <p>

The type of the NCL variable that you are creating also figures into
the size. For example, each integer or float value takes up 4 bytes,
so if you want to create a float or integer array <b>on a 32-bit
system</b>, the largest one you can create is ((2^31)-1)/4.  <p>

For a double array, this is further reduced to a size of ((2^31)-1)/8.
<p>

<p><p>

<a name="mem_issues_002"></a>
<li><i>I'm running into a memory issue when I create lots of strings.</i>
<p>


If you create strings in NCL, the memory for them never gets freed
internally, even if you delete them. If you create lots of strings
(and we do mean a lot), then, you may run into memory problems or
notice an increased slow down as the script progresses.
<p>

NCL permanently (by design) stores every unique string it encounters
in a hash table and assigns it a unique integer id, which is passed
around instead of a pointer reference to the string itself. This
simplifies programming for tasks such as string comparison. In the
usual case for NCL, this has worked pretty well.
<p>

Unfortunately, there is a drawback to this approach.  Let's say you
have a do loop that is executed many times (like 2 million).  Further
assume that inside this loop, you build up strings from small
components and that each of these strings is unique.
<p>

As you go through this big loop, we have found that the virtual memory
required to hold these unique strings tends to grow, and as the hash
table gets larger, it takes more and more processing time to
distinguish each string as unique or not. Using performance monitoring
tools we found that in one case, when a string-intensive program
first started, it was spending about 25% of its time locating strings
in the hash table. That had grown to 85% of the time towards
the end of the loop.
<p>

We have been doing some research into fixing this quirk, but
meanwhile, the best we can do is to suggest trying to find ways around
having to create a lot of unique strings. Email <a
href="mailto:ncl-talk@ucar.edu">ncl-talk@ucar.edu</a> if you have any
concerns or questions about this.

<p><p>

</ol><p>


<h3>Documentation</h3>
<p>

<ol>
<a name="doc_001"></a>
<li><i>Is there a way I can download the NCL website documentation so I can access it locally on my machine?</i>
<p>


TJ Onley pointed out this nice solution. For example, if you just
want to download the files under http://www.ncl.ucar.edu/Document,
use:
<p>

<pre>
wget -r -l0  -p -np -nH -k http://www.ncl.ucar.edu/Document/
</pre>
<p>

This will create a directory called "Document", and in that directory,
you can open the "index.shtml" file with your web browser and have access to
all the files locally.

<p><p>

<a name="doc_002"></a>
<li><i>Where can I see a list of all the NCL resources?</i>
<p>


Here's a <a href="../Document/Graphics/Resources/index.html">list of
resources</a> by category. There is also an <a href="../Document/Graphics/Resources/list_alpha_res.html">alphabetical
list</a>, but this can be hard to browse.

<p><p>

<a name="doc_003"></a>
<li><i>Where can I see a list of all the NCL functions and procedures?</i>
<p>


See the <a href="../Document/Functions/list_alpha.html">alphabetical list of NCL
functions and procedures</a>.
<p> 

The functions and procedures can also be viewed by <a
href="../Document/Functions/index.html">category</a> (i.e. "graphics routines",
"interpolation"), and by <a
href="../Document/Functions/list_type.html">type</a> (that is, whether
it's a built-in function, a "contributed.ncl" function, etc).

<p><p>

<a name="doc_004"></a>
<li><i>Where can I see a list of links to dash patterns, marker styles, color tables, etc?</i>
<p>


Follow the <a href="../links.html">popular links</a> on the left side of
any NCL page.


<p><p>

</ol><p>


<h3>Miscellaneous</h3>
<p>

<ol>
<a name="misc_001"></a>
<li><i>How should I cite NCL?</i>
<p>


To cite NCL in a publication, please include
the <a href="http://www.doi.org/">DOI</a> and a link to it, if
possible:
<p>

<pre>
   The NCAR Command Language (Version 6.0.0) [Software]. (2012). 
   Boulder, Colorado: NCAR/CISL/VETS. <a href="http://dx.doi.org/10.5065/D6WD3XH5">doi:10.5065/D6WD3XH5</a>
</pre>
<p>

You will need to update the version and year as appropriate.

<p><p>

<a name="misc_002"></a>
<li><i>How can I add a logo to an NCL plot?</i>
<p>


If the logo you want to add is in an image file, like "xxx.jpg" or
"xxx.png", then you can attach it to an NCL PS, PDF, or PNG image
using ImageMagick's "<a
href="http://www.imagemagick.org/script/composite.php">composite</a>
tool.
<p>

The "composite" command can be called from inside an NCL script using
NCL's <a href="../Document/Functions/Built-in/system.html"><strong>system</strong></a> call.  See example "logo_4.ncl" on the
"<a href="../Applications/logo.html">Logos</a>" example page.


<p><p>

<a name="misc_003"></a>
<li><i>How do I call a C or Fortran function or procedure from NCL?</i>
<p>


For Fortran functions, there's a useful script called <B>WRAPIT</B>
which uses <B>wrapit77</B> to generate the wrapper function, and it
also figures out what kind of system you're on and generates the
shared object for you. For more information, see the <a href="../Document/Tools/WRAPIT.html">WRAPIT</a> documentation.
<p>

For C routines, you can use an application called <B>wrapit77</B>
which generates a C wrapper that you then compile and link with the
"ld" command to create a shared object.  For more information about
<B>wrapit77</B> and some examples on how to use it, go to the "<a href="../Document/Manuals/Getting_Started/beyondbasics.html#IncorporateYourOwn">Incorporating your own Fortran or C
code</a>" section in the <i>Getting Started Using NCL</i>
manual.

<p><p>

<a name="misc_004"></a>
<li><i>How do I make sure that a C/Fortran routine I want to wrap doesn't conflict with a routine that might already be part of NCL?</i>
<p>


If you're using WRAPIT to wrap a subroutine, you need to make sure
that the name of your subroutine doesn't have the same name as a
routine name used by the "ncl" executable.
<p>

It's a good idea, then, to stay away from common names like "average"
or "gamma". If your routine has the same name as an NCL routine, then
your wrapped subroutine may not work properly.  <p>

To check that your subroutine name is not already part of the ncl
executable, you can use the "nm" command. For example, say you want to
use "gamma" as your function name. To check if "gamma" is already
used by NCL:<p>

<pre>
  nm $NCARG_ROOT/bin/ncl | grep -i gamma
</pre>
<p>

You will see some output like:

<pre>
    0000000100283a28 T _dgammaslatec_
    00000001002b30df T _dsgamma_
    0000000100272ed2 T _gamma_
    0000000100dd1db3 t _gammafn
    000000010014f5e1 T _gammainc_W
    00000001001a3ed3 T _random_gamma_W
                     U _tgamma
</pre>
<p>

The "T" before the name means there's a routine with that name in the
ncl executable. The underscores should be ignored, as they are added
internally by the compilers. From this list you can see there's a
routine called "_gamma_". Hence "gamma" is already a used name.
<p>

If you rename yours to something like "mygamma", or "gamma2", you will
be fine.

<p><p>

<a name="misc_005"></a>
<li><i>How do I fix buffering issues with NCL?</i>
<p>


If you are running an NCL script that echoes output to your screen, but are seeing
issues with the output not showing up until the script is finished, then you can try
a couple of things:
<p>
Use the "tee" command:
<p>
<pre>
  ncl program.ncl | tee program.out
</pre>

If on a Linux machine, try the Linux program "unbuffer":
<p>
<pre>
  unbuffer ncl program.ncl >> output.txt 2>&1 &
</pre>

<p><p>

<a name="misc_006"></a>
<li><i>If I obscure an NCL X11 window with another application, the X11 window doesn't refresh when I bring it back to the foreground.</i>
<p>


This is possibly due to an X11 backing store problem.  If you run the
command:

<pre>
  xdpyinfo | grep backing
</pre>

and the output is similar to:

<pre>
  options:    backing-store NO, save-unders NO
</pre>

then you will need to enable backing store in your X server
configuration.
<p>

There are different ways to do this, depending on what kind of system
you're on. On a Linux system, try inserting the line:
 
<pre>
  Option      "backingstore"
</pre>
 
in the Device section of your X server configuration file (normally
/etc/X11/XF86Config or /etc/X11/XF86Config-4).  Alternatively, you
can run your X server with the option "+bs" to obtain the same result
without editing your configuration file. Restart your X server, then
run the dpyinfo command again to verify that backing store is
now enabled.
<p>

On a PC running Hummingbird, run Exceed's "xconfig" program. In
the xconfig menu, double-click on "Performance". Make sure "Save
Unders" is checked, set "Maximum Backing Store" to "Always", set
"Default Backing Store" to "When Mapped", and set "Minimum Backing
Store" to "When Mapped".

<p><p>

</ol><p>

					</div>

					<p>&nbsp;</p>

		<!-- begin footer -->
		<div id="footer">

		<a href="mailto:ncladmin@ucar.edu">Contact the Webmaster</a>



		<!-- end footer -->
		</div>

           <br class="clearboth"/>

	   <!-- end content -->

	</div>
<!-- end wrap -->
</div>
</body>

<!-- Mirrored from www.ncl.ucar.edu/FAQ/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 14:34:31 GMT -->
</html>

