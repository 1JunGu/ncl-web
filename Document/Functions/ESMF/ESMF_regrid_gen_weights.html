<html>

<!-- Mirrored from www.ncl.ucar.edu/Document/Functions/ESMF/ESMF_regrid_gen_weights.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 15:18:28 GMT -->
<head>
<meta name="description" content="ESMF regridding functions (interpolation)">
<meta name="keywords" content="ESMF_regrid_gen_weights">
<title>ESMF_regrid_gen_weights</title>
</head>

<body>
	
	<!-- main navigation include -->
		<!-- NCL CSS -->
	<link rel="stylesheet" href="../../../styles/ncl.css" type="text/css" media="all">
	
	
		<!-- Equal Height Columns -->
		<script type="text/javascript" src="../../../scripts/column_height_equal.js"></script>
		
		<!-- DOJO Expandable Tree Nav -->

		<script type="text/javascript" src="../../../scripts/dojo/dojo.js"></script>
		<script type="text/javascript">
		
		dojo.require("dojo.widget.TreeV3");
		dojo.require("dojo.widget.TreeNodeV3");
		dojo.require("dojo.widget.TreeLinkExtension");
		dojo.require("dojo.widget.TreeBasicControllerV3");
		dojo.hostenv.writeIncludes();

		</script>
		

		<div id="top_colorbar"><!-- begin top_colorbar -->
		</div><!-- end top_colorbar -->


	<div id="nav_org_wrap"><!-- begin nav_org_wrap -->
	<div id="nav_org"><!-- begin nav_org -->

		<ul class="menubar">


			<li><a class="trigger" href="../../../internal/index.html">&nbsp;</a>
			</li>

			<li><a class="trigger" href="http://www.ucar.edu/">UCAR</a>
			</li>

			<li><a class="trigger" href="http://www.ncar.ucar.edu/">NCAR</a>
			</li>

			<li><a class="trigger" href="http://www.cisl.ucar.edu/">CISL</a>
			</li>
		</ul>

	</div><!-- end nav_org -->

	<div id="search"><!-- begin search -->

		<ul class="menubar">

			<li><a class="trigger" href="../../../Download/index.html">Download</a>
			</li>

			<li><a class="trigger" href="../../../citation.html">Citing NCL</a>
			</li>

			<li><a class="trigger" href="../../../contributors.html">Contributors</a>
			</li>

		</ul>

	</div><!-- end search -->

	</div><!-- end nav_org_wrap -->
	
	
	

		<div id="nav_main_wrap"><!-- begin nav_main_wrap -->

		<div id="nav_main"><!-- begin nav_main -->
			<ul id="menubar_main">

				<li>
				<a href="../../Pivot_to_Python/september_2019_update.html" class="triggeryw">&#9733; UPDATED LETTER TO NCL USERS</a>
				<li>
				<a href="../../../index.html" class="triggeron">NCL</a>
					<ul>
                                          <li><a href="../../Pivot_to_Python/index.html">Pivot to Python</a>
					  <li><a href="../../../overview.html" class="subitem">Overview</a></li>
						<li><a href="../../../get_started.html" class="subitem">Getting Started</a> </li>
						<li><a href="../../../gallery.html" class="subitem">Gallery</a></li>
						<li><a href="../../../Download/index.html" class="subitem">Download</a></li>
						<li><a href="../../../current_release.html" class="subitem">What's New</a></li>
						<li><a href="../../index.html" class="subitem">Documentation</a></li>						
						<li><a href="../../../citation.html" class="subitem">Citing NCL</a></li>
					</ul>

				</li>

				<li>
				<a href="../../../Applications/index.html" class="trigger">Examples</a>
					<ul>
						<li><a href="../../../Applications/index.html" class="subitem" title="Examples">All Examples</a></li>
						<li><a href="../../../Applications/Templates/index.html" class="subitem">Templates</a></li>
						<li><a href="../../../Applications/list_io.html" class="subitem">File I/O</a></li>
						<li><a href="../../../Applications/list_data.html" class="subitem">Datasets</a></li>
						<li><a href="../../../Applications/list_maps.html" class="subitem">Maps</a></li>
						<li><a href="../../../Applications/list_models.html" class="subitem">Models</a></li>
						<li><a href="../../../Applications/list_dataP.html" class="subitem">Data Analysis</a></li>
						<li><a href="../../../Applications/list_ptypes.html" class="subitem">Plot Types</a></li>
						<li><a href="../../../Applications/list_tech.html" class="subitem">Plot Techniques</a></li>
						<li><a href="../../../Applications/list_special.html" class="subitem">Special Plots</a></li>
						<li><a href="../../../Applications/list_grids.html" class="subitem">Non-uniform Grids</a></li>
						<li><a href="../../../Applications/list_misc.html" class="subitem">Miscellaneous</a></li>
					</ul>
				</li>

				<li>
				<a href="../list_alpha.html" class="trigger">Functions</a>
					<ul>
						<li><a href="../list_alpha.html" class="subitem">Alphabetical Listing</a></li>
						<li><a href="../index.html" class="subitem">Category Listing</a></li>
						<li><a href="../list_type.html" class="subitem">Function-Type Listing</a></li>						
					</ul>
				</li>
				
				<li>
				<a href="../../Graphics/Resources/index.html" class="trigger">Resources</a>
					<ul>
					  <li><a href="../../Graphics/Resources/list_alpha_res.html" class="subitem">Complete Listing</a></li>
					
						<li><a href="../../Graphics/Resources/am.html" class="subitem">am (annotation manager)</a></li>
						<li><a href="../../Graphics/Resources/app.html" class="subitem">app (app)</a></li>
						<li><a href="../../Graphics/Resources/ca.html" class="subitem">ca (coordinate array)</a></li>
						<li><a href="../../Graphics/Resources/cn.html" class="subitem">cn (contour)</a></li>
						<li><a href="../../Graphics/Resources/ct.html" class="subitem">ct (coordinate array table)</a></li>
						<li><a href="../../Graphics/Resources/dc.html" class="subitem">dc (data comm)</a></li>
						
						<li><a href="../../Graphics/Resources/err.html" class="subitem">err (error)</a></li>
						<li><a href="../../Graphics/Resources/gs.html" class="subitem">gs (graphics styles)</a></li>
						<li><a href="../../Graphics/Resources/gsn.html" class="subitem">gsn (gsn high-level interfaces)</a></li>
						<li><a href="../../Graphics/Resources/lb.html" class="subitem">lb (label bar)</a></li>
						<li><a href="../../Graphics/Resources/lg.html" class="subitem">lg (legends)</a></li>
						<li><a href="../../Graphics/Resources/mp.html" class="subitem">mp (maps)</a></li>
						
						<li><a href="../../Graphics/Resources/pm.html" class="subitem">pm (plot manager)</a></li>
						<li><a href="../../Graphics/Resources/pr.html" class="subitem">pr (primitives)</a></li>
						<li><a href="../../Graphics/Resources/sf.html" class="subitem">sf (scalar field)</a></li>
						<li><a href="../../Graphics/Resources/st.html" class="subitem">st (streamline)</a></li>
						<li><a href="../../Graphics/Resources/tf.html" class="subitem">tf (transform)</a></li>
						<li><a href="../../Graphics/Resources/ti.html" class="subitem">ti (title)</a></li>
						
						<li><a href="../../Graphics/Resources/tm.html" class="subitem">tm (tickmark)</a></li>
						<li><a href="../../Graphics/Resources/tr.html" class="subitem">tr (transformation)</a></li>
						<li><a href="../../Graphics/Resources/tx.html" class="subitem">tx (text)</a></li>
						<li><a href="../../Graphics/Resources/vc.html" class="subitem">vc (vectors)</a></li>
						<li><a href="../../Graphics/Resources/vf.html" class="subitem">vf (vector field)</a></li>
						<li><a href="../../Graphics/Resources/vp.html" class="subitem">vp (view port)</a></li>
						
						<li><a href="../../Graphics/Resources/wk.html" class="subitem">wk (workstation)</a></li>
						<li><a href="../../Graphics/Resources/ws.html" class="subitem">ws (workspace)</a></li>
						<li><a href="../../Graphics/Resources/xy.html" class="subitem">xy (xy plots)</a></li>						
					</ul>
        </li>

				<li>
				<a href="../../../links.html" class="trigger">Popular Links</a>
					<ul>
					<li><a href="../../Graphics/hlures.html" class="subitem">.hluresfile</a></li>
					<li><a href="../../Graphics/color_table_gallery.html" class="subitem">Color Tables</a></li>
					<li><a href="../../Graphics/font_tables.html" class="subitem">Font Tables</a></li>	
					<li><a href="../../Language/error_messages.html" class="subitem">Error Messages</a></li>	
					<li><a href="../../Graphics/Images/dashpatterns.png" class="subitem">Dash Pattern Table</a></li>	
					<li><a href="../../Graphics/Images/fillpatterns.png" class="subitem">Fill Pattern Table</a></li>	
					<li><a href="../../Graphics/Images/markers.png" class="subitem">Marker Table</a></li>
					<li><a href="../../Graphics/map_projections.html" class="subitem">Map Projections</a></li>
					<li><a href="../../Graphics/rangs.html" class="subitem">High Resolution Map Database</a></li>
					<li><a href="../../../Applications/editor.html" class="subitem">Editor Enhancements</a></li>
					<li><a href="../../Tools/ncl_convert2nc.html">ncl_convert2nc</a></li>
					<li><a href="../../Tools/ncl_filedump.html">ncl_filedump</a></li>
					<li><a href="../../Tools/index.html" class="subitem">Tools</a></li>
					<li><a href="../../Tools/WRAPIT.html" class="subitem">WRAPIT</a></li>
					</ul>
				</li>

				<li>
				<a href="../../../announcements.html" class="trigger">What's New</a>
					<ul>
					        <li><a href="../../../announcements.html" class="subitem">Announcements</a></li>
						<li><a href="../../../current_release.html" class="subitem">In Latest Release</a></li>
						<li><a href="../../../new_applications.html" class="subitem">In Application Examples</a></li>
						<li><a href="../../../future_release.html" class="subitem">In Next Release</a></li>	
						<li><a href="../../../prev_releases.html" class="subitem">In Previous Releases</a></li>
					</ul>
				</li>
	

				<li>
				<a href="../../../Support/index.html" class='trigger'>Support</a>
					<ul>
						<li><a href="../../../Support/email_lists.html" class="subitem">Email Lists</a></li>
						<li><a href="../../../Applications/editor.html" class="subitem">Editor enhancements</a></li>
						<li><a href="../../Language/error_messages.html" class="subitem">Error messages</a></li>
						<li><a href="../../Manuals/index.html" class="subitem">Manuals</a></li>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="../../../Training/index.html" class="subitem">Training</a></li>
						<li><a href="../../../Training/Webinars/index.html" class="subitem">Webinars</a></li>
						<li><a href="../../../Training/Workshops/index.html" class="subitem">Workshops</a></li>
						<li><a href="../../index.html" class="subitem">Documentation</a></li>
						<li><a href="../../../FAQ/index.html" class="subitem">FAQ</a></li>
						<li><a href="../../../ftp_files.html" class="subitem">Uploading files via ftp</a></li>
						<li><a href="../../../report_bug.html" class="subitem">Report Bugs</a></li>
					</ul>
				</li>

				<li>
				<a href="../../../External/index.html" class='trigger'>External</a>
					<ul>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="http://climatedataguide.ucar.edu/" class="subitem">Climate Data Guide</a></li>
						<li><a href="https://code.zmaw.de/projects/cdo/" class="subitem">Climate Data Operators</a></li>
						<li><a href="http://www.earthsystemmodeling.org/" class="subitem">Earth System Modeling Framework</a></li>
						<li><a href="http://nco.sourceforge.net/" class="subitem">NetCDF Operators</a></li>
						<li><a href="http://www.pyngl.ucar.edu/" class="subitem">PyNGL</a></li>
						<li><a href="http://www.pyngl.ucar.edu/Nio.shtml" class="subitem">PyNIO</a></li>
					</ul>
				</li>


			<!-- end menubar_main -->		
			</ul>
		
		<!-- end nav_main -->	
		</div>
		
	<!-- end nav_main_wrap -->	
  	</div>
		
			

	
	<div id="wrap"><!-- begin wrap -->
	<div id="content"><!-- begin content -->
	
	<!-- ######### BEGIN EDITABLE PAGE CONTENT ######### -->

			<div id="subheader"><!-- begin subheader -->
			<map name="ncl-home">
<area shape="rect" coords="0,0,65,40" href="../../../index-2.html">
<area shape="rect" coords="540,0,615,40" href="http://www.ncar.ucar.edu/">
<area shape="rect" coords="625,0,665,40" href="http://www.nsf.gov/">
</map>

	<div id="nclheader">
	<img src="https://www.ncl.ucar.edu/Images/NCL_NCAR_NSF_banner.png" height=40 "NCL Website header" usemap="#ncl-home">
	</div>


			<div id="googlesearch">
<form style="float:right" id="cse-search-box" action="http://google.com/cse">
  <input type="hidden" name="cx" value="016712339613867830978:igijo92w2zo" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" name="q" size="31" maxlength="255" id="searchbox" /><label for="searchbox">Search</label>
  <input type="hidden" name="hq" value="site:www.ncl.ucar.edu">
</form>
			</div><!-- end googlesearch -->

			</div><!-- end subheader -->
			
			      <div id="general_main">

<a class=crumb href="../../../index-2.html">NCL Home ></a>
<a class=crumb href="../../index-2.html">Documentation ></a>
<a class=crumb href="../index-2.html">Functions ></a>
<a class=crumb href="../ESMF.html">ESMF</a>,
<a class=crumb href="../regrid.html">Regridding</a>,
<a class=crumb href="../interp.html">Interpolation</a>
<br>
<h1>ESMF_regrid_gen_weights</h1>

<p>
Writes a weight file using the offline ESMF weight generator.
</p>

<p>
<img src="https://www.ncl.ucar.edu/Images/new.gif"> <i>Available in <a href="../../../prev_releases.html#6.1.0">version 6.1.0</a> and later.</i>
<p>
<a name="Prototype"></a>
<h2>Prototype</h2>
<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/esmf/ESMF_regridding.ncl"  ; This library is <b>automatically loaded </b>
                                                                  ; from NCL V6.5.0 onward.
                                                                  ; No need for user to explicitly load.

	procedure ESMF_regrid_gen_weights (
		srcGridFile [1] : string,   
		dstGridFile [1] : string,   
		wgtFile     [1] : string,   
		opt         [1] : logical   
	)
</pre>
<a name="Arguments"></a>
<h2>Arguments</h2>
<em>srcGridFile</em>
<p class=indent>Name of the input NetCDF file containing the SCRIP or ESMF grid
description for the source grid.
</p>
<em>dstGridFile</em>
<p class=indent>Name of the input NetCDF file containing the SCRIP or ESMF grid
description for the destination grid.
</p>
<em>wgtFile</em>
<p class=indent>Name of the output NetCDF file to use for writing the weights.
</p>
<em>opt</em>
<p class=indent>An optional variable to set certain attributes for this procedure.
If set to False, none of the attributes will have an effect.
</p>
<p class=indent>

See below for a full list of attributes.
</p>
<a name="Description"></a>
<h2>Description</h2>
<p>
This procedure writes weight values to a NetCDF file, which allow you
to interpolate data on a source grid to a destination grid.
It uses the input description files (<em>srcGridFile</em>
and <em>dstGridFile</em>) for the source and destination grids, and
the offline
"<a href="http://www.earthsystemmodeling.org/esmf_releases/last_built/ESMF_refdoc/node3.html">ESMF_RegridWeightGen</a>"
weight generation tool to generate the weights.
<p>

<strong>ESMF_regrid_gen_weights</strong> is part of
a suite of regridding routines based
on <a href="http://www.earthsystemmodeling.org/">Earth System Modeling
Framework</a> (ESMF) software. The regridding can be done via a
multi-step process that includes this procedure, or via an
"all-in-one" function
called <a href="ESMF_regrid.html"><strong>ESMF_regrid</strong></a>.<p>

Both methods have their advantages. The multi-step process involves:

<ol>
<li>Creating the description NetCDF file for the source grid.
<li>Creating the description NetCDF file for the destination grid.
<li>Calculating and writing the weights to a NetCDF file.
<li>Applying the weights to regrid the data from the source grid to
the destination grid.
<li>Copying attributes and coordinates to the newly regridded variable.
</ol>
<p>

The <a href="ESMF_regrid.html"><strong>ESMF_regrid</strong></a> function
performs all of the above steps.<p>

The source and destination grids can be written using one of the following
procedures:

<ul>
<li><a href="latlon_to_SCRIP.html"><strong>latlon_to_SCRIP</strong></a>
<li><a href="rectilinear_to_SCRIP.html"><strong>rectilinear_to_SCRIP</strong></a>
<li><a href="curvilinear_to_SCRIP.html"><strong>curvilinear_to_SCRIP</strong></a>
<li><a href="unstructured_to_ESMF.html"><strong>unstructured_to_ESMF</strong></a>
</ul>
<p>

You can then use
<a href="ESMF_regrid_with_weights.html"><strong>ESMF_regrid_with_weights</strong></a> to apply the
weights to a given data variable for interpolation to a new grid.
<p>

The attributes that can be attached to <em>opt</em> include:

<ul>

<li><b>InterpMethod</b> (default = "bilinear")

The interpolation method to use. The allowed types are "bilinear"
(default), "patch", "conserve", "neareststod" and "nearestdtos":
<p>

<ul>

<li>"bilinear" - the algorithm used by this application to generate
the bilinear weights is the standard one found in many textbooks. Each
destination point is mapped to a location in the source mesh, the
position of the destination point relative to the source points
surrounding it is used to calculate the interpolation weights.
<p>

<li>"patch" - this method is the ESMF version of a technique called
"patch recovery" commonly used in finite element modeling. It
typically results in better approximations to values and derivatives
when compared to bilinear interpolation.
<p>

<li>"conserve" - this method will typically have a larger
interpolation error than the previous two methods, but will do a much
better job of preserving the value of the integral of data between the
source and destination grid.
<p>

<li><b>"neareststod"</b> and <b>"nearestdtos"</b>
- <font color="red"><i>Available in <a href="../../../prev_releases.html#6.2.0">version 6.2.0</a> and later.</i></font> The nearest neighbor methods work by
associating a point in one set with the closest point in another
set. If two points are equally close then the point with the smallest
index is arbitrarily used (i.e. the point with that would have the
smallest index in the weight matrix). There are two versions of this
type of interpolation available in the regrid weight generation
application. One of these is the nearest source to destination method
("neareststod"). In this method each destination point is mapped to
the closest source point. The other of these is the nearest
destination to source method ("nearestdtos"). In this method each
source point is mapped to the closest destination point. Note, that
with this method the unmapped destination point detection doesn't
work, so no error will be returned even if there destination points
which don't map to any source point.
<p>

</ul>
<p>

<li><b>Pole</b> (default = "all" for "bilinear" or "patch" methods,
and "none" for "conserve", "neareststod", or "nearestdtos" methods)<p>

<font color="red">There's a bug in NCL versions 6.1.2 and earlier
where only "pole" is recognized, and not "Pole". This will be fixed in
version 6.2.0.</font>
<p>

For periodic logically rectangular source grid (e.g. without
Opt@SrcRegional=True), the regridding application will perform
extrapolation for destination points which lie above or below the
source grid. By specifying "all", the application does an average of
all the source values surrounding the pole and uses that value at an
artificially constructed pole in the center of the pole region. The
region around this pole is then triangulated to extrapolate
destination points. If "none" is specified, no extrapolation occurs
and destination points which fall above or below the source grid are
not mapped. A value of "all" is not supported for the "conserve",
"neareststod", or "nearestdtos" interpolation methods.
<p>

If "teeth" is specified, then no new pole point is constructed,
instead the holes at the poles are filled by constructing triangles
across the top and bottom row of the source Grid. This can be useful
because no averaging occurs, however, because the top and bottom of
the sphere are now flat, for a big enough mismatch between the size of
the destination and source pole regions, some destination points may
still not be able to be mapped to the source Grid.
<p>

If a value &lt;N&gt; is specified, then this will construct an
artificial pole placed in the center of the top (or bottom) row of
nodes, but projected onto the sphere formed by the rest of the
grid. The value at this pole is the average of the N source nodes next
to the pole and surrounding the destination point (i.e.  the value may
differ for each destination point. Here N ranges from 1 to the number
of nodes around the pole.
<p>

The default value is "all" if method is "bilinear" or "patch" (or not
set at all), and "none" if method is set to "conserve".
<p>

<li><b>SrcRegional</b> (default = False)<p>
By default, the ESMF regridding application assumes that a
logically rectangular grid is periodic. This means that it connects
the ends of the first dimension to form a sphere and allows
extrapolation over the pole. If this option is set to True, then the
source grid is assumed to NOT have a periodic connection and instead
is considered just a region of the sphere.
<p>

<li><b>DstRegional</b> (default = False)<p>
By default, the ESMF regridding application assumes that a
logically rectangular grid is periodic. This means that it connects
the ends of the first dimension to form a sphere and allows
extrapolation over the pole. If this option is set to True, then the
destination grid is assumed to NOT have a periodic connection and
instead is considered just a region of the sphere.
<p>

<li><b>SrcESMF</b> (default = False)<p>
If set to True, this indicates that the source file is in ESMF
unstructured format. If ESMF unstructured format is not specified then
the source file is assumed to be SCRIP format.
<p>

<li><b>DstESMF</b> (default = False)<p>
If set to True, this indicates that the destination file is in
ESMF unstructured format. If ESMF unstructured format is not specified
then the destination file is assumed to be SCRIP format.
<p>

<li><b>IgnoreUnmappedPoints</b> (default = True)<p>
The ESMF regridding application will return an error if there
exists a destination point for which regridding weights can't be
generated. In other words, if there exists a destination point which
can't be mapped to a source cell.  The default of this option is True,
which means the application ignores those destination points and they
simply won't be regridded.
<p>

<a name="NetCDFType"></a>
<li><b>NetCDFType</b> (default = "netcdf3")<p>

Set this option to "netcdf4" to force a NetCDF-4 file to be written
for the weights file. This will be necessary if your source or
destination grids or meshes are large, and require more than 2 GB of
memory to store the weights in the NetCDF file.
<p>

<font color="red"><i>Available in <a href="../../../prev_releases.html#6.2.1">version 6.2.1</a> and later.</i></font>

<li><b>LargeFile</b> (default = False)
If set to True, then the weight file will be created in the NetCDF
64-bit offset format to allow variables larger than 2GB.
<p>

<li><b>Overwrite</b> (default = False)
If set to True, then if the weight NetCDF file (<em>wgtFile</em>)
exists, you will be prompted for whether to remove it.
<p>

<li><b>ForceOverwrite</b> (default = False)
If set to True, then the weight NetCDF file (<em>wgtFile</em>)
will be overwritten no matter what.
<p>

<li><b>NoPETLog</b> (default = False) Do not generate the
"PET0.RegridWeightGen.log" file, or append anything to it if it 
already exists. See also the <b>RemovePETLog</b> option.
<p>
<font color="red"><i>Available in <a href="../../../prev_releases.html#6.2.1">version 6.2.1</a> and later.</i></font>

<li><b>RemoveFiles</b> / RemoveSrcFile / RemoveDstFile  (default = False)

If True, then the corresponding description file will
be removed after the weight generation is done.  If the weight
generation is unsuccessful, these files won't be removed.
<p>

<li><b>RemovePETLog</b> (default = False) Remove the
"PET0.RegridWeightGen.log" file, if generated. See also
the <b>NoPETLog</b> option.
<p>
<font color="red"><i>Available in <a href="../../../prev_releases.html#6.2.0">version 6.2.0</a> and later.</i></font>

<li><b>PrintTimings</b> (default = False)
print the CPU time spent in this routine
<p>

<li><b>Check</b> (default = False)<p>

If set to True, then extra analytic output will be computed and
printed, including the mean relative error between the destination and
analytic field, and the relative error between the mass of the source
and destination fields in the conservative case.
<p>
<font color="red"><i>Available in <a href="../../../prev_releases.html#6.2.1">version 6.2.1</a> and later.</i></font>

<li><b>Debug</b> (default = False)
Turn on debug print statements. This will also print the full
command line used for
"<a href="http://www.earthsystemmodeling.org/esmf_releases/last_built/ESMF_refdoc/node3.html">ESMF_RegridWeightGen</a>".
<p>

</ul>


</p><a name="See_also"></a>
<h2>See Also</h2>
<p>
<a href="ESMF_regrid.html"><strong>ESMF_regrid</strong></a>,
<a href="latlon_to_SCRIP.html"><strong>latlon_to_SCRIP</strong></a>,
<a href="rectilinear_to_SCRIP.html"><strong>rectilinear_to_SCRIP</strong></a>,
<a href="curvilinear_to_SCRIP.html"><strong>curvilinear_to_SCRIP</strong></a>,
<a href="unstructured_to_ESMF.html"><strong>unstructured_to_ESMF</strong></a>,
<strong>ESMF_regrid_gen_weights</strong>,
<a href="ESMF_regrid_with_weights.html"><strong>ESMF_regrid_with_weights</strong></a>
</p><a name="Examples"></a>
<h2>Examples</h2>
<p>
There's a suite of examples available on
our <a href="../../../Applications/ESMF.html">ESMF applications page</a>, and
a set of <a href="../../../Applications/Templates/index.html">basic ESMF template
scripts</a> to help you get started.
<p>

<b>Example 1</b><p>

This example regrids data from a global rectilinear NCEP grid (64 x
181) to a 5x5 degree lat/lon grid (25 x 72), using the default
"bilinear" interpolation method.
<p>

This example assumes the description and weight files have not been
generated. If they have, then see example 2 below.
<p>

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/contributed.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/esmf/ESMF_regridding.ncl"

begin
;---Input file
    srcFileName = "sst.nc"

;---Output (and input) files
    srcGridName = "src_SCRIP.nc"
    dstGridName = "dst_SCRIP.nc"
    wgtFileName = "NCEP_2_Rect.nc"

;----------------------------------------------------------------------
; Convert original source NCEP grid to a SCRIP convention file.
;----------------------------------------------------------------------
    src_file = <a href="../Built-in/addfile.html"><strong>addfile</strong></a>(srcFileName,"r")
    temp     = src_file->TEMP(0,0,:,:)

    Opt                = True
    Opt@GridMask       = where(.not.ismissing(temp),1,0)   ; use Mask2D in NCL V6.2.1 and earlier
    Opt@ForceOverwrite = True
    Opt@PrintTimings   = True
    Opt@Title          = "NCEP Grid"

    <a href="rectilinear_to_SCRIP.html"><strong>rectilinear_to_SCRIP</strong></a>(srcGridName,temp&LAT,temp&LON,Opt)

;---Clean up
    delete(Opt)

;----------------------------------------------------------------------
; Convert destination grid to a SCRIP convention file.
;----------------------------------------------------------------------
    Opt                = True
    Opt@LLCorner       = (/ -60.d,   0.d/)
    Opt@URCorner       = (/  60.d, 355.d/)
    Opt@ForceOverwrite = True
    Opt@PrintTimings   = True

    <a href="latlon_to_SCRIP.html"><strong>latlon_to_SCRIP</strong></a>(dstGridName,"5x5",Opt)

;---Clean up
    delete(Opt)

;----------------------------------------------------------------------
; Generate the weights that take you from the NCEP grid to a
; 5x5 degree grid.
;----------------------------------------------------------------------
    Opt                      = True
    Opt@InterpMethod         = "bilinear"     ; default
    Opt@ForceOverwrite       = True
    Opt@PrintTimings         = True

    <strong>ESMF_regrid_gen_weights</strong>(srcGridName,dstGridName,wgtFileName,Opt)

    delete(Opt)

;----------------------------------------------------------------------
; Apply the weights to a given variable on the NCEP file.
;----------------------------------------------------------------------
    Opt                = True
    Opt@PrintTimings   = True

;---In V6.1.0, coordinates and attributes are copied automatically
    temp_regrid = <a href="ESMF_regrid_with_weights.html"><strong>ESMF_regrid_with_weights</strong></a>(temp,wgtFileName,Opt)
    printVarSummary(temp_regrid)

;----------------------------------------------------------------------
; Plot the original and regridded data on a panel plot
;----------------------------------------------------------------------
    wks = <a href="../../Graphics/Interfaces/gsn_open_wks.html"><strong>gsn_open_wks</strong></a>("ps","ESMF")             ; ESMF.ps
    <a href="../../Graphics/Interfaces/gsn_define_colormap.html"><strong>gsn_define_colormap</strong></a>(wks,"gui_default")      ; choose colormap

    res                     = True              ; Plot mods desired.
    res@gsnDraw             = False             ; We will panel later.
    res@gsnFrame            = False

    res@gsnMaximize         = True              ; Maximize plot
    
    res@mpMaxLatF           = 60                 ; choose map range
    res@mpMinLatF           = -60 

    res@cnFillOn            = True              ; color plot desired
    res@cnLinesOn           = False             ; turn off contour lines
    res@cnLineLabelsOn      = False             ; turn off contour lines

    res@cnLevelSelectionMode =  "ManualLevels"   ; manual levels
    res@cnMinLevelValF       = 4                 ; min level
    res@cnMaxLevelValF       = 32                ; max level
    res@cnLevelSpacingF      =  2                ; interval

    res@lbLabelBarOn        = False              ; Labelbar will be in panel

;---Plot data on original grid
    res@gsnAddCyclic = False

    dims = <a href="../Built-in/tostring.html"><strong>tostring</strong></a>(<a href="../Built-in/dimsizes.html"><strong>dimsizes</strong></a>(temp))
    res@tiMainString = "NCEP monthly means temp: original data (" + \
                       <a href="../Built-in/str_join.html"><strong>str_join</strong></a>(dims," x ") + ")"
    plot_orig = <a href="../../Graphics/Interfaces/gsn_csm_contour_map.html"><strong>gsn_csm_contour_map</strong></a>(wks,temp,res)     

;---Plot data interpolated onto 5x5 degree grid
    res@gsnAddCyclic = True

    dims = <a href="../Built-in/tostring.html"><strong>tostring</strong></a>(dimsizes(temp_regrid))
    res@tiMainString = "NCEP monthly means temp: regridded to 5x5 grid (" +\
                       <a href="../Built-in/str_join.html"><strong>str_join</strong></a>(dims," x ") + ")"
    plot_regrid = <a href="../../Graphics/Interfaces/gsn_csm_contour_map.html"><strong>gsn_csm_contour_map</strong></a>(wks,temp_regrid,res)     

;---Resources for paneling
    pres                  = True
    pres@gsnMaximize      = True
    pres@gsnPanelLabelBar = True

    <a href="../../Graphics/Interfaces/gsn_panel.html"><strong>gsn_panel</strong></a>(wks,(/plot_orig,plot_regrid/),(/2,1/),pres)
end
</pre>
<p>

<b>Example 2</b><p>

This example assumes the "NCEP_2_Rect.nc" weight file from the
previous example has already been generated. It uses this
weight file to regrid a new variable from the same "sst.nc" 
input file.
<p>


The same weights file can only be used if the source and destination
lat/lon grids are the same, <i>and</i> if the mask for the new
variable is the same as the mask for the "temp" variable.
<p>

<pre>
. . .
    sfile = addfile("sst.nc","r")
    P  = sfile->P(0,0,:,:)

    P_regrid = <a href="ESMF_regrid_with_weights.html"><strong>ESMF_regrid_with_weights</strong></a>(P,"NCEP_2_Rect.nc",False)
    printVarSummary(P_regrid)
. . .
</pre>
</p>					</div>

					<p>&nbsp;</p>

		<!-- begin footer -->
		<div id="footer">
		
		<a href="mailto:ncladmin@ucar.edu">Contact the Webmaster</a>



		<!-- end footer -->
		</div>

           <br class="clearboth"/>

	   <!-- end content -->
	</div>
<!-- end wrap -->
</div>
</body>

<!-- Mirrored from www.ncl.ucar.edu/Document/Functions/ESMF/ESMF_regrid_gen_weights.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 15:18:28 GMT -->
</html>
