<html>

<!-- Mirrored from www.ncl.ucar.edu/Document/Functions/ESMF/unstructured_to_ESMF.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 15:19:19 GMT -->
<head>
<meta name="description" content="ESMF regridding functions (interpolation)">
<meta name="keywords" content="unstructured_to_ESMF">
<title>unstructured_to_ESMF</title>
</head>

<body>
	
	<!-- main navigation include -->
		<!-- NCL CSS -->
	<link rel="stylesheet" href="../../../styles/ncl.css" type="text/css" media="all">
	
	
		<!-- Equal Height Columns -->
		<script type="text/javascript" src="../../../scripts/column_height_equal.js"></script>
		
		<!-- DOJO Expandable Tree Nav -->

		<script type="text/javascript" src="../../../scripts/dojo/dojo.js"></script>
		<script type="text/javascript">
		
		dojo.require("dojo.widget.TreeV3");
		dojo.require("dojo.widget.TreeNodeV3");
		dojo.require("dojo.widget.TreeLinkExtension");
		dojo.require("dojo.widget.TreeBasicControllerV3");
		dojo.hostenv.writeIncludes();

		</script>
		

		<div id="top_colorbar"><!-- begin top_colorbar -->
		</div><!-- end top_colorbar -->


	<div id="nav_org_wrap"><!-- begin nav_org_wrap -->
	<div id="nav_org"><!-- begin nav_org -->

		<ul class="menubar">


			<li><a class="trigger" href="../../../internal/index.html">&nbsp;</a>
			</li>

			<li><a class="trigger" href="http://www.ucar.edu/">UCAR</a>
			</li>

			<li><a class="trigger" href="http://www.ncar.ucar.edu/">NCAR</a>
			</li>

			<li><a class="trigger" href="http://www.cisl.ucar.edu/">CISL</a>
			</li>
		</ul>

	</div><!-- end nav_org -->

	<div id="search"><!-- begin search -->

		<ul class="menubar">

			<li><a class="trigger" href="../../../Download/index.html">Download</a>
			</li>

			<li><a class="trigger" href="../../../citation.html">Citing NCL</a>
			</li>

			<li><a class="trigger" href="../../../contributors.html">Contributors</a>
			</li>

		</ul>

	</div><!-- end search -->

	</div><!-- end nav_org_wrap -->
	
	
	

		<div id="nav_main_wrap"><!-- begin nav_main_wrap -->

		<div id="nav_main"><!-- begin nav_main -->
			<ul id="menubar_main">

				<li>
				<a href="../../Pivot_to_Python/september_2019_update.html" class="triggeryw">&#9733; UPDATED LETTER TO NCL USERS</a>
				<li>
				<a href="../../../index.html" class="triggeron">NCL</a>
					<ul>
                                          <li><a href="../../Pivot_to_Python/index.html">Pivot to Python</a>
					  <li><a href="../../../overview.html" class="subitem">Overview</a></li>
						<li><a href="../../../get_started.html" class="subitem">Getting Started</a> </li>
						<li><a href="../../../gallery.html" class="subitem">Gallery</a></li>
						<li><a href="../../../Download/index.html" class="subitem">Download</a></li>
						<li><a href="../../../current_release.html" class="subitem">What's New</a></li>
						<li><a href="../../index.html" class="subitem">Documentation</a></li>						
						<li><a href="../../../citation.html" class="subitem">Citing NCL</a></li>
					</ul>

				</li>

				<li>
				<a href="../../../Applications/index.html" class="trigger">Examples</a>
					<ul>
						<li><a href="../../../Applications/index.html" class="subitem" title="Examples">All Examples</a></li>
						<li><a href="../../../Applications/Templates/index.html" class="subitem">Templates</a></li>
						<li><a href="../../../Applications/list_io.html" class="subitem">File I/O</a></li>
						<li><a href="../../../Applications/list_data.html" class="subitem">Datasets</a></li>
						<li><a href="../../../Applications/list_maps.html" class="subitem">Maps</a></li>
						<li><a href="../../../Applications/list_models.html" class="subitem">Models</a></li>
						<li><a href="../../../Applications/list_dataP.html" class="subitem">Data Analysis</a></li>
						<li><a href="../../../Applications/list_ptypes.html" class="subitem">Plot Types</a></li>
						<li><a href="../../../Applications/list_tech.html" class="subitem">Plot Techniques</a></li>
						<li><a href="../../../Applications/list_special.html" class="subitem">Special Plots</a></li>
						<li><a href="../../../Applications/list_grids.html" class="subitem">Non-uniform Grids</a></li>
						<li><a href="../../../Applications/list_misc.html" class="subitem">Miscellaneous</a></li>
					</ul>
				</li>

				<li>
				<a href="../list_alpha.html" class="trigger">Functions</a>
					<ul>
						<li><a href="../list_alpha.html" class="subitem">Alphabetical Listing</a></li>
						<li><a href="../index.html" class="subitem">Category Listing</a></li>
						<li><a href="../list_type.html" class="subitem">Function-Type Listing</a></li>						
					</ul>
				</li>
				
				<li>
				<a href="../../Graphics/Resources/index.html" class="trigger">Resources</a>
					<ul>
					  <li><a href="../../Graphics/Resources/list_alpha_res.html" class="subitem">Complete Listing</a></li>
					
						<li><a href="../../Graphics/Resources/am.html" class="subitem">am (annotation manager)</a></li>
						<li><a href="../../Graphics/Resources/app.html" class="subitem">app (app)</a></li>
						<li><a href="../../Graphics/Resources/ca.html" class="subitem">ca (coordinate array)</a></li>
						<li><a href="../../Graphics/Resources/cn.html" class="subitem">cn (contour)</a></li>
						<li><a href="../../Graphics/Resources/ct.html" class="subitem">ct (coordinate array table)</a></li>
						<li><a href="../../Graphics/Resources/dc.html" class="subitem">dc (data comm)</a></li>
						
						<li><a href="../../Graphics/Resources/err.html" class="subitem">err (error)</a></li>
						<li><a href="../../Graphics/Resources/gs.html" class="subitem">gs (graphics styles)</a></li>
						<li><a href="../../Graphics/Resources/gsn.html" class="subitem">gsn (gsn high-level interfaces)</a></li>
						<li><a href="../../Graphics/Resources/lb.html" class="subitem">lb (label bar)</a></li>
						<li><a href="../../Graphics/Resources/lg.html" class="subitem">lg (legends)</a></li>
						<li><a href="../../Graphics/Resources/mp.html" class="subitem">mp (maps)</a></li>
						
						<li><a href="../../Graphics/Resources/pm.html" class="subitem">pm (plot manager)</a></li>
						<li><a href="../../Graphics/Resources/pr.html" class="subitem">pr (primitives)</a></li>
						<li><a href="../../Graphics/Resources/sf.html" class="subitem">sf (scalar field)</a></li>
						<li><a href="../../Graphics/Resources/st.html" class="subitem">st (streamline)</a></li>
						<li><a href="../../Graphics/Resources/tf.html" class="subitem">tf (transform)</a></li>
						<li><a href="../../Graphics/Resources/ti.html" class="subitem">ti (title)</a></li>
						
						<li><a href="../../Graphics/Resources/tm.html" class="subitem">tm (tickmark)</a></li>
						<li><a href="../../Graphics/Resources/tr.html" class="subitem">tr (transformation)</a></li>
						<li><a href="../../Graphics/Resources/tx.html" class="subitem">tx (text)</a></li>
						<li><a href="../../Graphics/Resources/vc.html" class="subitem">vc (vectors)</a></li>
						<li><a href="../../Graphics/Resources/vf.html" class="subitem">vf (vector field)</a></li>
						<li><a href="../../Graphics/Resources/vp.html" class="subitem">vp (view port)</a></li>
						
						<li><a href="../../Graphics/Resources/wk.html" class="subitem">wk (workstation)</a></li>
						<li><a href="../../Graphics/Resources/ws.html" class="subitem">ws (workspace)</a></li>
						<li><a href="../../Graphics/Resources/xy.html" class="subitem">xy (xy plots)</a></li>						
					</ul>
        </li>

				<li>
				<a href="../../../links.html" class="trigger">Popular Links</a>
					<ul>
					<li><a href="../../Graphics/hlures.html" class="subitem">.hluresfile</a></li>
					<li><a href="../../Graphics/color_table_gallery.html" class="subitem">Color Tables</a></li>
					<li><a href="../../Graphics/font_tables.html" class="subitem">Font Tables</a></li>	
					<li><a href="../../Language/error_messages.html" class="subitem">Error Messages</a></li>	
					<li><a href="../../Graphics/Images/dashpatterns.png" class="subitem">Dash Pattern Table</a></li>	
					<li><a href="../../Graphics/Images/fillpatterns.png" class="subitem">Fill Pattern Table</a></li>	
					<li><a href="../../Graphics/Images/markers.png" class="subitem">Marker Table</a></li>
					<li><a href="../../Graphics/map_projections.html" class="subitem">Map Projections</a></li>
					<li><a href="../../Graphics/rangs.html" class="subitem">High Resolution Map Database</a></li>
					<li><a href="../../../Applications/editor.html" class="subitem">Editor Enhancements</a></li>
					<li><a href="../../Tools/ncl_convert2nc.html">ncl_convert2nc</a></li>
					<li><a href="../../Tools/ncl_filedump.html">ncl_filedump</a></li>
					<li><a href="../../Tools/index.html" class="subitem">Tools</a></li>
					<li><a href="../../Tools/WRAPIT.html" class="subitem">WRAPIT</a></li>
					</ul>
				</li>

				<li>
				<a href="../../../announcements.html" class="trigger">What's New</a>
					<ul>
					        <li><a href="../../../announcements.html" class="subitem">Announcements</a></li>
						<li><a href="../../../current_release.html" class="subitem">In Latest Release</a></li>
						<li><a href="../../../new_applications.html" class="subitem">In Application Examples</a></li>
						<li><a href="../../../future_release.html" class="subitem">In Next Release</a></li>	
						<li><a href="../../../prev_releases.html" class="subitem">In Previous Releases</a></li>
					</ul>
				</li>
	

				<li>
				<a href="../../../Support/index.html" class='trigger'>Support</a>
					<ul>
						<li><a href="../../../Support/email_lists.html" class="subitem">Email Lists</a></li>
						<li><a href="../../../Applications/editor.html" class="subitem">Editor enhancements</a></li>
						<li><a href="../../Language/error_messages.html" class="subitem">Error messages</a></li>
						<li><a href="../../Manuals/index.html" class="subitem">Manuals</a></li>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="../../../Training/index.html" class="subitem">Training</a></li>
						<li><a href="../../../Training/Webinars/index.html" class="subitem">Webinars</a></li>
						<li><a href="../../../Training/Workshops/index.html" class="subitem">Workshops</a></li>
						<li><a href="../../index.html" class="subitem">Documentation</a></li>
						<li><a href="../../../FAQ/index.html" class="subitem">FAQ</a></li>
						<li><a href="../../../ftp_files.html" class="subitem">Uploading files via ftp</a></li>
						<li><a href="../../../report_bug.html" class="subitem">Report Bugs</a></li>
					</ul>
				</li>

				<li>
				<a href="../../../External/index.html" class='trigger'>External</a>
					<ul>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="http://climatedataguide.ucar.edu/" class="subitem">Climate Data Guide</a></li>
						<li><a href="https://code.zmaw.de/projects/cdo/" class="subitem">Climate Data Operators</a></li>
						<li><a href="http://www.earthsystemmodeling.org/" class="subitem">Earth System Modeling Framework</a></li>
						<li><a href="http://nco.sourceforge.net/" class="subitem">NetCDF Operators</a></li>
						<li><a href="http://www.pyngl.ucar.edu/" class="subitem">PyNGL</a></li>
						<li><a href="http://www.pyngl.ucar.edu/Nio.shtml" class="subitem">PyNIO</a></li>
					</ul>
				</li>


			<!-- end menubar_main -->		
			</ul>
		
		<!-- end nav_main -->	
		</div>
		
	<!-- end nav_main_wrap -->	
  	</div>
		
			

	
	<div id="wrap"><!-- begin wrap -->
	<div id="content"><!-- begin content -->
	
	<!-- ######### BEGIN EDITABLE PAGE CONTENT ######### -->

			<div id="subheader"><!-- begin subheader -->
			<map name="ncl-home">
<area shape="rect" coords="0,0,65,40" href="../../../index-2.html">
<area shape="rect" coords="540,0,615,40" href="http://www.ncar.ucar.edu/">
<area shape="rect" coords="625,0,665,40" href="http://www.nsf.gov/">
</map>

	<div id="nclheader">
	<img src="https://www.ncl.ucar.edu/Images/NCL_NCAR_NSF_banner.png" height=40 "NCL Website header" usemap="#ncl-home">
	</div>


			<div id="googlesearch">
<form style="float:right" id="cse-search-box" action="http://google.com/cse">
  <input type="hidden" name="cx" value="016712339613867830978:igijo92w2zo" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" name="q" size="31" maxlength="255" id="searchbox" /><label for="searchbox">Search</label>
  <input type="hidden" name="hq" value="site:www.ncl.ucar.edu">
</form>
			</div><!-- end googlesearch -->

			</div><!-- end subheader -->
			
			      <div id="general_main">

<a class=crumb href="../../../index-2.html">NCL Home ></a>
<a class=crumb href="../../index-2.html">Documentation ></a>
<a class=crumb href="../index-2.html">Functions ></a>
<a class=crumb href="../ESMF.html">ESMF</a>,
<a class=crumb href="../regrid.html">Regridding</a>,
<a class=crumb href="../interp.html">Interpolation</a>
<br>
<h1>unstructured_to_ESMF</h1>

<p>
Writes the description of an unstructured grid to an ESMF file.
</p>

<p>
<img src="https://www.ncl.ucar.edu/Images/new.gif"> <i>Available in <a href="../../../prev_releases.html#6.1.0">version 6.1.0</a> and later.</i>
<p>
<a name="Prototype"></a>
<h2>Prototype</h2>
<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/esmf/ESMF_regridding.ncl"  ; This library is <b>automatically loaded </b>
                                                                  ; from NCL V6.5.0 onward.
                                                                  ; No need for user to explicitly load.

	procedure unstructured_to_ESMF (
		ESMF_filename [1] : string,   
		lat               : numeric,  
		lon               : numeric,  
		opt           [1] : logical   
	)
</pre>
<a name="Arguments"></a>
<h2>Arguments</h2>
<em>ESMF_filename</em>
<p class=indent>Name of ESMF NetCDF file to write.
</p>
<em>lat</em>
<br>
<em>lon</em>
<p class=indent>The lat/lon arrays representing the unstructured grid.
</p>
<em>opt</em>
<p class=indent>An optional variable to set certain attributes for this procedure.
If set to False, none of the attributes will have an effect.
</p>
<p class=indent>

See below for a full list of attributes.
</p>
<a name="Description"></a>
<h2>Description</h2>
<p>
This procedure writes the description of a
an <a href="../../glossary.html#UnstructuredGrid">unstructured</a> grid to
an ESMF description file.<p>

<strong>unstructured_to_ESMF</strong> is part of a
suite of regridding routines based on
<a href="http://www.earthsystemmodeling.org/">Earth System Modeling
Framework</a> (ESMF) software. The regridding can be done via a
multi-step process that includes this procedure, or via an
"all-in-one" function
called <a href="ESMF_regrid.html"><strong>ESMF_regrid</strong></a>.<p>

Both methods have their advantages. The multi-step process involves:

<ol>
<li>Creating the description NetCDF file for the source grid.
<li>Creating the description NetCDF file for the destination grid.
<li>Calculating and writing the weights to a NetCDF file.
<li>Applying the weights to regrid the data from the source grid to
the destination grid.
<li>Copying attributes and coordinates to the newly regridded variable.
</ol>
<p>

The <a href="ESMF_regrid.html"><strong>ESMF_regrid</strong></a> function
performs all of the above steps.<p>

The attributes that can be attached to <em>opt</em> include:

<ul>

<a name="GridMask"></a>
<li><b>GridMask</b> (old name is <b>Mask2D</b>) (no default) A mask
array of the same size as the desired lat/lon grid, that indicates
which areas to mask out (that is, which values are missing). Set the
masked (missing) areas to 0, and all the rest to 1.
<p>

If these masks are different across multiple levels or timesteps, then
you will need to generate a separate weights file for each level or
timestep where it changes.  See the <a href="#NoteOnMasking">special
note</a> below.<p>
<p>

<li><b>GridCornerLat</b> / <b>GridCornerLon</b> (calculated internally if not provided)<p>

These arrays indicate the corner (edge) points of your source grid. If you
don't set these attributes, then they will be calculated for you using
a generic algorithm.
<p>

<i>It is better to use your own calculated values, especially for
unusual grids like the <a href="../../../Applications/homme.html">HOMME
grid</a>.</i> The values must be provided as an <i>N</i> x 4 array,
where <i>N</i> represents the dimensionality of the center lat/lon
grid. For example, if the center lat/lon grid is dimensioned 256 x
220, then the corner arrays must be 256 x 220 x 4.  Sometimes the
corner grids are provided on the file along with the center grids,
with names like "lat_vertices"/"lon_vertices" or
"lat_bounds"/"lon_bounds".
<p>

<a name="NetCDFType"></a>
<li><b>NetCDFType</b> (default = "netcdf3")<p>

You can set this option to "netcdf4" to force a NetCDF-4 file to be
written for the weights file. This will be necessary if your
unstructured grid or mesh requires more than 2 GB of memory to store
it in the NetCDF file.
<p>

<font color="red"><i>Available in <a href="../../../prev_releases.html#6.2.1">version 6.2.1</a> and later.</i></font>

<li><b>LargeFile</b> (default = True) This causes the NetCDF file to
be written with "large file support" turned on. This creates a "64-bit
offset" NetCDF file under the hood and allows you to write variables
&gt; 2 GB but less than 4 GB.<p>

If you are working with large data files that require more than 4 GB,
you may need to set one or more of
the <a href="#NetCDFType">NetCDFType</a> options to "netcdf4". This
will force a NetCDF4 file to be written under the hood and will allow
you to write variables that are &gt; 4 GB.<p>
<p>

<li><b>Overwrite</b> (default = False)
If set to True, then if the description NetCDF file exists, you
will be prompted for whether to remove it.
<p>

<li><b>ForceOverwrite</b> (default = False)
If set to True, then the description NetCDF file will be
overwritten no matter what.
<p>

<li><b>InputFileName</b> (no default)
Optional: name of the file containing the unstructured grid.
<p>

<li><b>LargeFile</b> (default = False)
If set to True, then the NetCDF file will be written in "large
file" mode.
<p>

<li><b>PrintTimings</b> (default = False)
Print the CPU time spent in this routine.
<p>

<li><b>Debug</b> (default = False)
Turn on debug prints.

</ul>

<a name="NoteOnMasking"></a>
<b>Special note about weights files and missing values:</b><p>

You can use the same weights file to regrid across other levels and
timesteps of the same variable, or across other variables, as long as
1) the lat/lon grid that you are regridding from and to are exactly the
same, <i>and</i>, 2) if you use the
special <a href="#GridMask">GridMask</a> (old name "Mask2D") option,
that your masks are exactly the same. The masks are arrays filled with
0's and 1's that indicate where your data values and/or lat/lon values
are missing. Here's a description from Robert Oehmke of ESMF about
this:
<p>

What the mask does is remove the entity (cell or point depending on
the type of regridding) from consideration by the regridder. If it's a
source cell then no destination entities are mapped to it. If it's a
destination entity, then it's not interpolated to. There is a little
more <a href="http://earthsystemmodeling.org/esmf_releases/non_public/ESMF_6_1_1/ESMF_refdoc/node5.html#SECTION05012600000000000000">in-depth
discussion</a> in the ESMF reference manual.
<p>

Right now, masking needs to be done before weight calculation so the
regridding knows what it should ignore, so if the mask changes then
you need to regenerate weights. We actually have a feature request
ticket for handling this type of missing value situation more
fluidly. The plan is to have the interpolation automatically not use
missing values when they are encountered in a data field. Which would
allow the same weights to be used for all the levels.
<p>

One trick you can do right now with missing values and a weight file
is to do two interpolations to tell you where the missing values will
spread in the destination field. First interpolate a field containing
all 0's except for where the missing values are set the missing value
locations to 1, the result of this interpolation tells you which
destination locations (the ones whose values >0.0) will be affected by
the missing values, so you can ignore them after interpolating the
data. (You could also do something like this in one step during the
data interpolation if you have a restricted range for your data and
you use a value way outside that range for your missing value.) This,
of course, will give you a coarser result than using the masking, but
will probably be more efficient than recalculating the weights each
time.
<p>


</p><a name="See_also"></a>
<h2>See Also</h2>
<p>
<a href="ESMF_regrid.html"><strong>ESMF_regrid</strong></a>,
<a href="latlon_to_SCRIP.html"><strong>latlon_to_SCRIP</strong></a>,
<a href="rectilinear_to_SCRIP.html"><strong>rectilinear_to_SCRIP</strong></a>,
<a href="curvilinear_to_SCRIP.html"><strong>curvilinear_to_SCRIP</strong></a>,
<strong>unstructured_to_ESMF</strong>,
<a href="ESMF_regrid_gen_weights.html"><strong>ESMF_regrid_gen_weights</strong></a>,
<a href="ESMF_regrid_with_weights.html"><strong>ESMF_regrid_with_weights</strong></a>
</p><a name="Examples"></a>
<h2>Examples</h2>
<p>
There's a suite of examples available on
our <a href="../../../Applications/ESMF.html">ESMF applications page</a>, and
a set of <a href="../../../Applications/Templates/index.html">basic ESMF template
scripts</a> to help you get started.
<p>
</p>					</div>

					<p>&nbsp;</p>

		<!-- begin footer -->
		<div id="footer">
		
		<a href="mailto:ncladmin@ucar.edu">Contact the Webmaster</a>



		<!-- end footer -->
		</div>

           <br class="clearboth"/>

	   <!-- end content -->
	</div>
<!-- end wrap -->
</div>
</body>

<!-- Mirrored from www.ncl.ucar.edu/Document/Functions/ESMF/unstructured_to_ESMF.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 15:19:19 GMT -->
</html>
