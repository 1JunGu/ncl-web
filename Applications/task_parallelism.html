<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.ncl.ucar.edu/Applications/task_parallelism.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 15:17:41 GMT -->
<head>
<meta name="description" content="Task Parallelism"> 
<TITLE>NCL: Task Parallelism</TITLE>
</head>

<body>
	
	<!-- main navigation include -->
		<!-- NCL CSS -->
	<link rel="stylesheet" href="../styles/ncl.css" type="text/css" media="all">
	
	
		<!-- Equal Height Columns -->
		<script type="text/javascript" src="../scripts/column_height_equal.js"></script>
		
		<!-- DOJO Expandable Tree Nav -->

		<script type="text/javascript" src="../scripts/dojo/dojo.js"></script>
		<script type="text/javascript">
		
		dojo.require("dojo.widget.TreeV3");
		dojo.require("dojo.widget.TreeNodeV3");
		dojo.require("dojo.widget.TreeLinkExtension");
		dojo.require("dojo.widget.TreeBasicControllerV3");
		dojo.hostenv.writeIncludes();

		</script>
		

		<div id="top_colorbar"><!-- begin top_colorbar -->
		</div><!-- end top_colorbar -->


	<div id="nav_org_wrap"><!-- begin nav_org_wrap -->
	<div id="nav_org"><!-- begin nav_org -->

		<ul class="menubar">


			<li><a class="trigger" href="../internal/index.html">&nbsp;</a>
			</li>

			<li><a class="trigger" href="http://www.ucar.edu/">UCAR</a>
			</li>

			<li><a class="trigger" href="http://www.ncar.ucar.edu/">NCAR</a>
			</li>

			<li><a class="trigger" href="http://www.cisl.ucar.edu/">CISL</a>
			</li>
		</ul>

	</div><!-- end nav_org -->

	<div id="search"><!-- begin search -->

		<ul class="menubar">

			<li><a class="trigger" href="../Download/index.html">Download</a>
			</li>

			<li><a class="trigger" href="../citation.html">Citing NCL</a>
			</li>

			<li><a class="trigger" href="../contributors.html">Contributors</a>
			</li>

		</ul>

	</div><!-- end search -->

	</div><!-- end nav_org_wrap -->
	
	
	

		<div id="nav_main_wrap"><!-- begin nav_main_wrap -->

		<div id="nav_main"><!-- begin nav_main -->
			<ul id="menubar_main">

				<li>
				<a href="../Document/Pivot_to_Python/september_2019_update.html" class="triggeryw">&#9733; UPDATED LETTER TO NCL USERS</a>
				<li>
				<a href="../index.html" class="triggeron">NCL</a>
					<ul>
                                          <li><a href="../Document/Pivot_to_Python/index.html">Pivot to Python</a>
					  <li><a href="../overview.html" class="subitem">Overview</a></li>
						<li><a href="../get_started.html" class="subitem">Getting Started</a> </li>
						<li><a href="../gallery.html" class="subitem">Gallery</a></li>
						<li><a href="../Download/index.html" class="subitem">Download</a></li>
						<li><a href="../current_release.html" class="subitem">What's New</a></li>
						<li><a href="../Document/index.html" class="subitem">Documentation</a></li>						
						<li><a href="../citation.html" class="subitem">Citing NCL</a></li>
					</ul>

				</li>

				<li>
				<a href="index.html" class="trigger">Examples</a>
					<ul>
						<li><a href="index.html" class="subitem" title="Examples">All Examples</a></li>
						<li><a href="Templates/index.html" class="subitem">Templates</a></li>
						<li><a href="list_io.html" class="subitem">File I/O</a></li>
						<li><a href="list_data.html" class="subitem">Datasets</a></li>
						<li><a href="list_maps.html" class="subitem">Maps</a></li>
						<li><a href="list_models.html" class="subitem">Models</a></li>
						<li><a href="list_dataP.html" class="subitem">Data Analysis</a></li>
						<li><a href="list_ptypes.html" class="subitem">Plot Types</a></li>
						<li><a href="list_tech.html" class="subitem">Plot Techniques</a></li>
						<li><a href="list_special.html" class="subitem">Special Plots</a></li>
						<li><a href="list_grids.html" class="subitem">Non-uniform Grids</a></li>
						<li><a href="list_misc.html" class="subitem">Miscellaneous</a></li>
					</ul>
				</li>

				<li>
				<a href="../Document/Functions/list_alpha.html" class="trigger">Functions</a>
					<ul>
						<li><a href="../Document/Functions/list_alpha.html" class="subitem">Alphabetical Listing</a></li>
						<li><a href="../Document/Functions/index.html" class="subitem">Category Listing</a></li>
						<li><a href="../Document/Functions/list_type.html" class="subitem">Function-Type Listing</a></li>						
					</ul>
				</li>
				
				<li>
				<a href="../Document/Graphics/Resources/index.html" class="trigger">Resources</a>
					<ul>
					  <li><a href="../Document/Graphics/Resources/list_alpha_res.html" class="subitem">Complete Listing</a></li>
					
						<li><a href="../Document/Graphics/Resources/am.html" class="subitem">am (annotation manager)</a></li>
						<li><a href="../Document/Graphics/Resources/app.html" class="subitem">app (app)</a></li>
						<li><a href="../Document/Graphics/Resources/ca.html" class="subitem">ca (coordinate array)</a></li>
						<li><a href="../Document/Graphics/Resources/cn.html" class="subitem">cn (contour)</a></li>
						<li><a href="../Document/Graphics/Resources/ct.html" class="subitem">ct (coordinate array table)</a></li>
						<li><a href="../Document/Graphics/Resources/dc.html" class="subitem">dc (data comm)</a></li>
						
						<li><a href="../Document/Graphics/Resources/err.html" class="subitem">err (error)</a></li>
						<li><a href="../Document/Graphics/Resources/gs.html" class="subitem">gs (graphics styles)</a></li>
						<li><a href="../Document/Graphics/Resources/gsn.html" class="subitem">gsn (gsn high-level interfaces)</a></li>
						<li><a href="../Document/Graphics/Resources/lb.html" class="subitem">lb (label bar)</a></li>
						<li><a href="../Document/Graphics/Resources/lg.html" class="subitem">lg (legends)</a></li>
						<li><a href="../Document/Graphics/Resources/mp.html" class="subitem">mp (maps)</a></li>
						
						<li><a href="../Document/Graphics/Resources/pm.html" class="subitem">pm (plot manager)</a></li>
						<li><a href="../Document/Graphics/Resources/pr.html" class="subitem">pr (primitives)</a></li>
						<li><a href="../Document/Graphics/Resources/sf.html" class="subitem">sf (scalar field)</a></li>
						<li><a href="../Document/Graphics/Resources/st.html" class="subitem">st (streamline)</a></li>
						<li><a href="../Document/Graphics/Resources/tf.html" class="subitem">tf (transform)</a></li>
						<li><a href="../Document/Graphics/Resources/ti.html" class="subitem">ti (title)</a></li>
						
						<li><a href="../Document/Graphics/Resources/tm.html" class="subitem">tm (tickmark)</a></li>
						<li><a href="../Document/Graphics/Resources/tr.html" class="subitem">tr (transformation)</a></li>
						<li><a href="../Document/Graphics/Resources/tx.html" class="subitem">tx (text)</a></li>
						<li><a href="../Document/Graphics/Resources/vc.html" class="subitem">vc (vectors)</a></li>
						<li><a href="../Document/Graphics/Resources/vf.html" class="subitem">vf (vector field)</a></li>
						<li><a href="../Document/Graphics/Resources/vp.html" class="subitem">vp (view port)</a></li>
						
						<li><a href="../Document/Graphics/Resources/wk.html" class="subitem">wk (workstation)</a></li>
						<li><a href="../Document/Graphics/Resources/ws.html" class="subitem">ws (workspace)</a></li>
						<li><a href="../Document/Graphics/Resources/xy.html" class="subitem">xy (xy plots)</a></li>						
					</ul>
        </li>

				<li>
				<a href="../links.html" class="trigger">Popular Links</a>
					<ul>
					<li><a href="../Document/Graphics/hlures.html" class="subitem">.hluresfile</a></li>
					<li><a href="../Document/Graphics/color_table_gallery.html" class="subitem">Color Tables</a></li>
					<li><a href="../Document/Graphics/font_tables.html" class="subitem">Font Tables</a></li>	
					<li><a href="../Document/Language/error_messages.html" class="subitem">Error Messages</a></li>	
					<li><a href="../Document/Graphics/Images/dashpatterns.png" class="subitem">Dash Pattern Table</a></li>	
					<li><a href="../Document/Graphics/Images/fillpatterns.png" class="subitem">Fill Pattern Table</a></li>	
					<li><a href="../Document/Graphics/Images/markers.png" class="subitem">Marker Table</a></li>
					<li><a href="../Document/Graphics/map_projections.html" class="subitem">Map Projections</a></li>
					<li><a href="../Document/Graphics/rangs.html" class="subitem">High Resolution Map Database</a></li>
					<li><a href="editor.html" class="subitem">Editor Enhancements</a></li>
					<li><a href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a></li>
					<li><a href="../Document/Tools/ncl_filedump.html">ncl_filedump</a></li>
					<li><a href="../Document/Tools/index.html" class="subitem">Tools</a></li>
					<li><a href="../Document/Tools/WRAPIT.html" class="subitem">WRAPIT</a></li>
					</ul>
				</li>

				<li>
				<a href="../announcements.html" class="trigger">What's New</a>
					<ul>
					        <li><a href="../announcements.html" class="subitem">Announcements</a></li>
						<li><a href="../current_release.html" class="subitem">In Latest Release</a></li>
						<li><a href="../new_applications.html" class="subitem">In Application Examples</a></li>
						<li><a href="../future_release.html" class="subitem">In Next Release</a></li>	
						<li><a href="../prev_releases.html" class="subitem">In Previous Releases</a></li>
					</ul>
				</li>
	

				<li>
				<a href="../Support/index.html" class='trigger'>Support</a>
					<ul>
						<li><a href="../Support/email_lists.html" class="subitem">Email Lists</a></li>
						<li><a href="editor.html" class="subitem">Editor enhancements</a></li>
						<li><a href="../Document/Language/error_messages.html" class="subitem">Error messages</a></li>
						<li><a href="../Document/Manuals/index.html" class="subitem">Manuals</a></li>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="../Training/index.html" class="subitem">Training</a></li>
						<li><a href="../Training/Webinars/index.html" class="subitem">Webinars</a></li>
						<li><a href="../Training/Workshops/index.html" class="subitem">Workshops</a></li>
						<li><a href="../Document/index.html" class="subitem">Documentation</a></li>
						<li><a href="../FAQ/index.html" class="subitem">FAQ</a></li>
						<li><a href="../ftp_files.html" class="subitem">Uploading files via ftp</a></li>
						<li><a href="../report_bug.html" class="subitem">Report Bugs</a></li>
					</ul>
				</li>

				<li>
				<a href="../External/index.html" class='trigger'>External</a>
					<ul>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="http://climatedataguide.ucar.edu/" class="subitem">Climate Data Guide</a></li>
						<li><a href="https://code.zmaw.de/projects/cdo/" class="subitem">Climate Data Operators</a></li>
						<li><a href="http://www.earthsystemmodeling.org/" class="subitem">Earth System Modeling Framework</a></li>
						<li><a href="http://nco.sourceforge.net/" class="subitem">NetCDF Operators</a></li>
						<li><a href="http://www.pyngl.ucar.edu/" class="subitem">PyNGL</a></li>
						<li><a href="http://www.pyngl.ucar.edu/Nio.shtml" class="subitem">PyNIO</a></li>
					</ul>
				</li>


			<!-- end menubar_main -->		
			</ul>
		
		<!-- end nav_main -->	
		</div>
		
	<!-- end nav_main_wrap -->	
  	</div>
		
			

	
	<div id="wrap"><!-- begin wrap -->
	<div id="content"><!-- begin content -->
	
	<!-- ######### BEGIN EDITABLE PAGE CONTENT ######### -->

			<div id="subheader"><!-- begin subheader -->
			<map name="ncl-home">
<area shape="rect" coords="0,0,65,40" href="../index-2.html">
<area shape="rect" coords="540,0,615,40" href="http://www.ncar.ucar.edu/">
<area shape="rect" coords="625,0,665,40" href="http://www.nsf.gov/">
</map>

	<div id="nclheader">
	<img src="https://www.ncl.ucar.edu/Images/NCL_NCAR_NSF_banner.png" height=40 "NCL Website header" usemap="#ncl-home">
	</div>


			<div id="googlesearch">
<form style="float:right" id="cse-search-box" action="http://google.com/cse">
  <input type="hidden" name="cx" value="016712339613867830978:igijo92w2zo" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" name="q" size="31" maxlength="255" id="searchbox" /><label for="searchbox">Search</label>
  <input type="hidden" name="hq" value="site:www.ncl.ucar.edu">
</form>
			</div><!-- end googlesearch -->

			</div><!-- end subheader -->
			
			      <div id="general_main">

    <font size=-1><a href="../index-2.html">NCL Home></a>
<a href="index-2.html">Application examples></a>
<a href="list_dataP.html">Data Analysis</a> ||
<a href="Data/index.html">Data files for some examples</a><p>
Example pages containing:
<a href="concepts_list.html">tips</a> |
<a href="res_list.html">resources</a> | 
<a href="func_list.html">functions/procedures</a>
</font>

<br>
    <h1>NCL: Task parallelism</h1>

<p>
<p>
<p>
<div class=text>
<a href="../prev_releases.html#6.5.0">NCL V6.5.0</a> introduces new functions that enable NCL scripts to execute multiple independent tasks that can run in parallel with each other and concurrently with the NCL script itself. The functions are described below and illustrated in Example 3. It should be noted however that there have been other means by which task-parallelism can be performed, which are available to users of older versions of NCL. The first two examples illustrate how this can be accomplished using python's <em>subprocess</em> module to invoke multiple NCL scripts.
<p>
For discussion here, a <i>task</i> is any operation that can be invoked from a command-line. 
<p>
The new capabilities are:
<p><pre>
    function <a href="../Document/Functions/Built-in/subprocess.html"><strong>subprocess</strong></a>(command[1]:string) id[1]:integer
</pre><p>
where <em>command</em> is a string containing a shell command to execute. <a href="../Document/Functions/Built-in/subprocess.html"><strong>subprocess</strong></a> invokes the shell command and returns control back to NCL immediately without waiting for the command to complete. It returns a numeric <i>id</i> that is associated with the task.

<p>
Often times in task-parallel operations, one needs to know if the subtasks have completed, for example to make use of their results in further processing:
<p><pre>
    function <a href="../Document/Functions/Built-in/subprocess_wait.html"><strong>subprocess_wait</strong></a>(id[1]:integer, is_blocking[1]:logical) id[1]:integer
</pre><p>
This function will either wait on a subtask to finish, or determine without waiting whether a subtask has finished. The status of a particular subtask can be determined by providing the associated <em>id</em> that was returned by <a href="../Document/Functions/Built-in/subprocess.html"><strong>subprocess</strong></a>. Alternatively, providing a negative value for <em>id</em> will test the status of <i>any</i> subtask.
<p>
If the <em>is_blocking</em> argument is True, the function waits for the/any subtask to finish. If False, the function returns immediately with either the <em>id</em> of a subtask that has finished, or a value of <em>-1</em> if the/any subtask has not completed.
</div> 
<p>
    <div class=ex>
    <!--Resampling-->
    <a name=ex1></a>
    <a href="Scripts/task_parallelism_driver_1.html">task_parallelism_driver_1.ncl</a> / 
<a href="Scripts/task_parallelism_1.py">task_parallelism_1.py</a>:
In this example a ncl script passes a list of ncl scripts to a python script that are to be run at once and managed. 
The python script loads the commonly available subprocess, sys, time 
and os modules. Two options are set at the top of the python script. The MAX_CONCURRENT variable is used to set the 
number of scripts that can run at once. The POLL_INTERVAL variable is used to set the amount of time between when python 
checks what scripts are actively running.
    </div>
<div class=ex>
    <!--Resampling-->
    <a name=ex2></a>
    <a href="Scripts/task_parallelism_driver_2.html">task_parallelism_driver_2.ncl</a> / 
<a href="Scripts/task_parallelism_2.py">task_parallelism_2.py</a>:
This example builds upon example one, adding options that are passed from the NCL driver script to external scripts via
environmental variables. Environmental variables passed to the python script include the number of tasks to be run at once, along 
with the amount of time to wait between checks on the number of scripts running. Other environmental variables are set
for use within the called NCL scripts. Note that to set environmental variables from within a NCL script export has to be 
called. <a href="../Document/Functions/Built-in/getenv.html"><strong>getenv</strong></a> can be used to retrieve a shell environmental variable from within a NCL script. 
    </div>

<div class=ex>
<!--Resampling-->
<a name=ex3></a>
<a href="Scripts/task_parallelism_driver_3.html">task_parallelism_driver_3.ncl</a> / 
<a href="Scripts/task_parallelism_3.html">task_parallelism_3.ncl</a>: This example illustrates the use of NCL's <a href="../Document/Functions/Built-in/subprocess.html"><strong>subprocess</strong></a> functions to generate a series of plots as frames for an animation. Similarly to the above examples, it consists of a <i>worker</i> script that generates a plot for a single timestep, and a <i>driver</i> script that launches and coordinates multiple instances of the worker script for each of the timesteps.
<p>
In this particular example, there were several hundred timesteps of the variable. Executing several hundred instances of the worker script concurrently would overwhelm the resources of most computers. Thus the driver script employs a gating mechanism, whereby it launches some manageable number of simultaneous instances of the worker script, and as those instances finish, it launches further tasks. It waits for all instances to complete and then uses <a href="https://www.imagemagick.org/">Imagemagick</a> to compile the collection of plot frames into an animation.
<p>
The number of simultaneous subtasks a machine can support varies widely based upon a number of considerations. Obviously the machine's available resources will be a factor, as well as whether the tasks are compute-bound versus I/O-bound, their memory requirements, etc. For this particular example, and as a rule-of-thumb starting point, the number of simultaneous subtasks was set to be equal to the number of processor cores on the machine.
<p>
In informal timing trials, the task-parallel scripts completed the job in less than half the time of a <a href="Scripts/task_parallelism_seq_3.html">sequential version</a>.

</div>

		</div>

					<p>&nbsp;</p>

		<!-- begin footer -->
		<div id="footer">
		
		<a href="mailto:ncladmin@ucar.edu">Contact the Webmaster</a>



		<!-- end footer -->
		</div>

           <br class="clearboth"/>

	   <!-- end content -->
	</div>
<!-- end wrap -->
</body>    

<!-- Mirrored from www.ncl.ucar.edu/Applications/task_parallelism.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 15:17:42 GMT -->
</html>


