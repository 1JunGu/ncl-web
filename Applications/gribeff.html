<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.ncl.ucar.edu/Applications/gribeff.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 16:16:07 GMT -->
<head>
<meta name="description" content="NCL file I/O example page. Demonstrates the use of efficient writing to a NetCDF file from a GRIB file.">
<meta name="keywords" content="NCL,GRIB">

<TITLE>NCL: Efficient GRIB to netCDF</title>
</head>

<body>
	
	<!-- main navigation include -->
		<!-- NCL CSS -->
	<link rel="stylesheet" href="../styles/ncl.css" type="text/css" media="all">
	
	
		<!-- Equal Height Columns -->
		<script type="text/javascript" src="../scripts/column_height_equal.js"></script>
		
		<!-- DOJO Expandable Tree Nav -->

		<script type="text/javascript" src="../scripts/dojo/dojo.js"></script>
		<script type="text/javascript">
		
		dojo.require("dojo.widget.TreeV3");
		dojo.require("dojo.widget.TreeNodeV3");
		dojo.require("dojo.widget.TreeLinkExtension");
		dojo.require("dojo.widget.TreeBasicControllerV3");
		dojo.hostenv.writeIncludes();

		</script>
		

		<div id="top_colorbar"><!-- begin top_colorbar -->
		</div><!-- end top_colorbar -->


	<div id="nav_org_wrap"><!-- begin nav_org_wrap -->
	<div id="nav_org"><!-- begin nav_org -->

		<ul class="menubar">


			<li><a class="trigger" href="../internal/index.html">&nbsp;</a>
			</li>

			<li><a class="trigger" href="http://www.ucar.edu/">UCAR</a>
			</li>

			<li><a class="trigger" href="http://www.ncar.ucar.edu/">NCAR</a>
			</li>

			<li><a class="trigger" href="http://www.cisl.ucar.edu/">CISL</a>
			</li>
		</ul>

	</div><!-- end nav_org -->

	<div id="search"><!-- begin search -->

		<ul class="menubar">

			<li><a class="trigger" href="../Download/index.html">Download</a>
			</li>

			<li><a class="trigger" href="../citation.html">Citing NCL</a>
			</li>

			<li><a class="trigger" href="../contributors.html">Contributors</a>
			</li>

		</ul>

	</div><!-- end search -->

	</div><!-- end nav_org_wrap -->
	
	
	

		<div id="nav_main_wrap"><!-- begin nav_main_wrap -->

		<div id="nav_main"><!-- begin nav_main -->
			<ul id="menubar_main">

				<li>
				<a href="../Document/Pivot_to_Python/september_2019_update.html" class="triggeryw">&#9733; UPDATED LETTER TO NCL USERS</a>
				<li>
				<a href="../index.html" class="triggeron">NCL</a>
					<ul>
                                          <li><a href="../Document/Pivot_to_Python/index.html">Pivot to Python</a>
					  <li><a href="../overview.html" class="subitem">Overview</a></li>
						<li><a href="../get_started.html" class="subitem">Getting Started</a> </li>
						<li><a href="../gallery.html" class="subitem">Gallery</a></li>
						<li><a href="../Download/index.html" class="subitem">Download</a></li>
						<li><a href="../current_release.html" class="subitem">What's New</a></li>
						<li><a href="../Document/index.html" class="subitem">Documentation</a></li>						
						<li><a href="../citation.html" class="subitem">Citing NCL</a></li>
					</ul>

				</li>

				<li>
				<a href="index.html" class="trigger">Examples</a>
					<ul>
						<li><a href="index.html" class="subitem" title="Examples">All Examples</a></li>
						<li><a href="Templates/index.html" class="subitem">Templates</a></li>
						<li><a href="list_io.html" class="subitem">File I/O</a></li>
						<li><a href="list_data.html" class="subitem">Datasets</a></li>
						<li><a href="list_maps.html" class="subitem">Maps</a></li>
						<li><a href="list_models.html" class="subitem">Models</a></li>
						<li><a href="list_dataP.html" class="subitem">Data Analysis</a></li>
						<li><a href="list_ptypes.html" class="subitem">Plot Types</a></li>
						<li><a href="list_tech.html" class="subitem">Plot Techniques</a></li>
						<li><a href="list_special.html" class="subitem">Special Plots</a></li>
						<li><a href="list_grids.html" class="subitem">Non-uniform Grids</a></li>
						<li><a href="list_misc.html" class="subitem">Miscellaneous</a></li>
					</ul>
				</li>

				<li>
				<a href="../Document/Functions/list_alpha.html" class="trigger">Functions</a>
					<ul>
						<li><a href="../Document/Functions/list_alpha.html" class="subitem">Alphabetical Listing</a></li>
						<li><a href="../Document/Functions/index.html" class="subitem">Category Listing</a></li>
						<li><a href="../Document/Functions/list_type.html" class="subitem">Function-Type Listing</a></li>						
					</ul>
				</li>
				
				<li>
				<a href="../Document/Graphics/Resources/index.html" class="trigger">Resources</a>
					<ul>
					  <li><a href="../Document/Graphics/Resources/list_alpha_res.html" class="subitem">Complete Listing</a></li>
					
						<li><a href="../Document/Graphics/Resources/am.html" class="subitem">am (annotation manager)</a></li>
						<li><a href="../Document/Graphics/Resources/app.html" class="subitem">app (app)</a></li>
						<li><a href="../Document/Graphics/Resources/ca.html" class="subitem">ca (coordinate array)</a></li>
						<li><a href="../Document/Graphics/Resources/cn.html" class="subitem">cn (contour)</a></li>
						<li><a href="../Document/Graphics/Resources/ct.html" class="subitem">ct (coordinate array table)</a></li>
						<li><a href="../Document/Graphics/Resources/dc.html" class="subitem">dc (data comm)</a></li>
						
						<li><a href="../Document/Graphics/Resources/err.html" class="subitem">err (error)</a></li>
						<li><a href="../Document/Graphics/Resources/gs.html" class="subitem">gs (graphics styles)</a></li>
						<li><a href="../Document/Graphics/Resources/gsn.html" class="subitem">gsn (gsn high-level interfaces)</a></li>
						<li><a href="../Document/Graphics/Resources/lb.html" class="subitem">lb (label bar)</a></li>
						<li><a href="../Document/Graphics/Resources/lg.html" class="subitem">lg (legends)</a></li>
						<li><a href="../Document/Graphics/Resources/mp.html" class="subitem">mp (maps)</a></li>
						
						<li><a href="../Document/Graphics/Resources/pm.html" class="subitem">pm (plot manager)</a></li>
						<li><a href="../Document/Graphics/Resources/pr.html" class="subitem">pr (primitives)</a></li>
						<li><a href="../Document/Graphics/Resources/sf.html" class="subitem">sf (scalar field)</a></li>
						<li><a href="../Document/Graphics/Resources/st.html" class="subitem">st (streamline)</a></li>
						<li><a href="../Document/Graphics/Resources/tf.html" class="subitem">tf (transform)</a></li>
						<li><a href="../Document/Graphics/Resources/ti.html" class="subitem">ti (title)</a></li>
						
						<li><a href="../Document/Graphics/Resources/tm.html" class="subitem">tm (tickmark)</a></li>
						<li><a href="../Document/Graphics/Resources/tr.html" class="subitem">tr (transformation)</a></li>
						<li><a href="../Document/Graphics/Resources/tx.html" class="subitem">tx (text)</a></li>
						<li><a href="../Document/Graphics/Resources/vc.html" class="subitem">vc (vectors)</a></li>
						<li><a href="../Document/Graphics/Resources/vf.html" class="subitem">vf (vector field)</a></li>
						<li><a href="../Document/Graphics/Resources/vp.html" class="subitem">vp (view port)</a></li>
						
						<li><a href="../Document/Graphics/Resources/wk.html" class="subitem">wk (workstation)</a></li>
						<li><a href="../Document/Graphics/Resources/ws.html" class="subitem">ws (workspace)</a></li>
						<li><a href="../Document/Graphics/Resources/xy.html" class="subitem">xy (xy plots)</a></li>						
					</ul>
        </li>

				<li>
				<a href="../links.html" class="trigger">Popular Links</a>
					<ul>
					<li><a href="../Document/Graphics/hlures.html" class="subitem">.hluresfile</a></li>
					<li><a href="../Document/Graphics/color_table_gallery.html" class="subitem">Color Tables</a></li>
					<li><a href="../Document/Graphics/font_tables.html" class="subitem">Font Tables</a></li>	
					<li><a href="../Document/Language/error_messages.html" class="subitem">Error Messages</a></li>	
					<li><a href="../Document/Graphics/Images/dashpatterns.png" class="subitem">Dash Pattern Table</a></li>	
					<li><a href="../Document/Graphics/Images/fillpatterns.png" class="subitem">Fill Pattern Table</a></li>	
					<li><a href="../Document/Graphics/Images/markers.png" class="subitem">Marker Table</a></li>
					<li><a href="../Document/Graphics/map_projections.html" class="subitem">Map Projections</a></li>
					<li><a href="../Document/Graphics/rangs.html" class="subitem">High Resolution Map Database</a></li>
					<li><a href="editor.html" class="subitem">Editor Enhancements</a></li>
					<li><a href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a></li>
					<li><a href="../Document/Tools/ncl_filedump.html">ncl_filedump</a></li>
					<li><a href="../Document/Tools/index.html" class="subitem">Tools</a></li>
					<li><a href="../Document/Tools/WRAPIT.html" class="subitem">WRAPIT</a></li>
					</ul>
				</li>

				<li>
				<a href="../announcements.html" class="trigger">What's New</a>
					<ul>
					        <li><a href="../announcements.html" class="subitem">Announcements</a></li>
						<li><a href="../current_release.html" class="subitem">In Latest Release</a></li>
						<li><a href="../new_applications.html" class="subitem">In Application Examples</a></li>
						<li><a href="../future_release.html" class="subitem">In Next Release</a></li>	
						<li><a href="../prev_releases.html" class="subitem">In Previous Releases</a></li>
					</ul>
				</li>
	

				<li>
				<a href="../Support/index.html" class='trigger'>Support</a>
					<ul>
						<li><a href="../Support/email_lists.html" class="subitem">Email Lists</a></li>
						<li><a href="editor.html" class="subitem">Editor enhancements</a></li>
						<li><a href="../Document/Language/error_messages.html" class="subitem">Error messages</a></li>
						<li><a href="../Document/Manuals/index.html" class="subitem">Manuals</a></li>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="../Training/index.html" class="subitem">Training</a></li>
						<li><a href="../Training/Webinars/index.html" class="subitem">Webinars</a></li>
						<li><a href="../Training/Workshops/index.html" class="subitem">Workshops</a></li>
						<li><a href="../Document/index.html" class="subitem">Documentation</a></li>
						<li><a href="../FAQ/index.html" class="subitem">FAQ</a></li>
						<li><a href="../ftp_files.html" class="subitem">Uploading files via ftp</a></li>
						<li><a href="../report_bug.html" class="subitem">Report Bugs</a></li>
					</ul>
				</li>

				<li>
				<a href="../External/index.html" class='trigger'>External</a>
					<ul>
						<li><a href="https://www2.cisl.ucar.edu/resources/computational-systems/geyser-and-caldera/visualization/using-ncl-the-cheyenne-environment">NCL on Cheyenne</a>
						<li><a href="http://climatedataguide.ucar.edu/" class="subitem">Climate Data Guide</a></li>
						<li><a href="https://code.zmaw.de/projects/cdo/" class="subitem">Climate Data Operators</a></li>
						<li><a href="http://www.earthsystemmodeling.org/" class="subitem">Earth System Modeling Framework</a></li>
						<li><a href="http://nco.sourceforge.net/" class="subitem">NetCDF Operators</a></li>
						<li><a href="http://www.pyngl.ucar.edu/" class="subitem">PyNGL</a></li>
						<li><a href="http://www.pyngl.ucar.edu/Nio.shtml" class="subitem">PyNIO</a></li>
					</ul>
				</li>


			<!-- end menubar_main -->		
			</ul>
		
		<!-- end nav_main -->	
		</div>
		
	<!-- end nav_main_wrap -->	
  	</div>
		
			

	
	<div id="wrap"><!-- begin wrap -->
	<div id="content"><!-- begin content -->
	
	<!-- ######### BEGIN EDITABLE PAGE CONTENT ######### -->

			<div id="subheader"><!-- begin subheader -->
			<map name="ncl-home">
<area shape="rect" coords="0,0,65,40" href="../index-2.html">
<area shape="rect" coords="540,0,615,40" href="http://www.ncar.ucar.edu/">
<area shape="rect" coords="625,0,665,40" href="http://www.nsf.gov/">
</map>

	<div id="nclheader">
	<img src="https://www.ncl.ucar.edu/Images/NCL_NCAR_NSF_banner.png" height=40 "NCL Website header" usemap="#ncl-home">
	</div>


			<div id="googlesearch">
<form style="float:right" id="cse-search-box" action="http://google.com/cse">
  <input type="hidden" name="cx" value="016712339613867830978:igijo92w2zo" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" name="q" size="31" maxlength="255" id="searchbox" /><label for="searchbox">Search</label>
  <input type="hidden" name="hq" value="site:www.ncl.ucar.edu">
</form>
			</div><!-- end googlesearch -->

			</div><!-- end subheader -->
			
			      <div id="general_main">

<a class=crumb href="../index-2.html">NCL Home></a>
<a class=crumb href="index-2.html">Application examples></a>
<a class=crumb href="list_io.html">File IO</a> ||
<a href="Data/index.html">Data files for some examples</a><p>
<font size=-1>Example pages containing:
<a href="concepts_list.html">tips</a> |
<a href="res_list.html">resources</a> | 
<a href="func_list.html">functions/procedures</a></font>

> <a class=crumb href="grib2netCDF.html">GRIB to netCDF</a><br>

<h1>NCL: GRIB to netCDF: Efficient Approach</h1>

<i>Note: Support for <a
href="../Document/Manuals/Ref_Manual/NclFormatSupport.html#GRIB">GRIB2</a>
files was added in <a href="../prev_releases.html#4.3.0">version
4.3.0</a>.</i>
<p> 

In version <a href="../prev_releases.html#a034">4.2.0.a034</a>, a tool
called <a
href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a> was
created to convert all or part of a GRIB file to <a
href="../Document/Manuals/Ref_Manual/NclFormatSupport.html#NetCDF">netCDF</a>.
<p>

This method is recommended unless you want to rename some of the GRIB1 and
GRIB2 output variables.  The method below shows the most efficient way to
write GRIB files which rename variable and dimension names.
<p>

Some notes about the method below:

<ul>

<li>use only if you need to rename variables; otherwise use <a
href="../Document/Tools/ncl_convert2nc.html">ncl_convert2nc</a>
(version <a href="../prev_releases.html#a034">4.2.0.a034</a> or later)

<li>requires user to define file contents before data are written to file
(just like writing via fortran or C)

<li>user should preview GRIB1 or GRIB2 file with <a
href="../Document/Tools/ncl_filedump.html">ncl_filedump</a>

<li>data values are written using the (/  and /) operator

<li>contains a user defined function that eliminates repetitive tasks

<li>changes names of dimensions to commonly used names (not required)

<li>uses <a href="../Document/Functions/Built-in/cd_calendar.html"><strong>cd_calendar</strong></a> to change the units
from "hours since 1800-01-01 00:00" to an integer date of the form YYYYMMDDHH 
</ul>

<pre>
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/contributed.ncl"

function rdVar4D (f:file, vName:string, time:integer) 
; read GRIB 4D variable and assign new dimension names
begin 
  var = f->$vName$; read variable
  var!0 = "time"     ; assign 'conventional' dimension names 
  var!1 = "lev"  
  var!2 = "lat"  
  var!3 = "lon"
  var&time = time    ; assign time coord variable                 
  return(var)                                                             
end    

begin  
;***********************************************
; read in data from GRIB file
;***********************************************
   gribdir  = "./"
   gribfil  = "monthly_1979_1151.tar.grb"
   grib_in  = addfile(gribdir+gribfil, "r")

  ;print( grib_in )                       ; file overview

   TIME  = grib_in->initial_time0_hours   ; time as "hours since"  
   lat   = grib_in->g0_lat_2              ; latitude          
   lon   = grib_in->g0_lon_3              ; longitude           
   lev   = grib_in->lv_ISBL1              ; level

   lat!0 = "lat"                          ; assign new dimension name
   lon!0 = "lon"                          
   lev!0 = "lev"                                                          
   TIME!0= "time"

   time  = cd_calendar(TIME, -3)          ; change to date syntax
   time!0= "time"
   time@units = "yyyymmddhh"

   TMP   = rdVar4D (grib_in, "T_GDS0_ISBL" ,time)
   Z     = rdVar4D (grib_in, "Z_GDS0_ISBL" ,time) 
                                    
;***********************************************
; create parameters and output file
;*********************************************** 
    ntim  = dimsizes(time)              
    klev  = dimsizes(lev)                                                
    nlat  = dimsizes(lat)                                                
    mlon  = dimsizes(lon)                                                
         
    system("'rm' -f monthly_1979_1151.nc")     ; remove pre-exit file (if any)
    ncdf  = addfile("monthly_1979_1151.nc","c")  ; create output file  

;***************************************************
; define file options [Version a033]
;***********************************************
    setfileoption(ncdf, "prefill", False)
    setfileoption(ncdf, "suppressclose", True)
    setfileoption(ncdf, "definemode", True)

;***********************************************
; assign file attributes 
;***********************************************                     
    fAtt               = True                        
    fAtt@title         = "GRIB-to-netCDF: Efficient Approach"          
                
    fAtt@source_file   = "monthly_1979_1151.tar.grb"
    fAtt@Conventions   = "None"                                        
                
    fAtt@creation_date = systemfunc("date")  
    fileattdef( ncdf, fAtt )            

;***********************************************
; predefine coordinate information                
;***********************************************
    dimNames = (/"time", "lat", "lon",  "lev" /)                        
    dimSizes = (/ ntim ,  nlat,  mlon,  klev  /)                         
    dimUnlim = (/ True , False, False,  False /)                         
    filedimdef(ncdf, dimNames  , dimSizes,  dimUnlim )                   
    filevardef(ncdf, "time"  , typeof(time), getvardims(time) )            
    filevarattdef(ncdf, "time", time)                               
    filevardef(ncdf, "lev"  , typeof(lev) , getvardims(lev) ) 
    filevarattdef(ncdf, "lev", lev)  
    filevardef(ncdf, "lat", typeof(lat), getvardims(lat) )
    filevarattdef(ncdf, "lat", lat) 
    filevardef(ncdf, "lon", typeof(lon), getvardims(lon) ) 
    filevarattdef(ncdf, "lon", lon)      

;***********************************************
; predefine variable sizes
;*********************************************** 
    filevardef(ncdf,"TIME",typeof(TIME), getvardims(TIME) ) 
    filevarattdef(ncdf,"TIME",TIME) 

    filevardef(ncdf,"T",typeof(TMP), getvardims(TMP) ) 
    filevarattdef(ncdf,"T",TMP) 

    filevardef(ncdf,"Z",typeof(Z),getvardims(Z) )
    filevarattdef(ncdf,"Z",Z)

;***********************************************
; terminate define mode: not necessary but for clarity
;*********************************************** 
    setfileoption(ncdf, "definemode", False) 

;***********************************************
; write data values to predefined locations  
; (/ .../) operator transfer values only                     
;***********************************************
    ncdf->time   = (/ time /)     
    ncdf->lev    = (/ lev /)                                               
    ncdf->lat    = (/ lat /)                                              
    ncdf->lon    = (/ lon /)                                              

    ncdf->TIME   = (/ TIME/)
    ncdf->T      = (/ TMP /)                                              
    ncdf->Z      = (/  Z  /)
end             

</pre>

View the results using <a
href="../Document/Tools/ncl_filedump.html">ncl_filedump</a>, or "ncdump"
from the <a href="http://www.unidata.ucar.edu/software/netcdf/">netCDF
suite of tools</a>:
<p>


<pre>
    ncl_filedump monthly_1979_1151.nc

    ncdump -h monthly_1979_1151.nc
</pre>

<a href="Prints/gribeff_dump.txt">Click here for sample output</a>.

					</div>

					<p>&nbsp;</p>

		<!-- begin footer -->
		<div id="footer">
		
		<a href="mailto:ncladmin@ucar.edu">Contact the Webmaster</a>



		<!-- end footer -->
		</div>

           <br class="clearboth"/>

	   <!-- end content -->
	</div>
<!-- end wrap -->

</div>
</BODY>

<!-- Mirrored from www.ncl.ucar.edu/Applications/gribeff.shtml by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 17 May 2025 16:16:07 GMT -->
</HTML>

